"use strict";var ji=Object.defineProperty;var vf=Object.getOwnPropertyDescriptor;var xf=Object.getOwnPropertyNames;var Af=Object.prototype.hasOwnProperty;var zl=(s,e)=>{for(var t in e)ji(s,t,{get:e[t],enumerable:!0})},Cf=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of xf(e))!Af.call(s,n)&&n!==t&&ji(s,n,{get:()=>e[n],enumerable:!(r=vf(e,n))||r.enumerable});return s};var Ef=s=>Cf(ji({},"__esModule",{value:!0}),s);var fm={};zl(fm,{handler:()=>hm});module.exports=Ef(fm);var E=Symbol.for("drizzle:entityKind"),dm=Symbol.for("drizzle:hasOwnEntityKind");function F(s,e){if(!s||typeof s!="object")return!1;if(s instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,E))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let t=Object.getPrototypeOf(s).constructor;if(t)for(;t;){if(E in t&&t[E]===e[E])return!0;t=Object.getPrototypeOf(t)}return!1}var fe=class{constructor(e,t){this.table=e,this.config=t,this.name=t.name,this.keyAsName=t.keyAsName,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType,this.generated=t.generated,this.generatedIdentity=t.generatedIdentity}static[E]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var wn=class{static[E]="ColumnBuilder";config;constructor(e,t,r){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:r,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var Ye=Symbol.for("drizzle:Name");var _n=class{static[E]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{let{name:r,columns:n,foreignColumns:i}=e();return{name:r,columns:n,foreignTable:i[0].table,foreignColumns:i}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Ui(e,this)}},Ui=class{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static[E]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:r}=this.reference(),n=t.map(o=>o.name),i=r.map(o=>o.name),a=[this.table[Ye],...n,r[0].table[Ye],...i];return e??`${a.join("_")}_fk`}};function Sn(s,...e){return s(...e)}function zi(s,e){return`${s[Ye]}_${e.join("_")}_unique`}var Wi=class{constructor(e,t){this.name=t,this.columns=e}static[E]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Vi(e,this.columns,this.nullsNotDistinctConfig,this.name)}},Kl=class{static[E]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Wi(e,this.name)}},Vi=class{constructor(e,t,r,n){this.table=e,this.columns=t,this.name=n??zi(this.table,this.columns.map(i=>i.name)),this.nullsNotDistinct=r}static[E]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Hl(s,e,t){for(let r=e;r<s.length;r++){let n=s[r];if(n==="\\"){r++;continue}if(n==='"')return[s.slice(e,r).replace(/\\/g,""),r+1];if(!t&&(n===","||n==="}"))return[s.slice(e,r).replace(/\\/g,""),r]}return[s.slice(e).replace(/\\/g,""),s.length]}function Jl(s,e=0){let t=[],r=e,n=!1;for(;r<s.length;){let i=s[r];if(i===","){(n||r===e)&&t.push(""),n=!0,r++;continue}if(n=!1,i==="\\"){r+=2;continue}if(i==='"'){let[u,y]=Hl(s,r+1,!0);t.push(u),r=y;continue}if(i==="}")return[t,r+1];if(i==="{"){let[u,y]=Jl(s,r+1);t.push(u),r=y;continue}let[a,o]=Hl(s,r,!1);t.push(a),r=o}return[t,r]}function Gl(s){let[e]=Jl(s,1);return e}function Ki(s){return`{${s.map(e=>Array.isArray(e)?Ki(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var J=class extends wn{foreignKeyConfigs=[];static[E]="PgColumnBuilder";array(e){return new Ji(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:r,actions:n})=>Sn((i,a)=>{let o=new _n(()=>{let u=i();return{columns:[e],foreignColumns:[u]}});return a.onUpdate&&o.onUpdate(a.onUpdate),a.onDelete&&o.onDelete(a.onDelete),o.build(t)},r,n))}buildExtraConfigColumn(e){return new Hi(e,this.config)}},W=class extends fe{constructor(e,t){t.uniqueName||(t.uniqueName=zi(e,[t.name])),super(e,t),this.table=e}static[E]="PgColumn"},Hi=class extends W{static[E]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Xl=class{static[E]="IndexedColumn";constructor(e,t,r,n){this.name=e,this.keyAsName=t,this.type=r,this.indexConfig=n}name;keyAsName;type;indexConfig},Ji=class extends J{static[E]="PgArrayBuilder";constructor(e,t,r){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=r}build(e){let t=this.config.baseBuilder.build(e);return new Gi(e,this.config,t)}},Gi=class s extends W{constructor(e,t,r,n){super(e,t),this.baseColumn=r,this.range=n,this.size=t.size}size;static[E]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=Gl(e)),e.map(t=>this.baseColumn.mapFromDriverValue(t))}mapToDriverValue(e,t=!1){let r=e.map(n=>n===null?null:F(this.baseColumn,s)?this.baseColumn.mapToDriverValue(n,!0):this.baseColumn.mapToDriverValue(n));return t?r:Ki(r)}};var Xi=class extends J{static[E]="PgEnumObjectColumnBuilder";constructor(e,t){super(e,"string","PgEnumObjectColumn"),this.config.enum=t}build(e){return new Yi(e,this.config)}},Yi=class extends W{static[E]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}},vn=Symbol.for("drizzle:isPgEnum");function Yl(s){return!!s&&typeof s=="function"&&vn in s&&s[vn]===!0}var Zi=class extends J{static[E]="PgEnumColumnBuilder";constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new eo(e,this.config)}},eo=class extends W{static[E]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}};function to(s,e){return Array.isArray(e)?Pf(s,[...e],void 0):Tf(s,e,void 0)}function Pf(s,e,t){let r=Object.assign(n=>new Zi(n??"",r),{enumName:s,enumValues:e,schema:t,[vn]:!0});return r}function Tf(s,e,t){let r=Object.assign(n=>new Xi(n??"",r),{enumName:s,enumValues:Object.values(e),schema:t,[vn]:!0});return r}var be=class{static[E]="Subquery";constructor(e,t,r,n=!1,i=[]){this._={brand:"Subquery",sql:e,selectedFields:t,alias:r,isWith:n,usedTables:i}}},vr=class extends be{static[E]="WithSubquery"};var Zl="0.44.3";var ro,so,ve={startActiveSpan(s,e){return ro?(so||(so=ro.trace.getTracer("drizzle-orm",Zl)),Sn((t,r)=>r.startActiveSpan(s,n=>{try{return e(n)}catch(i){throw n.setStatus({code:t.SpanStatusCode.ERROR,message:i instanceof Error?i.message:"Unknown error"}),i}finally{n.end()}}),ro,so)):e()}};var ge=Symbol.for("drizzle:ViewBaseConfig");var Kt=Symbol.for("drizzle:Schema"),xn=Symbol.for("drizzle:Columns"),ec=Symbol.for("drizzle:ExtraConfigColumns"),no=Symbol.for("drizzle:OriginalName"),io=Symbol.for("drizzle:BaseName"),vs=Symbol.for("drizzle:IsAlias"),tc=Symbol.for("drizzle:ExtraConfigBuilder"),If=Symbol.for("drizzle:IsDrizzleTable"),V=class{static[E]="Table";static Symbol={Name:Ye,Schema:Kt,OriginalName:no,Columns:xn,ExtraConfigColumns:ec,BaseName:io,IsAlias:vs,ExtraConfigBuilder:tc};[Ye];[no];[Kt];[xn];[ec];[io];[vs]=!1;[If]=!0;[tc]=void 0;constructor(e,t,r){this[Ye]=this[no]=e,this[Kt]=t,this[io]=r}};function De(s){return s[Ye]}function Ht(s){return`${s[Kt]??"public"}.${s[Ye]}`}var rc=class{static[E]="FakePrimitiveParam"};function oo(s){return s!=null&&typeof s.getSQL=="function"}function Rf(s){let e={sql:"",params:[]};for(let t of s)e.sql+=t.sql,e.params.push(...t.params),t.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...t.typings));return e}var xe=class{static[E]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new G([this])}},G=class s{constructor(e){this.queryChunks=e;for(let t of e)if(F(t,V)){let r=t[V.Symbol.Schema];this.usedTables.push(r===void 0?t[V.Symbol.Name]:r+"."+t[V.Symbol.Name])}}static[E]="SQL";decoder=nc;shouldInlineParams=!1;usedTables=[];append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return ve.startActiveSpan("drizzle.buildSQL",t=>{let r=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":r.sql,"drizzle.query.params":JSON.stringify(r.params)}),r})}buildQueryFromSourceParams(e,t){let r=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{casing:n,escapeName:i,escapeParam:a,prepareTyping:o,inlineParams:u,paramStartIndex:y}=r;return Rf(e.map(f=>{if(F(f,xe))return{sql:f.value.join(""),params:[]};if(F(f,xs))return{sql:i(f.value),params:[]};if(f===void 0)return{sql:"",params:[]};if(Array.isArray(f)){let p=[new xe("(")];for(let[d,m]of f.entries())p.push(m),d<f.length-1&&p.push(new xe(", "));return p.push(new xe(")")),this.buildQueryFromSourceParams(p,r)}if(F(f,s))return this.buildQueryFromSourceParams(f.queryChunks,{...r,inlineParams:u||f.shouldInlineParams});if(F(f,V)){let p=f[V.Symbol.Schema],d=f[V.Symbol.Name];return{sql:p===void 0||f[vs]?i(d):i(p)+"."+i(d),params:[]}}if(F(f,fe)){let p=n.getColumnCasing(f);if(t.invokeSource==="indexes")return{sql:i(p),params:[]};let d=f.table[V.Symbol.Schema];return{sql:f.table[vs]||d===void 0?i(f.table[V.Symbol.Name])+"."+i(p):i(d)+"."+i(f.table[V.Symbol.Name])+"."+i(p),params:[]}}if(F(f,Me)){let p=f[ge].schema,d=f[ge].name;return{sql:p===void 0||f[ge].isAlias?i(d):i(p)+"."+i(d),params:[]}}if(F(f,qe)){if(F(f.value,gt))return{sql:a(y.value++,f),params:[f],typings:["none"]};let p=f.value===null?null:f.encoder.mapToDriverValue(f.value);if(F(p,s))return this.buildQueryFromSourceParams([p],r);if(u)return{sql:this.mapInlineParam(p,r),params:[]};let d=["none"];return o&&(d=[o(f.encoder)]),{sql:a(y.value++,p),params:[p],typings:d}}return F(f,gt)?{sql:a(y.value++,f),params:[f],typings:["none"]}:F(f,s.Aliased)&&f.fieldAlias!==void 0?{sql:i(f.fieldAlias),params:[]}:F(f,be)?f._.isWith?{sql:i(f._.alias),params:[]}:this.buildQueryFromSourceParams([new xe("("),f._.sql,new xe(") "),new xs(f._.alias)],r):Yl(f)?f.schema?{sql:i(f.schema)+"."+i(f.enumName),params:[]}:{sql:i(f.enumName),params:[]}:oo(f)?f.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([f.getSQL()],r):this.buildQueryFromSourceParams([new xe("("),f.getSQL(),new xe(")")],r):u?{sql:this.mapInlineParam(f,r),params:[]}:{sql:a(y.value++,f),params:[f],typings:["none"]}}))}mapInlineParam(e,{escapeString:t}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return t(e);if(typeof e=="object"){let r=e.toString();return t(r==="[object Object]"?JSON.stringify(e):r)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new s.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},xs=class{constructor(e){this.value=e}static[E]="Name";brand;getSQL(){return new G([this])}};function sc(s){return typeof s=="object"&&s!==null&&"mapToDriverValue"in s&&typeof s.mapToDriverValue=="function"}var nc={mapFromDriverValue:s=>s},ic={mapToDriverValue:s=>s},sg={...nc,...ic},qe=class{constructor(e,t=ic){this.value=e,this.encoder=t}static[E]="Param";brand;getSQL(){return new G([this])}};function R(s,...e){let t=[];(e.length>0||s.length>0&&s[0]!=="")&&t.push(new xe(s[0]));for(let[r,n]of e.entries())t.push(n,new xe(s[r+1]));return new G(t)}(s=>{function e(){return new G([])}s.empty=e;function t(u){return new G(u)}s.fromList=t;function r(u){return new G([new xe(u)])}s.raw=r;function n(u,y){let f=[];for(let[p,d]of u.entries())p>0&&y!==void 0&&f.push(y),f.push(d);return new G(f)}s.join=n;function i(u){return new xs(u)}s.identifier=i;function a(u){return new gt(u)}s.placeholder=a;function o(u,y){return new qe(u,y)}s.param=o})(R||(R={}));(s=>{class e{constructor(r,n){this.sql=r,this.fieldAlias=n}static[E]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}s.Aliased=e})(G||(G={}));var gt=class{constructor(e){this.name=e}static[E]="Placeholder";getSQL(){return new G([this])}};function An(s,e){return s.map(t=>{if(F(t,gt)){if(!(t.name in e))throw new Error(`No value for placeholder "${t.name}" was provided`);return e[t.name]}if(F(t,qe)&&F(t.value,gt)){if(!(t.value.name in e))throw new Error(`No value for placeholder "${t.value.name}" was provided`);return t.encoder.mapToDriverValue(e[t.value.name])}return t})}var Of=Symbol.for("drizzle:IsDrizzleView"),Me=class{static[E]="View";[ge];[Of]=!0;constructor({name:e,schema:t,selectedFields:r,query:n}){this[ge]={name:e,originalName:e,schema:t,selectedFields:r,query:n,isExisting:!n,isAlias:!1}}getSQL(){return new G([this])}};fe.prototype.getSQL=function(){return new G([this])};V.prototype.getSQL=function(){return new G([this])};be.prototype.getSQL=function(){return new G([this])};var Jt=class{constructor(e){this.table=e}static[E]="ColumnAliasProxyHandler";get(e,t){return t==="table"?this.table:e[t]}},xr=class{constructor(e,t){this.alias=e,this.replaceOriginalName=t}static[E]="TableAliasProxyHandler";get(e,t){if(t===V.Symbol.IsAlias)return!0;if(t===V.Symbol.Name)return this.alias;if(this.replaceOriginalName&&t===V.Symbol.OriginalName)return this.alias;if(t===ge)return{...e[ge],name:this.alias,isAlias:!0};if(t===V.Symbol.Columns){let n=e[V.Symbol.Columns];if(!n)return n;let i={};return Object.keys(n).map(a=>{i[a]=new Proxy(n[a],new Jt(new Proxy(e,this)))}),i}let r=e[t];return F(r,fe)?new Proxy(r,new Jt(new Proxy(e,this))):r}},oc=class{constructor(e){this.alias=e}static[E]="RelationTableAliasProxyHandler";get(e,t){return t==="sourceTable"?As(e.sourceTable,this.alias):e[t]}};function As(s,e){return new Proxy(s,new xr(e,!1))}function nt(s,e){return new Proxy(s,new Jt(new Proxy(s.table,new xr(e,!1))))}function ao(s,e){return new G.Aliased(Cs(s.sql,e),s.fieldAlias)}function Cs(s,e){return R.join(s.queryChunks.map(t=>F(t,fe)?nt(t,e):F(t,G)?Cs(t,e):F(t,G.Aliased)?ao(t,e):t))}var Es=class extends Error{static[E]="DrizzleError";constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}},Cn=class extends Es{static[E]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var lo=class{static[E]="ConsoleLogWriter";write(e){console.log(e)}},En=class{static[E]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new lo}logQuery(e,t){let r=t.map(i=>{try{return JSON.stringify(i)}catch{return String(i)}}),n=r.length?` -- params: [${r.join(", ")}]`:"";this.writer.write(`Query: ${e}${n}`)}},Pn=class{static[E]="NoopLogger";logQuery(){}};var $e=class{static[E]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}};function ac(s,e,t){let r={},n=s.reduce((i,{path:a,field:o},u)=>{let y;F(o,fe)?y=o:F(o,G)?y=o.decoder:y=o.sql.decoder;let f=i;for(let[p,d]of a.entries())if(p<a.length-1)d in f||(f[d]={}),f=f[d];else{let m=e[u],g=f[d]=m===null?null:y.mapFromDriverValue(m);if(t&&F(o,fe)&&a.length===2){let c=a[0];c in r?typeof r[c]=="string"&&r[c]!==De(o.table)&&(r[c]=!1):r[c]=g===null?De(o.table):!1}}return i},{});if(t&&Object.keys(r).length>0)for(let[i,a]of Object.entries(r))typeof a=="string"&&!t[a]&&(n[i]=null);return n}function Je(s,e){return Object.entries(s).reduce((t,[r,n])=>{if(typeof r!="string")return t;let i=e?[...e,r]:[r];return F(n,fe)||F(n,G)||F(n,G.Aliased)?t.push({path:i,field:n}):F(n,V)?t.push(...Je(n[V.Symbol.Columns],i)):t.push(...Je(n,i)),t},[])}function Ps(s,e){let t=Object.keys(s),r=Object.keys(e);if(t.length!==r.length)return!1;for(let[n,i]of t.entries())if(i!==r[n])return!1;return!0}function Tn(s,e){let t=Object.entries(e).filter(([,r])=>r!==void 0).map(([r,n])=>F(n,G)||F(n,fe)?[r,n]:[r,new qe(n,s[V.Symbol.Columns][r])]);if(t.length===0)throw new Error("No values to set");return Object.fromEntries(t)}function lc(s,e){for(let t of e)for(let r of Object.getOwnPropertyNames(t.prototype))r!=="constructor"&&Object.defineProperty(s.prototype,r,Object.getOwnPropertyDescriptor(t.prototype,r)||Object.create(null))}function cc(s){return s[V.Symbol.Columns]}function yt(s){return F(s,be)?s._.alias:F(s,Me)?s[ge].name:F(s,G)?void 0:s[V.Symbol.IsAlias]?s[V.Symbol.Name]:s[V.Symbol.BaseName]}function ue(s,e){return{name:typeof s=="string"&&s.length>0?s:"",config:typeof s=="object"?s:e}}function uc(s){if(typeof s!="object"||s===null||s.constructor.name!=="Object")return!1;if("logger"in s){let e=typeof s.logger;return!(e!=="boolean"&&(e!=="object"||typeof s.logger.logQuery!="function")&&e!=="undefined")}if("schema"in s){let e=typeof s.schema;return!(e!=="object"&&e!=="undefined")}if("casing"in s){let e=typeof s.casing;return!(e!=="string"&&e!=="undefined")}if("mode"in s)return!(s.mode!=="default"||s.mode!=="planetscale"||s.mode!==void 0);if("connection"in s){let e=typeof s.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in s){let e=typeof s.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(s).length===0}var bt=class extends J{static[E]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:t,...r}=e;this.config.generatedIdentity={type:"always",sequenceName:t,sequenceOptions:r}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:t,...r}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:t,sequenceOptions:r}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var co=class extends bt{static[E]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new uo(e,this.config)}},uo=class extends W{static[E]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},ho=class extends bt{static[E]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new fo(e,this.config)}},fo=class extends W{static[E]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function hc(s,e){let{name:t,config:r}=ue(s,e);return r.mode==="number"?new co(t):new ho(t)}var po=class extends J{static[E]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new mo(e,this.config)}},mo=class extends W{static[E]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},go=class extends J{static[E]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new yo(e,this.config)}},yo=class extends W{static[E]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function fc(s,e){let{name:t,config:r}=ue(s,e);return r.mode==="number"?new po(t):new go(t)}var bo=class extends J{static[E]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new wo(e,this.config)}},wo=class extends W{static[E]="PgBoolean";getSQLType(){return"boolean"}};function pc(s){return new bo(s??"")}var _o=class extends J{static[E]="PgCharBuilder";constructor(e,t){super(e,"string","PgChar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new So(e,this.config)}},So=class extends W{static[E]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function dc(s,e={}){let{name:t,config:r}=ue(s,e);return new _o(t,r)}var vo=class extends J{static[E]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new xo(e,this.config)}},xo=class extends W{static[E]="PgCidr";getSQLType(){return"cidr"}};function mc(s){return new vo(s??"")}var Ao=class extends J{static[E]="PgCustomColumnBuilder";constructor(e,t,r){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=t,this.config.customTypeParams=r}build(e){return new Co(e,this.config)}},Co=class extends W{static[E]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,t){super(e,t),this.sqlName=t.customTypeParams.dataType(t.fieldConfig),this.mapTo=t.customTypeParams.toDriver,this.mapFrom=t.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function gc(s){return(e,t)=>{let{name:r,config:n}=ue(e,t);return new Ao(r,n,s)}}var it=class extends J{static[E]="PgDateColumnBaseBuilder";defaultNow(){return this.default(R`now()`)}};var Eo=class extends it{static[E]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new Ts(e,this.config)}},Ts=class extends W{static[E]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Po=class extends it{static[E]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new Is(e,this.config)}},Is=class extends W{static[E]="PgDateString";getSQLType(){return"date"}};function In(s,e){let{name:t,config:r}=ue(s,e);return r?.mode==="date"?new Eo(t):new Po(t)}var To=class extends J{static[E]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Io(e,this.config)}},Io=class extends W{static[E]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function yc(s){return new To(s??"")}var Ro=class extends J{static[E]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new Oo(e,this.config)}},Oo=class extends W{static[E]="PgInet";getSQLType(){return"inet"}};function bc(s){return new Ro(s??"")}var No=class extends bt{static[E]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Lo(e,this.config)}},Lo=class extends W{static[E]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function ot(s){return new No(s??"")}var $o=class extends J{static[E]="PgIntervalBuilder";constructor(e,t){super(e,"string","PgInterval"),this.config.intervalConfig=t}build(e){return new ko(e,this.config)}},ko=class extends W{static[E]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",t=this.precision?`(${this.precision})`:"";return`interval${e}${t}`}};function wc(s,e={}){let{name:t,config:r}=ue(s,e);return new $o(t,r)}var Bo=class extends J{static[E]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new Rs(e,this.config)}},Rs=class extends W{static[E]="PgJson";constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Rn(s){return new Bo(s??"")}var Mo=class extends J{static[E]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new Os(e,this.config)}},Os=class extends W{static[E]="PgJsonb";constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function _c(s){return new Mo(s??"")}var Fo=class extends J{static[E]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Do(e,this.config)}},Do=class extends W{static[E]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[t,r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(r),Number.parseFloat(n)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},qo=class extends J{static[E]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new Qo(e,this.config)}},Qo=class extends W{static[E]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[t,r,n]=e.slice(1,-1).split(",");return{a:Number.parseFloat(t),b:Number.parseFloat(r),c:Number.parseFloat(n)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function Sc(s,e){let{name:t,config:r}=ue(s,e);return!r?.mode||r.mode==="tuple"?new Fo(t):new qo(t)}var jo=class extends J{static[E]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Uo(e,this.config)}},Uo=class extends W{static[E]="PgMacaddr";getSQLType(){return"macaddr"}};function vc(s){return new jo(s??"")}var Wo=class extends J{static[E]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Vo(e,this.config)}},Vo=class extends W{static[E]="PgMacaddr8";getSQLType(){return"macaddr8"}};function xc(s){return new Wo(s??"")}var zo=class extends J{static[E]="PgNumericBuilder";constructor(e,t,r){super(e,"string","PgNumeric"),this.config.precision=t,this.config.scale=r}build(e){return new Ns(e,this.config)}},Ns=class extends W{static[E]="PgNumeric";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue(e){return typeof e=="string"?e:String(e)}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}},Ko=class extends J{static[E]="PgNumericNumberBuilder";constructor(e,t,r){super(e,"number","PgNumericNumber"),this.config.precision=t,this.config.scale=r}build(e){return new Ho(e,this.config)}},Ho=class extends W{static[E]="PgNumericNumber";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}mapToDriverValue=String;getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}},Jo=class extends J{static[E]="PgNumericBigIntBuilder";constructor(e,t,r){super(e,"bigint","PgNumericBigInt"),this.config.precision=t,this.config.scale=r}build(e){return new Go(e,this.config)}},Go=class extends W{static[E]="PgNumericBigInt";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function Ac(s,e){let{name:t,config:r}=ue(s,e),n=r?.mode;return n==="number"?new Ko(t,r?.precision,r?.scale):n==="bigint"?new Jo(t,r?.precision,r?.scale):new zo(t,r?.precision,r?.scale)}var Xo=class extends J{static[E]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Yo(e,this.config)}},Yo=class extends W{static[E]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[t,r]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(r)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Zo=class extends J{static[E]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new ea(e,this.config)}},ea=class extends W{static[E]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[t,r]=e.slice(1,-1).split(",");return{x:Number.parseFloat(t),y:Number.parseFloat(r)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function Cc(s,e){let{name:t,config:r}=ue(s,e);return!r?.mode||r.mode==="tuple"?new Xo(t):new Zo(t)}function Nf(s){let e=[];for(let t=0;t<s.length;t+=2)e.push(Number.parseInt(s.slice(t,t+2),16));return new Uint8Array(e)}function Ec(s,e){let t=new ArrayBuffer(8),r=new DataView(t);for(let n=0;n<8;n++)r.setUint8(n,s[e+n]);return r.getFloat64(0,!0)}function ta(s){let e=Nf(s),t=0,r=e[t];t+=1;let n=new DataView(e.buffer),i=n.getUint32(t,r===1);t+=4;let a;if(i&536870912&&(a=n.getUint32(t,r===1),t+=4),(i&65535)===1){let o=Ec(e,t);t+=8;let u=Ec(e,t);return t+=8,[o,u]}throw new Error("Unsupported geometry type")}var ra=class extends J{static[E]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new sa(e,this.config)}},sa=class extends W{static[E]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return ta(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},na=class extends J{static[E]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new ia(e,this.config)}},ia=class extends W{static[E]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let t=ta(e);return{x:t[0],y:t[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function Pc(s,e){let{name:t,config:r}=ue(s,e);return!r?.mode||r.mode==="tuple"?new ra(t):new na(t)}var oa=class extends J{static[E]="PgRealBuilder";constructor(e,t){super(e,"number","PgReal"),this.config.length=t}build(e){return new aa(e,this.config)}},aa=class extends W{static[E]="PgReal";constructor(e,t){super(e,t)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function Tc(s){return new oa(s??"")}var la=class extends J{static[E]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new ca(e,this.config)}},ca=class extends W{static[E]="PgSerial";getSQLType(){return"serial"}};function Ic(s){return new la(s??"")}var ua=class extends bt{static[E]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new ha(e,this.config)}},ha=class extends W{static[E]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function Rc(s){return new ua(s??"")}var fa=class extends J{static[E]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new pa(e,this.config)}},pa=class extends W{static[E]="PgSmallSerial";getSQLType(){return"smallserial"}};function Oc(s){return new fa(s??"")}var da=class extends J{static[E]="PgTextBuilder";constructor(e,t){super(e,"string","PgText"),this.config.enumValues=t.enum}build(e){return new ma(e,this.config)}},ma=class extends W{static[E]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function Nc(s,e={}){let{name:t,config:r}=ue(s,e);return new da(t,r)}var ga=class extends it{constructor(e,t,r){super(e,"string","PgTime"),this.withTimezone=t,this.precision=r,this.config.withTimezone=t,this.config.precision=r}static[E]="PgTimeBuilder";build(e){return new Ls(e,this.config)}},Ls=class extends W{static[E]="PgTime";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function Lc(s,e={}){let{name:t,config:r}=ue(s,e);return new ga(t,r.withTimezone??!1,r.precision)}var ya=class extends it{static[E]="PgTimestampBuilder";constructor(e,t,r){super(e,"date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=r}build(e){return new $s(e,this.config)}},$s=class extends W{static[E]="PgTimestamp";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>e.toISOString()},ba=class extends it{static[E]="PgTimestampStringBuilder";constructor(e,t,r){super(e,"string","PgTimestampString"),this.config.withTimezone=t,this.config.precision=r}build(e){return new ks(e,this.config)}},ks=class extends W{static[E]="PgTimestampString";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function On(s,e={}){let{name:t,config:r}=ue(s,e);return r?.mode==="string"?new ba(t,r.withTimezone??!1,r.precision):new ya(t,r?.withTimezone??!1,r?.precision)}var wa=class extends J{static[E]="PgUUIDBuilder";constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(R`gen_random_uuid()`)}build(e){return new Bs(e,this.config)}},Bs=class extends W{static[E]="PgUUID";getSQLType(){return"uuid"}};function Ar(s){return new wa(s??"")}var _a=class extends J{static[E]="PgVarcharBuilder";constructor(e,t){super(e,"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new Sa(e,this.config)}},Sa=class extends W{static[E]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};function Ze(s,e={}){let{name:t,config:r}=ue(s,e);return new _a(t,r)}var va=class extends J{static[E]="PgBinaryVectorBuilder";constructor(e,t){super(e,"string","PgBinaryVector"),this.config.dimensions=t.dimensions}build(e){return new xa(e,this.config)}},xa=class extends W{static[E]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}};function $c(s,e){let{name:t,config:r}=ue(s,e);return new va(t,r)}var Aa=class extends J{static[E]="PgHalfVectorBuilder";constructor(e,t){super(e,"array","PgHalfVector"),this.config.dimensions=t.dimensions}build(e){return new Ca(e,this.config)}},Ca=class extends W{static[E]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(t=>Number.parseFloat(t))}};function kc(s,e){let{name:t,config:r}=ue(s,e);return new Aa(t,r)}var Ea=class extends J{static[E]="PgSparseVectorBuilder";constructor(e,t){super(e,"string","PgSparseVector"),this.config.dimensions=t.dimensions}build(e){return new Pa(e,this.config)}},Pa=class extends W{static[E]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}};function Bc(s,e){let{name:t,config:r}=ue(s,e);return new Ea(t,r)}var Ta=class extends J{static[E]="PgVectorBuilder";constructor(e,t){super(e,"array","PgVector"),this.config.dimensions=t.dimensions}build(e){return new Ia(e,this.config)}},Ia=class extends W{static[E]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(t=>Number.parseFloat(t))}};function Mc(s,e){let{name:t,config:r}=ue(s,e);return new Ta(t,r)}function Fc(){return{bigint:hc,bigserial:fc,boolean:pc,char:dc,cidr:mc,customType:gc,date:In,doublePrecision:yc,inet:bc,integer:ot,interval:wc,json:Rn,jsonb:_c,line:Sc,macaddr:vc,macaddr8:xc,numeric:Ac,point:Cc,geometry:Pc,real:Tc,serial:Ic,smallint:Rc,smallserial:Oc,text:Nc,time:Lc,timestamp:On,uuid:Ar,varchar:Ze,bit:$c,halfvec:kc,sparsevec:Bc,vector:Mc}}var Ra=Symbol.for("drizzle:PgInlineForeignKeys"),Dc=Symbol.for("drizzle:EnableRLS"),Ae=class extends V{static[E]="PgTable";static Symbol=Object.assign({},V.Symbol,{InlineForeignKeys:Ra,EnableRLS:Dc});[Ra]=[];[Dc]=!1;[V.Symbol.ExtraConfigBuilder]=void 0;[V.Symbol.ExtraConfigColumns]={}};function Lf(s,e,t,r,n=s){let i=new Ae(s,r,n),a=typeof e=="function"?e(Fc()):e,o=Object.fromEntries(Object.entries(a).map(([f,p])=>{let d=p;d.setName(f);let m=d.build(i);return i[Ra].push(...d.buildForeignKeys(m,i)),[f,m]})),u=Object.fromEntries(Object.entries(a).map(([f,p])=>{let d=p;d.setName(f);let m=d.buildExtraConfigColumn(i);return[f,m]})),y=Object.assign(i,o);return y[V.Symbol.Columns]=o,y[V.Symbol.ExtraConfigColumns]=u,t&&(y[Ae.Symbol.ExtraConfigBuilder]=t),Object.assign(y,{enableRLS:()=>(y[Ae.Symbol.EnableRLS]=!0,y)})}var Oa=(s,e,t)=>Lf(s,e,t,void 0);var Nn=class{static[E]="PgPrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new Na(e,this.columns,this.name)}},Na=class{constructor(e,t,r){this.table=e,this.columns=t,this.name=r}static[E]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[Ae.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};function Qe(s,e){return sc(e)&&!oo(s)&&!F(s,qe)&&!F(s,gt)&&!F(s,fe)&&!F(s,V)&&!F(s,Me)?new qe(s,e):s}var wt=(s,e)=>R`${s} = ${Qe(e,s)}`,qc=(s,e)=>R`${s} <> ${Qe(e,s)}`;function Ms(...s){let e=s.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new G(e):new G([new xe("("),R.join(e,new xe(" and ")),new xe(")")])}function Qc(...s){let e=s.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new G(e):new G([new xe("("),R.join(e,new xe(" or ")),new xe(")")])}function jc(s){return R`not ${s}`}var Uc=(s,e)=>R`${s} > ${Qe(e,s)}`,Wc=(s,e)=>R`${s} >= ${Qe(e,s)}`,Vc=(s,e)=>R`${s} < ${Qe(e,s)}`,zc=(s,e)=>R`${s} <= ${Qe(e,s)}`;function Kc(s,e){return Array.isArray(e)?e.length===0?R`false`:R`${s} in ${e.map(t=>Qe(t,s))}`:R`${s} in ${Qe(e,s)}`}function Hc(s,e){return Array.isArray(e)?e.length===0?R`true`:R`${s} not in ${e.map(t=>Qe(t,s))}`:R`${s} not in ${Qe(e,s)}`}function Jc(s){return R`${s} is null`}function Gc(s){return R`${s} is not null`}function Xc(s){return R`exists ${s}`}function Yc(s){return R`not exists ${s}`}function Zc(s,e,t){return R`${s} between ${Qe(e,s)} and ${Qe(t,s)}`}function eu(s,e,t){return R`${s} not between ${Qe(e,s)} and ${Qe(t,s)}`}function tu(s,e){return R`${s} like ${e}`}function ru(s,e){return R`${s} not like ${e}`}function su(s,e){return R`${s} ilike ${e}`}function nu(s,e){return R`${s} not ilike ${e}`}function iu(s){return R`${s} asc`}function ou(s){return R`${s} desc`}var Ln=class{constructor(e,t,r){this.sourceTable=e,this.referencedTable=t,this.relationName=r,this.referencedTableName=t[V.Symbol.Name]}static[E]="Relation";referencedTableName;fieldName},La=class{constructor(e,t){this.table=e,this.config=t}static[E]="Relations"},It=class s extends Ln{constructor(e,t,r,n){super(e,t,r?.relationName),this.config=r,this.isNullable=n}static[E]="One";withFieldName(e){let t=new s(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}},Fs=class s extends Ln{constructor(e,t,r){super(e,t,r?.relationName),this.config=r}static[E]="Many";withFieldName(e){let t=new s(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}};function au(){return{and:Ms,between:Zc,eq:wt,exists:Xc,gt:Uc,gte:Wc,ilike:su,inArray:Kc,isNull:Jc,isNotNull:Gc,like:tu,lt:Vc,lte:zc,ne:qc,not:jc,notBetween:eu,notExists:Yc,notLike:ru,notIlike:nu,notInArray:Hc,or:Qc,sql:R}}function lu(){return{sql:R,asc:iu,desc:ou}}function cu(s,e){Object.keys(s).length===1&&"default"in s&&!F(s.default,V)&&(s=s.default);let t={},r={},n={};for(let[i,a]of Object.entries(s))if(F(a,V)){let o=Ht(a),u=r[o];t[o]=i,n[i]={tsName:i,dbName:a[V.Symbol.Name],schema:a[V.Symbol.Schema],columns:a[V.Symbol.Columns],relations:u?.relations??{},primaryKey:u?.primaryKey??[]};for(let f of Object.values(a[V.Symbol.Columns]))f.primary&&n[i].primaryKey.push(f);let y=a[V.Symbol.ExtraConfigBuilder]?.(a[V.Symbol.ExtraConfigColumns]);if(y)for(let f of Object.values(y))F(f,Nn)&&n[i].primaryKey.push(...f.columns)}else if(F(a,La)){let o=Ht(a.table),u=t[o],y=a.config(e(a.table)),f;for(let[p,d]of Object.entries(y))if(u){let m=n[u];m.relations[p]=d,f&&m.primaryKey.push(...f)}else o in r||(r[o]={relations:{},primaryKey:f}),r[o].relations[p]=d}return{tables:n,tableNamesMap:t}}function $f(s){return function(t,r){return new It(s,t,r,r?.fields.reduce((n,i)=>n&&i.notNull,!0)??!1)}}function kf(s){return function(t,r){return new Fs(s,t,r)}}function uu(s,e,t){if(F(t,It)&&t.config)return{fields:t.config.fields,references:t.config.references};let r=e[Ht(t.referencedTable)];if(!r)throw new Error(`Table "${t.referencedTable[V.Symbol.Name]}" not found in schema`);let n=s[r];if(!n)throw new Error(`Table "${r}" not found in schema`);let i=t.sourceTable,a=e[Ht(i)];if(!a)throw new Error(`Table "${i[V.Symbol.Name]}" not found in schema`);let o=[];for(let u of Object.values(n.relations))(t.relationName&&t!==u&&u.relationName===t.relationName||!t.relationName&&u.referencedTable===t.sourceTable)&&o.push(u);if(o.length>1)throw t.relationName?new Error(`There are multiple relations with name "${t.relationName}" in table "${r}"`):new Error(`There are multiple relations between "${r}" and "${t.sourceTable[V.Symbol.Name]}". Please specify relation name`);if(o[0]&&F(o[0],It)&&o[0].config)return{fields:o[0].config.references,references:o[0].config.fields};throw new Error(`There is not enough information to infer relation "${a}.${t.fieldName}"`)}function hu(s){return{one:$f(s),many:kf(s)}}function $n(s,e,t,r,n=i=>i){let i={};for(let[a,o]of r.entries())if(o.isJson){let u=e.relations[o.tsKey],y=t[a],f=typeof y=="string"?JSON.parse(y):y;i[o.tsKey]=F(u,It)?f&&$n(s,s[o.relationTableTsKey],f,o.selection,n):f.map(p=>$n(s,s[o.relationTableTsKey],p,o.selection,n))}else{let u=n(t[a]),y=o.field,f;F(y,fe)?f=y:F(y,G)?f=y.decoder:f=y.sql.decoder,i[o.tsKey]=u===null?null:f.mapFromDriverValue(u)}return i}var Bf=Object.create,Er=Object.defineProperty,Mf=Object.getOwnPropertyDescriptor,Ff=Object.getOwnPropertyNames,Df=Object.getPrototypeOf,qf=Object.prototype.hasOwnProperty,Qf=(s,e,t)=>e in s?Er(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,w=(s,e)=>Er(s,"name",{value:e,configurable:!0}),je=(s,e)=>()=>(s&&(e=s(s=0)),e),ce=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),et=(s,e)=>{for(var t in e)Er(s,t,{get:e[t],enumerable:!0})},bu=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ff(e))!qf.call(s,n)&&n!==t&&Er(s,n,{get:()=>e[n],enumerable:!(r=Mf(e,n))||r.enumerable});return s},Gt=(s,e,t)=>(t=s!=null?Bf(Df(s)):{},bu(e||!s||!s.__esModule?Er(t,"default",{value:s,enumerable:!0}):t,s)),Oe=s=>bu(Er({},"__esModule",{value:!0}),s),se=(s,e,t)=>Qf(s,typeof e!="symbol"?e+"":e,t),jf=ce(s=>{"use strict";Y(),s.byteLength=u,s.toByteArray=f,s.fromByteArray=m;var e=[],t=[],r=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(i=0,a=n.length;i<a;++i)e[i]=n[i],t[n.charCodeAt(i)]=i;var i,a;t[45]=62,t[95]=63;function o(g){var c=g.length;if(c%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var _=g.indexOf("=");_===-1&&(_=c);var S=_===c?0:4-_%4;return[_,S]}w(o,"getLens");function u(g){var c=o(g),_=c[0],S=c[1];return(_+S)*3/4-S}w(u,"byteLength");function y(g,c,_){return(c+_)*3/4-_}w(y,"_byteLength");function f(g){var c,_=o(g),S=_[0],v=_[1],A=new r(y(g,S,v)),L=0,k=v>0?S-4:S,x;for(x=0;x<k;x+=4)c=t[g.charCodeAt(x)]<<18|t[g.charCodeAt(x+1)]<<12|t[g.charCodeAt(x+2)]<<6|t[g.charCodeAt(x+3)],A[L++]=c>>16&255,A[L++]=c>>8&255,A[L++]=c&255;return v===2&&(c=t[g.charCodeAt(x)]<<2|t[g.charCodeAt(x+1)]>>4,A[L++]=c&255),v===1&&(c=t[g.charCodeAt(x)]<<10|t[g.charCodeAt(x+1)]<<4|t[g.charCodeAt(x+2)]>>2,A[L++]=c>>8&255,A[L++]=c&255),A}w(f,"toByteArray");function p(g){return e[g>>18&63]+e[g>>12&63]+e[g>>6&63]+e[g&63]}w(p,"tripletToBase64");function d(g,c,_){for(var S,v=[],A=c;A<_;A+=3)S=(g[A]<<16&16711680)+(g[A+1]<<8&65280)+(g[A+2]&255),v.push(p(S));return v.join("")}w(d,"encodeChunk");function m(g){for(var c,_=g.length,S=_%3,v=[],A=16383,L=0,k=_-S;L<k;L+=A)v.push(d(g,L,L+A>k?k:L+A));return S===1?(c=g[_-1],v.push(e[c>>2]+e[c<<4&63]+"==")):S===2&&(c=(g[_-2]<<8)+g[_-1],v.push(e[c>>10]+e[c>>4&63]+e[c<<2&63]+"=")),v.join("")}w(m,"fromByteArray")}),Uf=ce(s=>{Y(),s.read=function(e,t,r,n,i){var a,o,u=i*8-n-1,y=(1<<u)-1,f=y>>1,p=-7,d=r?i-1:0,m=r?-1:1,g=e[t+d];for(d+=m,a=g&(1<<-p)-1,g>>=-p,p+=u;p>0;a=a*256+e[t+d],d+=m,p-=8);for(o=a&(1<<-p)-1,a>>=-p,p+=n;p>0;o=o*256+e[t+d],d+=m,p-=8);if(a===0)a=1-f;else{if(a===y)return o?NaN:(g?-1:1)*(1/0);o=o+Math.pow(2,n),a=a-f}return(g?-1:1)*o*Math.pow(2,a-n)},s.write=function(e,t,r,n,i,a){var o,u,y,f=a*8-i-1,p=(1<<f)-1,d=p>>1,m=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=n?0:a-1,c=n?1:-1,_=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(u=isNaN(t)?1:0,o=p):(o=Math.floor(Math.log(t)/Math.LN2),t*(y=Math.pow(2,-o))<1&&(o--,y*=2),o+d>=1?t+=m/y:t+=m*Math.pow(2,1-d),t*y>=2&&(o++,y/=2),o+d>=p?(u=0,o=p):o+d>=1?(u=(t*y-1)*Math.pow(2,i),o=o+d):(u=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[r+g]=u&255,g+=c,u/=256,i-=8);for(o=o<<i|u,f+=i;f>0;e[r+g]=o&255,g+=c,o/=256,f-=8);e[r+g-c]|=_*128}}),Wf=ce(s=>{"use strict";Y();var e=jf(),t=Uf(),r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;s.Buffer=o,s.SlowBuffer=v,s.INSPECT_MAX_BYTES=50;var n=2147483647;s.kMaxLength=n,o.TYPED_ARRAY_SUPPORT=i(),!o.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function i(){try{let l=new Uint8Array(1),h={foo:w(function(){return 42},"foo")};return Object.setPrototypeOf(h,Uint8Array.prototype),Object.setPrototypeOf(l,h),l.foo()===42}catch{return!1}}w(i,"typedArraySupport"),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:w(function(){if(o.isBuffer(this))return this.buffer},"get")}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:w(function(){if(o.isBuffer(this))return this.byteOffset},"get")});function a(l){if(l>n)throw new RangeError('The value "'+l+'" is invalid for option "size"');let h=new Uint8Array(l);return Object.setPrototypeOf(h,o.prototype),h}w(a,"createBuffer");function o(l,h,b){if(typeof l=="number"){if(typeof h=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(l)}return u(l,h,b)}w(o,"Buffer"),o.poolSize=8192;function u(l,h,b){if(typeof l=="string")return d(l,h);if(ArrayBuffer.isView(l))return g(l);if(l==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof l);if(Xe(l,ArrayBuffer)||l&&Xe(l.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Xe(l,SharedArrayBuffer)||l&&Xe(l.buffer,SharedArrayBuffer)))return c(l,h,b);if(typeof l=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let I=l.valueOf&&l.valueOf();if(I!=null&&I!==l)return o.from(I,h,b);let O=_(l);if(O)return O;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof l[Symbol.toPrimitive]=="function")return o.from(l[Symbol.toPrimitive]("string"),h,b);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof l)}w(u,"from"),o.from=function(l,h,b){return u(l,h,b)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array);function y(l){if(typeof l!="number")throw new TypeError('"size" argument must be of type number');if(l<0)throw new RangeError('The value "'+l+'" is invalid for option "size"')}w(y,"assertSize");function f(l,h,b){return y(l),l<=0?a(l):h!==void 0?typeof b=="string"?a(l).fill(h,b):a(l).fill(h):a(l)}w(f,"alloc"),o.alloc=function(l,h,b){return f(l,h,b)};function p(l){return y(l),a(l<0?0:S(l)|0)}w(p,"allocUnsafe"),o.allocUnsafe=function(l){return p(l)},o.allocUnsafeSlow=function(l){return p(l)};function d(l,h){if((typeof h!="string"||h==="")&&(h="utf8"),!o.isEncoding(h))throw new TypeError("Unknown encoding: "+h);let b=A(l,h)|0,I=a(b),O=I.write(l,h);return O!==b&&(I=I.slice(0,O)),I}w(d,"fromString");function m(l){let h=l.length<0?0:S(l.length)|0,b=a(h);for(let I=0;I<h;I+=1)b[I]=l[I]&255;return b}w(m,"fromArrayLike");function g(l){if(Xe(l,Uint8Array)){let h=new Uint8Array(l);return c(h.buffer,h.byteOffset,h.byteLength)}return m(l)}w(g,"fromArrayView");function c(l,h,b){if(h<0||l.byteLength<h)throw new RangeError('"offset" is outside of buffer bounds');if(l.byteLength<h+(b||0))throw new RangeError('"length" is outside of buffer bounds');let I;return h===void 0&&b===void 0?I=new Uint8Array(l):b===void 0?I=new Uint8Array(l,h):I=new Uint8Array(l,h,b),Object.setPrototypeOf(I,o.prototype),I}w(c,"fromArrayBuffer");function _(l){if(o.isBuffer(l)){let h=S(l.length)|0,b=a(h);return b.length===0||l.copy(b,0,0,h),b}if(l.length!==void 0)return typeof l.length!="number"||bn(l.length)?a(0):m(l);if(l.type==="Buffer"&&Array.isArray(l.data))return m(l.data)}w(_,"fromObject");function S(l){if(l>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return l|0}w(S,"checked");function v(l){return+l!=l&&(l=0),o.alloc(+l)}w(v,"SlowBuffer"),o.isBuffer=w(function(l){return l!=null&&l._isBuffer===!0&&l!==o.prototype},"isBuffer"),o.compare=w(function(l,h){if(Xe(l,Uint8Array)&&(l=o.from(l,l.offset,l.byteLength)),Xe(h,Uint8Array)&&(h=o.from(h,h.offset,h.byteLength)),!o.isBuffer(l)||!o.isBuffer(h))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(l===h)return 0;let b=l.length,I=h.length;for(let O=0,D=Math.min(b,I);O<D;++O)if(l[O]!==h[O]){b=l[O],I=h[O];break}return b<I?-1:I<b?1:0},"compare"),o.isEncoding=w(function(l){switch(String(l).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},"isEncoding"),o.concat=w(function(l,h){if(!Array.isArray(l))throw new TypeError('"list" argument must be an Array of Buffers');if(l.length===0)return o.alloc(0);let b;if(h===void 0)for(h=0,b=0;b<l.length;++b)h+=l[b].length;let I=o.allocUnsafe(h),O=0;for(b=0;b<l.length;++b){let D=l[b];if(Xe(D,Uint8Array))O+D.length>I.length?(o.isBuffer(D)||(D=o.from(D)),D.copy(I,O)):Uint8Array.prototype.set.call(I,D,O);else if(o.isBuffer(D))D.copy(I,O);else throw new TypeError('"list" argument must be an Array of Buffers');O+=D.length}return I},"concat");function A(l,h){if(o.isBuffer(l))return l.length;if(ArrayBuffer.isView(l)||Xe(l,ArrayBuffer))return l.byteLength;if(typeof l!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof l);let b=l.length,I=arguments.length>2&&arguments[2]===!0;if(!I&&b===0)return 0;let O=!1;for(;;)switch(h){case"ascii":case"latin1":case"binary":return b;case"utf8":case"utf-8":return yn(l).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b*2;case"hex":return b>>>1;case"base64":return Qi(l).length;default:if(O)return I?-1:yn(l).length;h=(""+h).toLowerCase(),O=!0}}w(A,"byteLength"),o.byteLength=A;function L(l,h,b){let I=!1;if((h===void 0||h<0)&&(h=0),h>this.length||((b===void 0||b>this.length)&&(b=this.length),b<=0)||(b>>>=0,h>>>=0,b<=h))return"";for(l||(l="utf8");;)switch(l){case"hex":return oe(this,h,b);case"utf8":case"utf-8":return M(this,h,b);case"ascii":return ne(this,h,b);case"latin1":case"binary":return he(this,h,b);case"base64":return K(this,h,b);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return We(this,h,b);default:if(I)throw new TypeError("Unknown encoding: "+l);l=(l+"").toLowerCase(),I=!0}}w(L,"slowToString"),o.prototype._isBuffer=!0;function k(l,h,b){let I=l[h];l[h]=l[b],l[b]=I}w(k,"swap"),o.prototype.swap16=w(function(){let l=this.length;if(l%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let h=0;h<l;h+=2)k(this,h,h+1);return this},"swap16"),o.prototype.swap32=w(function(){let l=this.length;if(l%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let h=0;h<l;h+=4)k(this,h,h+3),k(this,h+1,h+2);return this},"swap32"),o.prototype.swap64=w(function(){let l=this.length;if(l%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let h=0;h<l;h+=8)k(this,h,h+7),k(this,h+1,h+6),k(this,h+2,h+5),k(this,h+3,h+4);return this},"swap64"),o.prototype.toString=w(function(){let l=this.length;return l===0?"":arguments.length===0?M(this,0,l):L.apply(this,arguments)},"toString"),o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=w(function(l){if(!o.isBuffer(l))throw new TypeError("Argument must be a Buffer");return this===l?!0:o.compare(this,l)===0},"equals"),o.prototype.inspect=w(function(){let l="",h=s.INSPECT_MAX_BYTES;return l=this.toString("hex",0,h).replace(/(.{2})/g,"$1 ").trim(),this.length>h&&(l+=" ... "),"<Buffer "+l+">"},"inspect"),r&&(o.prototype[r]=o.prototype.inspect),o.prototype.compare=w(function(l,h,b,I,O){if(Xe(l,Uint8Array)&&(l=o.from(l,l.offset,l.byteLength)),!o.isBuffer(l))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof l);if(h===void 0&&(h=0),b===void 0&&(b=l?l.length:0),I===void 0&&(I=0),O===void 0&&(O=this.length),h<0||b>l.length||I<0||O>this.length)throw new RangeError("out of range index");if(I>=O&&h>=b)return 0;if(I>=O)return-1;if(h>=b)return 1;if(h>>>=0,b>>>=0,I>>>=0,O>>>=0,this===l)return 0;let D=O-I,U=b-h,de=Math.min(D,U),Re=this.slice(I,O),ye=l.slice(h,b);for(let me=0;me<de;++me)if(Re[me]!==ye[me]){D=Re[me],U=ye[me];break}return D<U?-1:U<D?1:0},"compare");function x(l,h,b,I,O){if(l.length===0)return-1;if(typeof b=="string"?(I=b,b=0):b>2147483647?b=2147483647:b<-2147483648&&(b=-2147483648),b=+b,bn(b)&&(b=O?0:l.length-1),b<0&&(b=l.length+b),b>=l.length){if(O)return-1;b=l.length-1}else if(b<0)if(O)b=0;else return-1;if(typeof h=="string"&&(h=o.from(h,I)),o.isBuffer(h))return h.length===0?-1:T(l,h,b,I,O);if(typeof h=="number")return h=h&255,typeof Uint8Array.prototype.indexOf=="function"?O?Uint8Array.prototype.indexOf.call(l,h,b):Uint8Array.prototype.lastIndexOf.call(l,h,b):T(l,[h],b,I,O);throw new TypeError("val must be string, number or Buffer")}w(x,"bidirectionalIndexOf");function T(l,h,b,I,O){let D=1,U=l.length,de=h.length;if(I!==void 0&&(I=String(I).toLowerCase(),I==="ucs2"||I==="ucs-2"||I==="utf16le"||I==="utf-16le")){if(l.length<2||h.length<2)return-1;D=2,U/=2,de/=2,b/=2}function Re(me,Se){return D===1?me[Se]:me.readUInt16BE(Se*D)}w(Re,"read");let ye;if(O){let me=-1;for(ye=b;ye<U;ye++)if(Re(l,ye)===Re(h,me===-1?0:ye-me)){if(me===-1&&(me=ye),ye-me+1===de)return me*D}else me!==-1&&(ye-=ye-me),me=-1}else for(b+de>U&&(b=U-de),ye=b;ye>=0;ye--){let me=!0;for(let Se=0;Se<de;Se++)if(Re(l,ye+Se)!==Re(h,Se)){me=!1;break}if(me)return ye}return-1}w(T,"arrayIndexOf"),o.prototype.includes=w(function(l,h,b){return this.indexOf(l,h,b)!==-1},"includes"),o.prototype.indexOf=w(function(l,h,b){return x(this,l,h,b,!0)},"indexOf"),o.prototype.lastIndexOf=w(function(l,h,b){return x(this,l,h,b,!1)},"lastIndexOf");function P(l,h,b,I){b=Number(b)||0;let O=l.length-b;I?(I=Number(I),I>O&&(I=O)):I=O;let D=h.length;I>D/2&&(I=D/2);let U;for(U=0;U<I;++U){let de=parseInt(h.substr(U*2,2),16);if(bn(de))return U;l[b+U]=de}return U}w(P,"hexWrite");function C(l,h,b,I){return Ss(yn(h,l.length-b),l,b,I)}w(C,"utf8Write");function B(l,h,b,I){return Ss(Ul(h),l,b,I)}w(B,"asciiWrite");function $(l,h,b,I){return Ss(Qi(h),l,b,I)}w($,"base64Write");function H(l,h,b,I){return Ss(Wl(h,l.length-b),l,b,I)}w(H,"ucs2Write"),o.prototype.write=w(function(l,h,b,I){if(h===void 0)I="utf8",b=this.length,h=0;else if(b===void 0&&typeof h=="string")I=h,b=this.length,h=0;else if(isFinite(h))h=h>>>0,isFinite(b)?(b=b>>>0,I===void 0&&(I="utf8")):(I=b,b=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let O=this.length-h;if((b===void 0||b>O)&&(b=O),l.length>0&&(b<0||h<0)||h>this.length)throw new RangeError("Attempt to write outside buffer bounds");I||(I="utf8");let D=!1;for(;;)switch(I){case"hex":return P(this,l,h,b);case"utf8":case"utf-8":return C(this,l,h,b);case"ascii":case"latin1":case"binary":return B(this,l,h,b);case"base64":return $(this,l,h,b);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return H(this,l,h,b);default:if(D)throw new TypeError("Unknown encoding: "+I);I=(""+I).toLowerCase(),D=!0}},"write"),o.prototype.toJSON=w(function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},"toJSON");function K(l,h,b){return h===0&&b===l.length?e.fromByteArray(l):e.fromByteArray(l.slice(h,b))}w(K,"base64Slice");function M(l,h,b){b=Math.min(l.length,b);let I=[],O=h;for(;O<b;){let D=l[O],U=null,de=D>239?4:D>223?3:D>191?2:1;if(O+de<=b){let Re,ye,me,Se;switch(de){case 1:D<128&&(U=D);break;case 2:Re=l[O+1],(Re&192)===128&&(Se=(D&31)<<6|Re&63,Se>127&&(U=Se));break;case 3:Re=l[O+1],ye=l[O+2],(Re&192)===128&&(ye&192)===128&&(Se=(D&15)<<12|(Re&63)<<6|ye&63,Se>2047&&(Se<55296||Se>57343)&&(U=Se));break;case 4:Re=l[O+1],ye=l[O+2],me=l[O+3],(Re&192)===128&&(ye&192)===128&&(me&192)===128&&(Se=(D&15)<<18|(Re&63)<<12|(ye&63)<<6|me&63,Se>65535&&Se<1114112&&(U=Se))}}U===null?(U=65533,de=1):U>65535&&(U-=65536,I.push(U>>>10&1023|55296),U=56320|U&1023),I.push(U),O+=de}return te(I)}w(M,"utf8Slice");var j=4096;function te(l){let h=l.length;if(h<=j)return String.fromCharCode.apply(String,l);let b="",I=0;for(;I<h;)b+=String.fromCharCode.apply(String,l.slice(I,I+=j));return b}w(te,"decodeCodePointsArray");function ne(l,h,b){let I="";b=Math.min(l.length,b);for(let O=h;O<b;++O)I+=String.fromCharCode(l[O]&127);return I}w(ne,"asciiSlice");function he(l,h,b){let I="";b=Math.min(l.length,b);for(let O=h;O<b;++O)I+=String.fromCharCode(l[O]);return I}w(he,"latin1Slice");function oe(l,h,b){let I=l.length;(!h||h<0)&&(h=0),(!b||b<0||b>I)&&(b=I);let O="";for(let D=h;D<b;++D)O+=Sf[l[D]];return O}w(oe,"hexSlice");function We(l,h,b){let I=l.slice(h,b),O="";for(let D=0;D<I.length-1;D+=2)O+=String.fromCharCode(I[D]+I[D+1]*256);return O}w(We,"utf16leSlice"),o.prototype.slice=w(function(l,h){let b=this.length;l=~~l,h=h===void 0?b:~~h,l<0?(l+=b,l<0&&(l=0)):l>b&&(l=b),h<0?(h+=b,h<0&&(h=0)):h>b&&(h=b),h<l&&(h=l);let I=this.subarray(l,h);return Object.setPrototypeOf(I,o.prototype),I},"slice");function pe(l,h,b){if(l%1!==0||l<0)throw new RangeError("offset is not uint");if(l+h>b)throw new RangeError("Trying to access beyond buffer length")}w(pe,"checkOffset"),o.prototype.readUintLE=o.prototype.readUIntLE=w(function(l,h,b){l=l>>>0,h=h>>>0,b||pe(l,h,this.length);let I=this[l],O=1,D=0;for(;++D<h&&(O*=256);)I+=this[l+D]*O;return I},"readUIntLE"),o.prototype.readUintBE=o.prototype.readUIntBE=w(function(l,h,b){l=l>>>0,h=h>>>0,b||pe(l,h,this.length);let I=this[l+--h],O=1;for(;h>0&&(O*=256);)I+=this[l+--h]*O;return I},"readUIntBE"),o.prototype.readUint8=o.prototype.readUInt8=w(function(l,h){return l=l>>>0,h||pe(l,1,this.length),this[l]},"readUInt8"),o.prototype.readUint16LE=o.prototype.readUInt16LE=w(function(l,h){return l=l>>>0,h||pe(l,2,this.length),this[l]|this[l+1]<<8},"readUInt16LE"),o.prototype.readUint16BE=o.prototype.readUInt16BE=w(function(l,h){return l=l>>>0,h||pe(l,2,this.length),this[l]<<8|this[l+1]},"readUInt16BE"),o.prototype.readUint32LE=o.prototype.readUInt32LE=w(function(l,h){return l=l>>>0,h||pe(l,4,this.length),(this[l]|this[l+1]<<8|this[l+2]<<16)+this[l+3]*16777216},"readUInt32LE"),o.prototype.readUint32BE=o.prototype.readUInt32BE=w(function(l,h){return l=l>>>0,h||pe(l,4,this.length),this[l]*16777216+(this[l+1]<<16|this[l+2]<<8|this[l+3])},"readUInt32BE"),o.prototype.readBigUInt64LE=mt(w(function(l){l=l>>>0,zt(l,"offset");let h=this[l],b=this[l+7];(h===void 0||b===void 0)&&Sr(l,this.length-8);let I=h+this[++l]*2**8+this[++l]*2**16+this[++l]*2**24,O=this[++l]+this[++l]*2**8+this[++l]*2**16+b*2**24;return BigInt(I)+(BigInt(O)<<BigInt(32))},"readBigUInt64LE")),o.prototype.readBigUInt64BE=mt(w(function(l){l=l>>>0,zt(l,"offset");let h=this[l],b=this[l+7];(h===void 0||b===void 0)&&Sr(l,this.length-8);let I=h*2**24+this[++l]*2**16+this[++l]*2**8+this[++l],O=this[++l]*2**24+this[++l]*2**16+this[++l]*2**8+b;return(BigInt(I)<<BigInt(32))+BigInt(O)},"readBigUInt64BE")),o.prototype.readIntLE=w(function(l,h,b){l=l>>>0,h=h>>>0,b||pe(l,h,this.length);let I=this[l],O=1,D=0;for(;++D<h&&(O*=256);)I+=this[l+D]*O;return O*=128,I>=O&&(I-=Math.pow(2,8*h)),I},"readIntLE"),o.prototype.readIntBE=w(function(l,h,b){l=l>>>0,h=h>>>0,b||pe(l,h,this.length);let I=h,O=1,D=this[l+--I];for(;I>0&&(O*=256);)D+=this[l+--I]*O;return O*=128,D>=O&&(D-=Math.pow(2,8*h)),D},"readIntBE"),o.prototype.readInt8=w(function(l,h){return l=l>>>0,h||pe(l,1,this.length),this[l]&128?(255-this[l]+1)*-1:this[l]},"readInt8"),o.prototype.readInt16LE=w(function(l,h){l=l>>>0,h||pe(l,2,this.length);let b=this[l]|this[l+1]<<8;return b&32768?b|4294901760:b},"readInt16LE"),o.prototype.readInt16BE=w(function(l,h){l=l>>>0,h||pe(l,2,this.length);let b=this[l+1]|this[l]<<8;return b&32768?b|4294901760:b},"readInt16BE"),o.prototype.readInt32LE=w(function(l,h){return l=l>>>0,h||pe(l,4,this.length),this[l]|this[l+1]<<8|this[l+2]<<16|this[l+3]<<24},"readInt32LE"),o.prototype.readInt32BE=w(function(l,h){return l=l>>>0,h||pe(l,4,this.length),this[l]<<24|this[l+1]<<16|this[l+2]<<8|this[l+3]},"readInt32BE"),o.prototype.readBigInt64LE=mt(w(function(l){l=l>>>0,zt(l,"offset");let h=this[l],b=this[l+7];(h===void 0||b===void 0)&&Sr(l,this.length-8);let I=this[l+4]+this[l+5]*2**8+this[l+6]*2**16+(b<<24);return(BigInt(I)<<BigInt(32))+BigInt(h+this[++l]*2**8+this[++l]*2**16+this[++l]*2**24)},"readBigInt64LE")),o.prototype.readBigInt64BE=mt(w(function(l){l=l>>>0,zt(l,"offset");let h=this[l],b=this[l+7];(h===void 0||b===void 0)&&Sr(l,this.length-8);let I=(h<<24)+this[++l]*2**16+this[++l]*2**8+this[++l];return(BigInt(I)<<BigInt(32))+BigInt(this[++l]*2**24+this[++l]*2**16+this[++l]*2**8+b)},"readBigInt64BE")),o.prototype.readFloatLE=w(function(l,h){return l=l>>>0,h||pe(l,4,this.length),t.read(this,l,!0,23,4)},"readFloatLE"),o.prototype.readFloatBE=w(function(l,h){return l=l>>>0,h||pe(l,4,this.length),t.read(this,l,!1,23,4)},"readFloatBE"),o.prototype.readDoubleLE=w(function(l,h){return l=l>>>0,h||pe(l,8,this.length),t.read(this,l,!0,52,8)},"readDoubleLE"),o.prototype.readDoubleBE=w(function(l,h){return l=l>>>0,h||pe(l,8,this.length),t.read(this,l,!1,52,8)},"readDoubleBE");function Ee(l,h,b,I,O,D){if(!o.isBuffer(l))throw new TypeError('"buffer" argument must be a Buffer instance');if(h>O||h<D)throw new RangeError('"value" argument is out of bounds');if(b+I>l.length)throw new RangeError("Index out of range")}w(Ee,"checkInt"),o.prototype.writeUintLE=o.prototype.writeUIntLE=w(function(l,h,b,I){if(l=+l,h=h>>>0,b=b>>>0,!I){let U=Math.pow(2,8*b)-1;Ee(this,l,h,b,U,0)}let O=1,D=0;for(this[h]=l&255;++D<b&&(O*=256);)this[h+D]=l/O&255;return h+b},"writeUIntLE"),o.prototype.writeUintBE=o.prototype.writeUIntBE=w(function(l,h,b,I){if(l=+l,h=h>>>0,b=b>>>0,!I){let U=Math.pow(2,8*b)-1;Ee(this,l,h,b,U,0)}let O=b-1,D=1;for(this[h+O]=l&255;--O>=0&&(D*=256);)this[h+O]=l/D&255;return h+b},"writeUIntBE"),o.prototype.writeUint8=o.prototype.writeUInt8=w(function(l,h,b){return l=+l,h=h>>>0,b||Ee(this,l,h,1,255,0),this[h]=l&255,h+1},"writeUInt8"),o.prototype.writeUint16LE=o.prototype.writeUInt16LE=w(function(l,h,b){return l=+l,h=h>>>0,b||Ee(this,l,h,2,65535,0),this[h]=l&255,this[h+1]=l>>>8,h+2},"writeUInt16LE"),o.prototype.writeUint16BE=o.prototype.writeUInt16BE=w(function(l,h,b){return l=+l,h=h>>>0,b||Ee(this,l,h,2,65535,0),this[h]=l>>>8,this[h+1]=l&255,h+2},"writeUInt16BE"),o.prototype.writeUint32LE=o.prototype.writeUInt32LE=w(function(l,h,b){return l=+l,h=h>>>0,b||Ee(this,l,h,4,4294967295,0),this[h+3]=l>>>24,this[h+2]=l>>>16,this[h+1]=l>>>8,this[h]=l&255,h+4},"writeUInt32LE"),o.prototype.writeUint32BE=o.prototype.writeUInt32BE=w(function(l,h,b){return l=+l,h=h>>>0,b||Ee(this,l,h,4,4294967295,0),this[h]=l>>>24,this[h+1]=l>>>16,this[h+2]=l>>>8,this[h+3]=l&255,h+4},"writeUInt32BE");function ws(l,h,b,I,O){qi(h,I,O,l,b,7);let D=Number(h&BigInt(4294967295));l[b++]=D,D=D>>8,l[b++]=D,D=D>>8,l[b++]=D,D=D>>8,l[b++]=D;let U=Number(h>>BigInt(32)&BigInt(4294967295));return l[b++]=U,U=U>>8,l[b++]=U,U=U>>8,l[b++]=U,U=U>>8,l[b++]=U,b}w(ws,"wrtBigUInt64LE");function _s(l,h,b,I,O){qi(h,I,O,l,b,7);let D=Number(h&BigInt(4294967295));l[b+7]=D,D=D>>8,l[b+6]=D,D=D>>8,l[b+5]=D,D=D>>8,l[b+4]=D;let U=Number(h>>BigInt(32)&BigInt(4294967295));return l[b+3]=U,U=U>>8,l[b+2]=U,U=U>>8,l[b+1]=U,U=U>>8,l[b]=U,b+8}w(_s,"wrtBigUInt64BE"),o.prototype.writeBigUInt64LE=mt(w(function(l,h=0){return ws(this,l,h,BigInt(0),BigInt("0xffffffffffffffff"))},"writeBigUInt64LE")),o.prototype.writeBigUInt64BE=mt(w(function(l,h=0){return _s(this,l,h,BigInt(0),BigInt("0xffffffffffffffff"))},"writeBigUInt64BE")),o.prototype.writeIntLE=w(function(l,h,b,I){if(l=+l,h=h>>>0,!I){let de=Math.pow(2,8*b-1);Ee(this,l,h,b,de-1,-de)}let O=0,D=1,U=0;for(this[h]=l&255;++O<b&&(D*=256);)l<0&&U===0&&this[h+O-1]!==0&&(U=1),this[h+O]=(l/D>>0)-U&255;return h+b},"writeIntLE"),o.prototype.writeIntBE=w(function(l,h,b,I){if(l=+l,h=h>>>0,!I){let de=Math.pow(2,8*b-1);Ee(this,l,h,b,de-1,-de)}let O=b-1,D=1,U=0;for(this[h+O]=l&255;--O>=0&&(D*=256);)l<0&&U===0&&this[h+O+1]!==0&&(U=1),this[h+O]=(l/D>>0)-U&255;return h+b},"writeIntBE"),o.prototype.writeInt8=w(function(l,h,b){return l=+l,h=h>>>0,b||Ee(this,l,h,1,127,-128),l<0&&(l=255+l+1),this[h]=l&255,h+1},"writeInt8"),o.prototype.writeInt16LE=w(function(l,h,b){return l=+l,h=h>>>0,b||Ee(this,l,h,2,32767,-32768),this[h]=l&255,this[h+1]=l>>>8,h+2},"writeInt16LE"),o.prototype.writeInt16BE=w(function(l,h,b){return l=+l,h=h>>>0,b||Ee(this,l,h,2,32767,-32768),this[h]=l>>>8,this[h+1]=l&255,h+2},"writeInt16BE"),o.prototype.writeInt32LE=w(function(l,h,b){return l=+l,h=h>>>0,b||Ee(this,l,h,4,2147483647,-2147483648),this[h]=l&255,this[h+1]=l>>>8,this[h+2]=l>>>16,this[h+3]=l>>>24,h+4},"writeInt32LE"),o.prototype.writeInt32BE=w(function(l,h,b){return l=+l,h=h>>>0,b||Ee(this,l,h,4,2147483647,-2147483648),l<0&&(l=4294967295+l+1),this[h]=l>>>24,this[h+1]=l>>>16,this[h+2]=l>>>8,this[h+3]=l&255,h+4},"writeInt32BE"),o.prototype.writeBigInt64LE=mt(w(function(l,h=0){return ws(this,l,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))},"writeBigInt64LE")),o.prototype.writeBigInt64BE=mt(w(function(l,h=0){return _s(this,l,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))},"writeBigInt64BE"));function Bi(l,h,b,I,O,D){if(b+I>l.length)throw new RangeError("Index out of range");if(b<0)throw new RangeError("Index out of range")}w(Bi,"checkIEEE754");function Mi(l,h,b,I,O){return h=+h,b=b>>>0,O||Bi(l,h,b,4,34028234663852886e22,-34028234663852886e22),t.write(l,h,b,I,23,4),b+4}w(Mi,"writeFloat"),o.prototype.writeFloatLE=w(function(l,h,b){return Mi(this,l,h,!0,b)},"writeFloatLE"),o.prototype.writeFloatBE=w(function(l,h,b){return Mi(this,l,h,!1,b)},"writeFloatBE");function Fi(l,h,b,I,O){return h=+h,b=b>>>0,O||Bi(l,h,b,8,17976931348623157e292,-17976931348623157e292),t.write(l,h,b,I,52,8),b+8}w(Fi,"writeDouble"),o.prototype.writeDoubleLE=w(function(l,h,b){return Fi(this,l,h,!0,b)},"writeDoubleLE"),o.prototype.writeDoubleBE=w(function(l,h,b){return Fi(this,l,h,!1,b)},"writeDoubleBE"),o.prototype.copy=w(function(l,h,b,I){if(!o.isBuffer(l))throw new TypeError("argument should be a Buffer");if(b||(b=0),!I&&I!==0&&(I=this.length),h>=l.length&&(h=l.length),h||(h=0),I>0&&I<b&&(I=b),I===b||l.length===0||this.length===0)return 0;if(h<0)throw new RangeError("targetStart out of bounds");if(b<0||b>=this.length)throw new RangeError("Index out of range");if(I<0)throw new RangeError("sourceEnd out of bounds");I>this.length&&(I=this.length),l.length-h<I-b&&(I=l.length-h+b);let O=I-b;return this===l&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(h,b,I):Uint8Array.prototype.set.call(l,this.subarray(b,I),h),O},"copy"),o.prototype.fill=w(function(l,h,b,I){if(typeof l=="string"){if(typeof h=="string"?(I=h,h=0,b=this.length):typeof b=="string"&&(I=b,b=this.length),I!==void 0&&typeof I!="string")throw new TypeError("encoding must be a string");if(typeof I=="string"&&!o.isEncoding(I))throw new TypeError("Unknown encoding: "+I);if(l.length===1){let D=l.charCodeAt(0);(I==="utf8"&&D<128||I==="latin1")&&(l=D)}}else typeof l=="number"?l=l&255:typeof l=="boolean"&&(l=Number(l));if(h<0||this.length<h||this.length<b)throw new RangeError("Out of range index");if(b<=h)return this;h=h>>>0,b=b===void 0?this.length:b>>>0,l||(l=0);let O;if(typeof l=="number")for(O=h;O<b;++O)this[O]=l;else{let D=o.isBuffer(l)?l:o.from(l,I),U=D.length;if(U===0)throw new TypeError('The value "'+l+'" is invalid for argument "value"');for(O=0;O<b-h;++O)this[O+h]=D[O%U]}return this},"fill");var _r={};function gn(l,h,b){var I;_r[l]=(I=class extends b{constructor(){super(),Object.defineProperty(this,"message",{value:h.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${l}]`,this.stack,delete this.name}get code(){return l}set code(O){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:O,writable:!0})}toString(){return`${this.name} [${l}]: ${this.message}`}},w(I,"NodeError"),I)}w(gn,"E"),gn("ERR_BUFFER_OUT_OF_BOUNDS",function(l){return l?`${l} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),gn("ERR_INVALID_ARG_TYPE",function(l,h){return`The "${l}" argument must be of type number. Received type ${typeof h}`},TypeError),gn("ERR_OUT_OF_RANGE",function(l,h,b){let I=`The value of "${l}" is out of range.`,O=b;return Number.isInteger(b)&&Math.abs(b)>2**32?O=Di(String(b)):typeof b=="bigint"&&(O=String(b),(b>BigInt(2)**BigInt(32)||b<-(BigInt(2)**BigInt(32)))&&(O=Di(O)),O+="n"),I+=` It must be ${h}. Received ${O}`,I},RangeError);function Di(l){let h="",b=l.length,I=l[0]==="-"?1:0;for(;b>=I+4;b-=3)h=`_${l.slice(b-3,b)}${h}`;return`${l.slice(0,b)}${h}`}w(Di,"addNumericalSeparator");function Ql(l,h,b){zt(h,"offset"),(l[h]===void 0||l[h+b]===void 0)&&Sr(h,l.length-(b+1))}w(Ql,"checkBounds");function qi(l,h,b,I,O,D){if(l>b||l<h){let U=typeof h=="bigint"?"n":"",de;throw D>3?h===0||h===BigInt(0)?de=`>= 0${U} and < 2${U} ** ${(D+1)*8}${U}`:de=`>= -(2${U} ** ${(D+1)*8-1}${U}) and < 2 ** ${(D+1)*8-1}${U}`:de=`>= ${h}${U} and <= ${b}${U}`,new _r.ERR_OUT_OF_RANGE("value",de,l)}Ql(I,O,D)}w(qi,"checkIntBI");function zt(l,h){if(typeof l!="number")throw new _r.ERR_INVALID_ARG_TYPE(h,"number",l)}w(zt,"validateNumber");function Sr(l,h,b){throw Math.floor(l)!==l?(zt(l,b),new _r.ERR_OUT_OF_RANGE(b||"offset","an integer",l)):h<0?new _r.ERR_BUFFER_OUT_OF_BOUNDS:new _r.ERR_OUT_OF_RANGE(b||"offset",`>= ${b?1:0} and <= ${h}`,l)}w(Sr,"boundsError");var _f=/[^+/0-9A-Za-z-_]/g;function jl(l){if(l=l.split("=")[0],l=l.trim().replace(_f,""),l.length<2)return"";for(;l.length%4!==0;)l=l+"=";return l}w(jl,"base64clean");function yn(l,h){h=h||1/0;let b,I=l.length,O=null,D=[];for(let U=0;U<I;++U){if(b=l.charCodeAt(U),b>55295&&b<57344){if(!O){if(b>56319){(h-=3)>-1&&D.push(239,191,189);continue}else if(U+1===I){(h-=3)>-1&&D.push(239,191,189);continue}O=b;continue}if(b<56320){(h-=3)>-1&&D.push(239,191,189),O=b;continue}b=(O-55296<<10|b-56320)+65536}else O&&(h-=3)>-1&&D.push(239,191,189);if(O=null,b<128){if((h-=1)<0)break;D.push(b)}else if(b<2048){if((h-=2)<0)break;D.push(b>>6|192,b&63|128)}else if(b<65536){if((h-=3)<0)break;D.push(b>>12|224,b>>6&63|128,b&63|128)}else if(b<1114112){if((h-=4)<0)break;D.push(b>>18|240,b>>12&63|128,b>>6&63|128,b&63|128)}else throw new Error("Invalid code point")}return D}w(yn,"utf8ToBytes");function Ul(l){let h=[];for(let b=0;b<l.length;++b)h.push(l.charCodeAt(b)&255);return h}w(Ul,"asciiToBytes");function Wl(l,h){let b,I,O,D=[];for(let U=0;U<l.length&&!((h-=2)<0);++U)b=l.charCodeAt(U),I=b>>8,O=b%256,D.push(O),D.push(I);return D}w(Wl,"utf16leToBytes");function Qi(l){return e.toByteArray(jl(l))}w(Qi,"base64ToBytes");function Ss(l,h,b,I){let O;for(O=0;O<I&&!(O+b>=h.length||O>=l.length);++O)h[O+b]=l[O];return O}w(Ss,"blitBuffer");function Xe(l,h){return l instanceof h||l!=null&&l.constructor!=null&&l.constructor.name!=null&&l.constructor.name===h.name}w(Xe,"isInstance");function bn(l){return l!==l}w(bn,"numberIsNaN");var Sf=function(){let l="0123456789abcdef",h=new Array(256);for(let b=0;b<16;++b){let I=b*16;for(let O=0;O<16;++O)h[I+O]=l[b]+l[O]}return h}();function mt(l){return typeof BigInt>"u"?Vl:l}w(mt,"defineBigIntMethod");function Vl(){throw new Error("BigInt not supported")}w(Vl,"BufferBigIntNotDefined")}),Dn,Da,Vf,re,le,Y=je(()=>{"use strict";Dn=globalThis,Da=globalThis.setImmediate??(s=>setTimeout(s,0)),Vf=globalThis.clearImmediate??(s=>clearTimeout(s)),re=typeof globalThis.Buffer=="function"&&typeof globalThis.Buffer.allocUnsafe=="function"?globalThis.Buffer:Wf().Buffer,le=globalThis.process??{},le.env??(le.env={});try{le.nextTick(()=>{})}catch{let s=Promise.resolve();le.nextTick=s.then.bind(s)}}),Xt=ce((s,e)=>{"use strict";Y();var t=typeof Reflect=="object"?Reflect:null,r=t&&typeof t.apply=="function"?t.apply:w(function(x,T,P){return Function.prototype.apply.call(x,T,P)},"ReflectApply"),n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=w(function(x){return Object.getOwnPropertyNames(x).concat(Object.getOwnPropertySymbols(x))},"ReflectOwnKeys"):n=w(function(x){return Object.getOwnPropertyNames(x)},"ReflectOwnKeys");function i(x){console&&console.warn&&console.warn(x)}w(i,"ProcessEmitWarning");var a=Number.isNaN||w(function(x){return x!==x},"NumberIsNaN");function o(){o.init.call(this)}w(o,"EventEmitter"),e.exports=o,e.exports.once=A,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var u=10;function y(x){if(typeof x!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof x)}w(y,"checkListener"),Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:w(function(){return u},"get"),set:w(function(x){if(typeof x!="number"||x<0||a(x))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+x+".");u=x},"set")}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=w(function(x){if(typeof x!="number"||x<0||a(x))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+x+".");return this._maxListeners=x,this},"setMaxListeners");function f(x){return x._maxListeners===void 0?o.defaultMaxListeners:x._maxListeners}w(f,"_getMaxListeners"),o.prototype.getMaxListeners=w(function(){return f(this)},"getMaxListeners"),o.prototype.emit=w(function(x){for(var T=[],P=1;P<arguments.length;P++)T.push(arguments[P]);var C=x==="error",B=this._events;if(B!==void 0)C=C&&B.error===void 0;else if(!C)return!1;if(C){var $;if(T.length>0&&($=T[0]),$ instanceof Error)throw $;var H=new Error("Unhandled error."+($?" ("+$.message+")":""));throw H.context=$,H}var K=B[x];if(K===void 0)return!1;if(typeof K=="function")r(K,this,T);else for(var M=K.length,j=_(K,M),P=0;P<M;++P)r(j[P],this,T);return!0},"emit");function p(x,T,P,C){var B,$,H;if(y(P),$=x._events,$===void 0?($=x._events=Object.create(null),x._eventsCount=0):($.newListener!==void 0&&(x.emit("newListener",T,P.listener?P.listener:P),$=x._events),H=$[T]),H===void 0)H=$[T]=P,++x._eventsCount;else if(typeof H=="function"?H=$[T]=C?[P,H]:[H,P]:C?H.unshift(P):H.push(P),B=f(x),B>0&&H.length>B&&!H.warned){H.warned=!0;var K=new Error("Possible EventEmitter memory leak detected. "+H.length+" "+String(T)+" listeners added. Use emitter.setMaxListeners() to increase limit");K.name="MaxListenersExceededWarning",K.emitter=x,K.type=T,K.count=H.length,i(K)}return x}w(p,"_addListener"),o.prototype.addListener=w(function(x,T){return p(this,x,T,!1)},"addListener"),o.prototype.on=o.prototype.addListener,o.prototype.prependListener=w(function(x,T){return p(this,x,T,!0)},"prependListener");function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}w(d,"onceWrapper");function m(x,T,P){var C={fired:!1,wrapFn:void 0,target:x,type:T,listener:P},B=d.bind(C);return B.listener=P,C.wrapFn=B,B}w(m,"_onceWrap"),o.prototype.once=w(function(x,T){return y(T),this.on(x,m(this,x,T)),this},"once"),o.prototype.prependOnceListener=w(function(x,T){return y(T),this.prependListener(x,m(this,x,T)),this},"prependOnceListener"),o.prototype.removeListener=w(function(x,T){var P,C,B,$,H;if(y(T),C=this._events,C===void 0)return this;if(P=C[x],P===void 0)return this;if(P===T||P.listener===T)--this._eventsCount===0?this._events=Object.create(null):(delete C[x],C.removeListener&&this.emit("removeListener",x,P.listener||T));else if(typeof P!="function"){for(B=-1,$=P.length-1;$>=0;$--)if(P[$]===T||P[$].listener===T){H=P[$].listener,B=$;break}if(B<0)return this;B===0?P.shift():S(P,B),P.length===1&&(C[x]=P[0]),C.removeListener!==void 0&&this.emit("removeListener",x,H||T)}return this},"removeListener"),o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=w(function(x){var T,P,C;if(P=this._events,P===void 0)return this;if(P.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):P[x]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete P[x]),this;if(arguments.length===0){var B=Object.keys(P),$;for(C=0;C<B.length;++C)$=B[C],$!=="removeListener"&&this.removeAllListeners($);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(T=P[x],typeof T=="function")this.removeListener(x,T);else if(T!==void 0)for(C=T.length-1;C>=0;C--)this.removeListener(x,T[C]);return this},"removeAllListeners");function g(x,T,P){var C=x._events;if(C===void 0)return[];var B=C[T];return B===void 0?[]:typeof B=="function"?P?[B.listener||B]:[B]:P?v(B):_(B,B.length)}w(g,"_listeners"),o.prototype.listeners=w(function(x){return g(this,x,!0)},"listeners"),o.prototype.rawListeners=w(function(x){return g(this,x,!1)},"rawListeners"),o.listenerCount=function(x,T){return typeof x.listenerCount=="function"?x.listenerCount(T):c.call(x,T)},o.prototype.listenerCount=c;function c(x){var T=this._events;if(T!==void 0){var P=T[x];if(typeof P=="function")return 1;if(P!==void 0)return P.length}return 0}w(c,"listenerCount"),o.prototype.eventNames=w(function(){return this._eventsCount>0?n(this._events):[]},"eventNames");function _(x,T){for(var P=new Array(T),C=0;C<T;++C)P[C]=x[C];return P}w(_,"arrayClone");function S(x,T){for(;T+1<x.length;T++)x[T]=x[T+1];x.pop()}w(S,"spliceOne");function v(x){for(var T=new Array(x.length),P=0;P<T.length;++P)T[P]=x[P].listener||x[P];return T}w(v,"unwrapListeners");function A(x,T){return new Promise(function(P,C){function B(H){x.removeListener(T,$),C(H)}w(B,"errorListener");function $(){typeof x.removeListener=="function"&&x.removeListener("error",B),P([].slice.call(arguments))}w($,"resolver"),k(x,T,$,{once:!0}),T!=="error"&&L(x,B,{once:!0})})}w(A,"once");function L(x,T,P){typeof x.on=="function"&&k(x,"error",T,P)}w(L,"addErrorHandlerIfEventEmitter");function k(x,T,P,C){if(typeof x.on=="function")C.once?x.once(T,P):x.on(T,P);else if(typeof x.addEventListener=="function")x.addEventListener(T,w(function B($){C.once&&x.removeEventListener(T,B),P($)},"wrapListener"));else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof x)}w(k,"eventTargetAgnosticAddListener")}),wu={};et(wu,{Socket:()=>js,isIP:()=>_u});function _u(s){return 0}var fu,$a,Ds,js,Us=je(()=>{"use strict";Y(),fu=Gt(Xt(),1),w(_u,"isIP"),$a=/^[^.]+\./,Ds=class ee extends fu.EventEmitter{constructor(){super(...arguments),se(this,"opts",{}),se(this,"connecting",!1),se(this,"pending",!0),se(this,"writable",!0),se(this,"encrypted",!1),se(this,"authorized",!1),se(this,"destroyed",!1),se(this,"ws",null),se(this,"writeBuffer"),se(this,"tlsState",0),se(this,"tlsRead"),se(this,"tlsWrite")}static get poolQueryViaFetch(){return ee.opts.poolQueryViaFetch??ee.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ee.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ee.opts.fetchEndpoint??ee.defaults.fetchEndpoint}static set fetchEndpoint(e){ee.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ee.opts.fetchFunction??ee.defaults.fetchFunction}static set fetchFunction(e){ee.opts.fetchFunction=e}static get webSocketConstructor(){return ee.opts.webSocketConstructor??ee.defaults.webSocketConstructor}static set webSocketConstructor(e){ee.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ee.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ee.opts.wsProxy??ee.defaults.wsProxy}static set wsProxy(e){ee.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ee.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ee.opts.coalesceWrites??ee.defaults.coalesceWrites}static set coalesceWrites(e){ee.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ee.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ee.opts.useSecureWebSocket??ee.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ee.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ee.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ee.opts.forceDisablePgSSL??ee.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ee.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ee.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ee.opts.disableSNI??ee.defaults.disableSNI}static set disableSNI(e){ee.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ee.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get disableWarningInBrowsers(){return ee.opts.disableWarningInBrowsers??ee.defaults.disableWarningInBrowsers}static set disableWarningInBrowsers(e){ee.opts.disableWarningInBrowsers=e}get disableWarningInBrowsers(){return this.opts.disableWarningInBrowsers??ee.disableWarningInBrowsers}set disableWarningInBrowsers(e){this.opts.disableWarningInBrowsers=e}static get pipelineConnect(){return ee.opts.pipelineConnect??ee.defaults.pipelineConnect}static set pipelineConnect(e){ee.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ee.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ee.opts.subtls??ee.defaults.subtls}static set subtls(e){ee.opts.subtls=e}get subtls(){return this.opts.subtls??ee.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ee.opts.pipelineTLS??ee.defaults.pipelineTLS}static set pipelineTLS(e){ee.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ee.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ee.opts.rootCerts??ee.defaults.rootCerts}static set rootCerts(e){ee.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ee.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,t){let r=this.wsProxy;if(r===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof r=="function"?r(e,t):`${r}?address=${e}:${t}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,t,r){this.connecting=!0,r&&this.once("connect",r);let n=w(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),i=w((o,u=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",y=>{this.emit("error",y),this.emit("close")}),o.addEventListener("message",y=>{if(this.tlsState===0){let f=re.from(y.data);this.emit("data",f)}}),o.addEventListener("close",()=>{this.emit("close")}),u?n():o.addEventListener("open",n)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(t,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),i(this.ws);else try{this.ws=new WebSocket(o),i(this.ws)}catch{this.ws=new __unstable_WebSocket(o),i(this.ws)}}catch(o){let u=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(u,{headers:{Upgrade:"websocket"}}).then(y=>{if(this.ws=y.webSocket,this.ws==null)throw o;this.ws.accept(),i(this.ws,!0)}).catch(y=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${y}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let t=await this.subtls.TrustedCert.databaseFromPEM(this.rootCerts),r=new this.subtls.WebSocketReadQueue(this.ws),n=r.read.bind(r),i=this.rawWrite.bind(this),{read:a,write:o}=await this.subtls.startTls(e,t,n,i,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let t=re.from(e);this.emit("data",t)}}}rawWrite(e){if(!this.coalesceWrites){this.ws&&this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws&&this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let t=new Uint8Array(this.writeBuffer.length+e.length);t.set(this.writeBuffer),t.set(e,this.writeBuffer.length),this.writeBuffer=t}}write(e,t="utf8",r=n=>{}){return e.length===0?(r(),!0):(typeof e=="string"&&(e=re.from(e,t)),this.tlsState===0?(this.rawWrite(e),r()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,t,r)}):(this.tlsWrite(e),r()),!0)}end(e=re.alloc(0),t="utf8",r=()=>{}){return this.write(e,t,()=>{this.ws.close(),r()}),this}destroy(){return this.destroyed=!0,this.end()}},w(Ds,"Socket"),se(Ds,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:w((s,e,t)=>{let r;return t?.jwtAuth?r=s.replace($a,"apiauth."):r=s.replace($a,"api."),"https://"+r+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:w(s=>s+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1,disableWarningInBrowsers:!1}),se(Ds,"opts",{}),js=Ds}),Su={};et(Su,{parse:()=>qa});function qa(s,e=!1){let{protocol:t}=new URL(s),r="http:"+s.substring(t.length),{username:n,password:i,host:a,hostname:o,port:u,pathname:y,search:f,searchParams:p,hash:d}=new URL(r);i=decodeURIComponent(i),n=decodeURIComponent(n),y=decodeURIComponent(y);let m=n+":"+i,g=e?Object.fromEntries(p.entries()):f;return{href:s,protocol:t,auth:m,username:n,password:i,host:a,hostname:o,port:u,pathname:y,search:f,query:g,hash:d}}var vu=je(()=>{"use strict";Y(),w(qa,"parse")}),xu=ce(s=>{"use strict";Y(),s.parse=function(n,i){return new t(n,i).parse()};var e=class Au{constructor(i,a){this.source=i,this.transform=a||r,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var i=this.source[this.position++];return i==="\\"?{value:this.source[this.position++],escaped:!0}:{value:i,escaped:!1}}record(i){this.recorded.push(i)}newEntry(i){var a;(this.recorded.length>0||i)&&(a=this.recorded.join(""),a==="NULL"&&!i&&(a=null),a!==null&&(a=this.transform(a)),this.entries.push(a),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var i=this.nextCharacter();if(i.value==="=")break}}parse(i){var a,o,u;for(this.consumeDimensions();!this.isEof();)if(a=this.nextCharacter(),a.value==="{"&&!u)this.dimension++,this.dimension>1&&(o=new Au(this.source.substr(this.position-1),this.transform),this.entries.push(o.parse(!0)),this.position+=o.position-2);else if(a.value==="}"&&!u){if(this.dimension--,!this.dimension&&(this.newEntry(),i))return this.entries}else a.value==='"'&&!a.escaped?(u&&this.newEntry(!0),u=!u):a.value===","&&!u?this.newEntry():this.record(a.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};w(e,"ArrayParser");var t=e;function r(n){return n}w(r,"identity")}),Cu=ce((s,e)=>{Y();var t=xu();e.exports={create:w(function(r,n){return{parse:w(function(){return t.parse(r,n)},"parse")}},"create")}}),zf=ce((s,e)=>{"use strict";Y();var t=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,r=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,n=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,i=/^-?infinity$/;e.exports=w(function(f){if(i.test(f))return Number(f.replace("i","I"));var p=t.exec(f);if(!p)return a(f)||null;var d=!!p[8],m=parseInt(p[1],10);d&&(m=u(m));var g=parseInt(p[2],10)-1,c=p[3],_=parseInt(p[4],10),S=parseInt(p[5],10),v=parseInt(p[6],10),A=p[7];A=A?1e3*parseFloat(A):0;var L,k=o(f);return k!=null?(L=new Date(Date.UTC(m,g,c,_,S,v,A)),y(m)&&L.setUTCFullYear(m),k!==0&&L.setTime(L.getTime()-k)):(L=new Date(m,g,c,_,S,v,A),y(m)&&L.setFullYear(m)),L},"parseDate");function a(f){var p=r.exec(f);if(p){var d=parseInt(p[1],10),m=!!p[4];m&&(d=u(d));var g=parseInt(p[2],10)-1,c=p[3],_=new Date(d,g,c);return y(d)&&_.setFullYear(d),_}}w(a,"getDate");function o(f){if(f.endsWith("+00"))return 0;var p=n.exec(f.split(" ")[1]);if(p){var d=p[1];if(d==="Z")return 0;var m=d==="-"?-1:1,g=parseInt(p[2],10)*3600+parseInt(p[3]||0,10)*60+parseInt(p[4]||0,10);return g*m*1e3}}w(o,"timeZoneOffset");function u(f){return-(f-1)}w(u,"bcYearToNegativeYear");function y(f){return f>=0&&f<100}w(y,"is0To99")}),Kf=ce((s,e)=>{Y(),e.exports=r;var t=Object.prototype.hasOwnProperty;function r(n){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var o in a)t.call(a,o)&&(n[o]=a[o])}return n}w(r,"extend")}),Hf=ce((s,e)=>{"use strict";Y();var t=Kf();e.exports=r;function r(v){if(!(this instanceof r))return new r(v);t(this,S(v))}w(r,"PostgresInterval");var n=["seconds","minutes","hours","days","months","years"];r.prototype.toPostgres=function(){var v=n.filter(this.hasOwnProperty,this);return this.milliseconds&&v.indexOf("seconds")<0&&v.push("seconds"),v.length===0?"0":v.map(function(A){var L=this[A]||0;return A==="seconds"&&this.milliseconds&&(L=(L+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),L+" "+A},this).join(" ")};var i={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},a=["years","months","days"],o=["hours","minutes","seconds"];r.prototype.toISOString=r.prototype.toISO=function(){var v=a.map(L,this).join(""),A=o.map(L,this).join("");return"P"+v+"T"+A;function L(k){var x=this[k]||0;return k==="seconds"&&this.milliseconds&&(x=(x+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),x+i[k]}};var u="([+-]?\\d+)",y=u+"\\s+years?",f=u+"\\s+mons?",p=u+"\\s+days?",d="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",m=new RegExp([y,f,p,d].map(function(v){return"("+v+")?"}).join("\\s*")),g={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},c=["hours","minutes","seconds","milliseconds"];function _(v){var A=v+"000000".slice(v.length);return parseInt(A,10)/1e3}w(_,"parseMilliseconds");function S(v){if(!v)return{};var A=m.exec(v),L=A[8]==="-";return Object.keys(g).reduce(function(k,x){var T=g[x],P=A[T];return!P||(P=x==="milliseconds"?_(P):parseInt(P,10),!P)||(L&&~c.indexOf(x)&&(P*=-1),k[x]=P),k},{})}w(S,"parse")}),Jf=ce((s,e)=>{"use strict";Y(),e.exports=w(function(t){if(/^\\x/.test(t))return new re(t.substr(2),"hex");for(var r="",n=0;n<t.length;)if(t[n]!=="\\")r+=t[n],++n;else if(/[0-7]{3}/.test(t.substr(n+1,3)))r+=String.fromCharCode(parseInt(t.substr(n+1,3),8)),n+=4;else{for(var i=1;n+i<t.length&&t[n+i]==="\\";)i++;for(var a=0;a<Math.floor(i/2);++a)r+="\\";n+=Math.floor(i/2)*2}return new re(r,"binary")},"parseBytea")}),Gf=ce((s,e)=>{Y();var t=xu(),r=Cu(),n=zf(),i=Hf(),a=Jf();function o(C){return w(function(B){return B===null?B:C(B)},"nullAllowed")}w(o,"allowNull");function u(C){return C===null?C:C==="TRUE"||C==="t"||C==="true"||C==="y"||C==="yes"||C==="on"||C==="1"}w(u,"parseBool");function y(C){return C?t.parse(C,u):null}w(y,"parseBoolArray");function f(C){return parseInt(C,10)}w(f,"parseBaseTenInt");function p(C){return C?t.parse(C,o(f)):null}w(p,"parseIntegerArray");function d(C){return C?t.parse(C,o(function(B){return L(B).trim()})):null}w(d,"parseBigIntegerArray");var m=w(function(C){if(!C)return null;var B=r.create(C,function($){return $!==null&&($=x($)),$});return B.parse()},"parsePointArray"),g=w(function(C){if(!C)return null;var B=r.create(C,function($){return $!==null&&($=parseFloat($)),$});return B.parse()},"parseFloatArray"),c=w(function(C){if(!C)return null;var B=r.create(C);return B.parse()},"parseStringArray"),_=w(function(C){if(!C)return null;var B=r.create(C,function($){return $!==null&&($=n($)),$});return B.parse()},"parseDateArray"),S=w(function(C){if(!C)return null;var B=r.create(C,function($){return $!==null&&($=i($)),$});return B.parse()},"parseIntervalArray"),v=w(function(C){return C?t.parse(C,o(a)):null},"parseByteAArray"),A=w(function(C){return parseInt(C,10)},"parseInteger"),L=w(function(C){var B=String(C);return/^\d+$/.test(B)?B:C},"parseBigInteger"),k=w(function(C){return C?t.parse(C,o(JSON.parse)):null},"parseJsonArray"),x=w(function(C){return C[0]!=="("?null:(C=C.substring(1,C.length-1).split(","),{x:parseFloat(C[0]),y:parseFloat(C[1])})},"parsePoint"),T=w(function(C){if(C[0]!=="<"&&C[1]!=="(")return null;for(var B="(",$="",H=!1,K=2;K<C.length-1;K++){if(H||(B+=C[K]),C[K]===")"){H=!0;continue}else if(!H)continue;C[K]!==","&&($+=C[K])}var M=x(B);return M.radius=parseFloat($),M},"parseCircle"),P=w(function(C){C(20,L),C(21,A),C(23,A),C(26,A),C(700,parseFloat),C(701,parseFloat),C(16,u),C(1082,n),C(1114,n),C(1184,n),C(600,x),C(651,c),C(718,T),C(1e3,y),C(1001,v),C(1005,p),C(1007,p),C(1028,p),C(1016,d),C(1017,m),C(1021,g),C(1022,g),C(1231,g),C(1014,c),C(1015,c),C(1008,c),C(1009,c),C(1040,c),C(1041,c),C(1115,_),C(1182,_),C(1185,_),C(1186,i),C(1187,S),C(17,a),C(114,JSON.parse.bind(JSON)),C(3802,JSON.parse.bind(JSON)),C(199,k),C(3807,k),C(3907,c),C(2951,c),C(791,c),C(1183,c),C(1270,c)},"init");e.exports={init:P}}),Xf=ce((s,e)=>{"use strict";Y();var t=1e6;function r(n){var i=n.readInt32BE(0),a=n.readUInt32BE(4),o="";i<0&&(i=~i+(a===0),a=~a+1>>>0,o="-");var u="",y,f,p,d,m,g;{if(y=i%t,i=i/t>>>0,f=4294967296*y+a,a=f/t>>>0,p=""+(f-t*a),a===0&&i===0)return o+p+u;for(d="",m=6-p.length,g=0;g<m;g++)d+="0";u=d+p+u}{if(y=i%t,i=i/t>>>0,f=4294967296*y+a,a=f/t>>>0,p=""+(f-t*a),a===0&&i===0)return o+p+u;for(d="",m=6-p.length,g=0;g<m;g++)d+="0";u=d+p+u}{if(y=i%t,i=i/t>>>0,f=4294967296*y+a,a=f/t>>>0,p=""+(f-t*a),a===0&&i===0)return o+p+u;for(d="",m=6-p.length,g=0;g<m;g++)d+="0";u=d+p+u}return y=i%t,f=4294967296*y+a,p=""+f%t,o+p+u}w(r,"readInt8"),e.exports=r}),Yf=ce((s,e)=>{Y();var t=Xf(),r=w(function(c,_,S,v,A){S=S||0,v=v||!1,A=A||function(H,K,M){return H*Math.pow(2,M)+K};var L=S>>3,k=w(function(H){return v?~H&255:H},"inv"),x=255,T=8-S%8;_<T&&(x=255<<8-_&255,T=_),S&&(x=x>>S%8);var P=0;S%8+_>=8&&(P=A(0,k(c[L])&x,T));for(var C=_+S>>3,B=L+1;B<C;B++)P=A(P,k(c[B]),8);var $=(_+S)%8;return $>0&&(P=A(P,k(c[C])>>8-$,$)),P},"parseBits"),n=w(function(c,_,S){var v=Math.pow(2,S-1)-1,A=r(c,1),L=r(c,S,1);if(L===0)return 0;var k=1,x=w(function(P,C,B){P===0&&(P=1);for(var $=1;$<=B;$++)k/=2,(C&1<<B-$)>0&&(P+=k);return P},"parsePrecisionBits"),T=r(c,_,S+1,!1,x);return L==Math.pow(2,S+1)-1?T===0?A===0?1/0:-1/0:NaN:(A===0?1:-1)*Math.pow(2,L-v)*T},"parseFloatFromBits"),i=w(function(c){return r(c,1)==1?-1*(r(c,15,1,!0)+1):r(c,15,1)},"parseInt16"),a=w(function(c){return r(c,1)==1?-1*(r(c,31,1,!0)+1):r(c,31,1)},"parseInt32"),o=w(function(c){return n(c,23,8)},"parseFloat32"),u=w(function(c){return n(c,52,11)},"parseFloat64"),y=w(function(c){var _=r(c,16,32);if(_==49152)return NaN;for(var S=Math.pow(1e4,r(c,16,16)),v=0,A=[],L=r(c,16),k=0;k<L;k++)v+=r(c,16,64+16*k)*S,S/=1e4;var x=Math.pow(10,r(c,16,48));return(_===0?1:-1)*Math.round(v*x)/x},"parseNumeric"),f=w(function(c,_){var S=r(_,1),v=r(_,63,1),A=new Date((S===0?1:-1)*v/1e3+9466848e5);return c||A.setTime(A.getTime()+A.getTimezoneOffset()*6e4),A.usec=v%1e3,A.getMicroSeconds=function(){return this.usec},A.setMicroSeconds=function(L){this.usec=L},A.getUTCMicroSeconds=function(){return this.usec},A},"parseDate"),p=w(function(c){for(var _=r(c,32),S=r(c,32,32),v=r(c,32,64),A=96,L=[],k=0;k<_;k++)L[k]=r(c,32,A),A+=32,A+=32;var x=w(function(P){var C=r(c,32,A);if(A+=32,C==4294967295)return null;var B;if(P==23||P==20)return B=r(c,C*8,A),A+=C*8,B;if(P==25)return B=c.toString(this.encoding,A>>3,(A+=C<<3)>>3),B;console.log("ERROR: ElementType not implemented: "+P)},"parseElement"),T=w(function(P,C){var B=[],$;if(P.length>1){var H=P.shift();for($=0;$<H;$++)B[$]=T(P,C);P.unshift(H)}else for($=0;$<P[0];$++)B[$]=x(C);return B},"parse");return T(L,v)},"parseArray"),d=w(function(c){return c.toString("utf8")},"parseText"),m=w(function(c){return c===null?null:r(c,8)>0},"parseBool"),g=w(function(c){c(20,t),c(21,i),c(23,a),c(26,a),c(1700,y),c(700,o),c(701,u),c(16,m),c(1114,f.bind(null,!1)),c(1184,f.bind(null,!0)),c(1e3,p),c(1007,p),c(1016,p),c(1008,p),c(1009,p),c(25,d)},"init");e.exports={init:g}}),Zf=ce((s,e)=>{Y(),e.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}}),qn=ce(s=>{Y();var e=Gf(),t=Yf(),r=Cu(),n=Zf();s.getTypeParser=o,s.setTypeParser=u,s.arrayParser=r,s.builtins=n;var i={text:{},binary:{}};function a(y){return String(y)}w(a,"noParse");function o(y,f){return f=f||"text",i[f]&&i[f][y]||a}w(o,"getTypeParser");function u(y,f,p){typeof f=="function"&&(p=f,f="text"),i[f][y]=p}w(u,"setTypeParser"),e.init(function(y,f){i.text[y]=f}),t.init(function(y,f){i.binary[y]=f})}),Qa=ce((s,e)=>{"use strict";Y();var t=qn();function r(n){this._types=n||t,this.text={},this.binary={}}w(r,"TypeOverrides"),r.prototype.getOverrides=function(n){switch(n){case"text":return this.text;case"binary":return this.binary;default:return{}}},r.prototype.setTypeParser=function(n,i,a){typeof i=="function"&&(a=i,i="text"),this.getOverrides(i)[n]=a},r.prototype.getTypeParser=function(n,i){return i=i||"text",this.getOverrides(i)[n]||this._types.getTypeParser(n,i)},e.exports=r});function Qs(s){let e=1779033703,t=3144134277,r=1013904242,n=2773480762,i=1359893119,a=2600822924,o=528734635,u=1541459225,y=0,f=0,p=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],d=w((v,A)=>v>>>A|v<<32-A,"rrot"),m=new Uint32Array(64),g=new Uint8Array(64),c=w(()=>{for(let B=0,$=0;B<16;B++,$+=4)m[B]=g[$]<<24|g[$+1]<<16|g[$+2]<<8|g[$+3];for(let B=16;B<64;B++){let $=d(m[B-15],7)^d(m[B-15],18)^m[B-15]>>>3,H=d(m[B-2],17)^d(m[B-2],19)^m[B-2]>>>10;m[B]=m[B-16]+$+m[B-7]+H|0}let v=e,A=t,L=r,k=n,x=i,T=a,P=o,C=u;for(let B=0;B<64;B++){let $=d(x,6)^d(x,11)^d(x,25),H=x&T^~x&P,K=C+$+H+p[B]+m[B]|0,M=d(v,2)^d(v,13)^d(v,22),j=v&A^v&L^A&L,te=M+j|0;C=P,P=T,T=x,x=k+K|0,k=L,L=A,A=v,v=K+te|0}e=e+v|0,t=t+A|0,r=r+L|0,n=n+k|0,i=i+x|0,a=a+T|0,o=o+P|0,u=u+C|0,f=0},"process"),_=w(v=>{typeof v=="string"&&(v=new TextEncoder().encode(v));for(let A=0;A<v.length;A++)g[f++]=v[A],f===64&&c();y+=v.length},"add"),S=w(()=>{if(g[f++]=128,f==64&&c(),f+8>64){for(;f<64;)g[f++]=0;c()}for(;f<58;)g[f++]=0;let v=y*8;g[f++]=v/1099511627776&255,g[f++]=v/4294967296&255,g[f++]=v>>>24,g[f++]=v>>>16&255,g[f++]=v>>>8&255,g[f++]=v&255,c();let A=new Uint8Array(32);return A[0]=e>>>24,A[1]=e>>>16&255,A[2]=e>>>8&255,A[3]=e&255,A[4]=t>>>24,A[5]=t>>>16&255,A[6]=t>>>8&255,A[7]=t&255,A[8]=r>>>24,A[9]=r>>>16&255,A[10]=r>>>8&255,A[11]=r&255,A[12]=n>>>24,A[13]=n>>>16&255,A[14]=n>>>8&255,A[15]=n&255,A[16]=i>>>24,A[17]=i>>>16&255,A[18]=i>>>8&255,A[19]=i&255,A[20]=a>>>24,A[21]=a>>>16&255,A[22]=a>>>8&255,A[23]=a&255,A[24]=o>>>24,A[25]=o>>>16&255,A[26]=o>>>8&255,A[27]=o&255,A[28]=u>>>24,A[29]=u>>>16&255,A[30]=u>>>8&255,A[31]=u&255,A},"digest");return s===void 0?{add:_,digest:S}:(_(s),S())}var ep=je(()=>{"use strict";Y(),w(Qs,"sha256")}),_t,Ba,tp=je(()=>{"use strict";Y(),_t=class Ge{constructor(){se(this,"_dataLength",0),se(this,"_bufferLength",0),se(this,"_state",new Int32Array(4)),se(this,"_buffer",new ArrayBuffer(68)),se(this,"_buffer8"),se(this,"_buffer32"),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashByteArray(e,t=!1){return this.onePassHasher.start().appendByteArray(e).end(t)}static hashStr(e,t=!1){return this.onePassHasher.start().appendStr(e).end(t)}static hashAsciiStr(e,t=!1){return this.onePassHasher.start().appendAsciiStr(e).end(t)}static _hex(e){let t=Ge.hexChars,r=Ge.hexOut,n,i,a,o;for(o=0;o<4;o+=1)for(i=o*8,n=e[o],a=0;a<8;a+=2)r[i+1+a]=t.charAt(n&15),n>>>=4,r[i+0+a]=t.charAt(n&15),n>>>=4;return r.join("")}static _md5cycle(e,t){let r=e[0],n=e[1],i=e[2],a=e[3];r+=(n&i|~n&a)+t[0]-680876936|0,r=(r<<7|r>>>25)+n|0,a+=(r&n|~r&i)+t[1]-389564586|0,a=(a<<12|a>>>20)+r|0,i+=(a&r|~a&n)+t[2]+606105819|0,i=(i<<17|i>>>15)+a|0,n+=(i&a|~i&r)+t[3]-1044525330|0,n=(n<<22|n>>>10)+i|0,r+=(n&i|~n&a)+t[4]-176418897|0,r=(r<<7|r>>>25)+n|0,a+=(r&n|~r&i)+t[5]+1200080426|0,a=(a<<12|a>>>20)+r|0,i+=(a&r|~a&n)+t[6]-1473231341|0,i=(i<<17|i>>>15)+a|0,n+=(i&a|~i&r)+t[7]-45705983|0,n=(n<<22|n>>>10)+i|0,r+=(n&i|~n&a)+t[8]+1770035416|0,r=(r<<7|r>>>25)+n|0,a+=(r&n|~r&i)+t[9]-1958414417|0,a=(a<<12|a>>>20)+r|0,i+=(a&r|~a&n)+t[10]-42063|0,i=(i<<17|i>>>15)+a|0,n+=(i&a|~i&r)+t[11]-1990404162|0,n=(n<<22|n>>>10)+i|0,r+=(n&i|~n&a)+t[12]+1804603682|0,r=(r<<7|r>>>25)+n|0,a+=(r&n|~r&i)+t[13]-40341101|0,a=(a<<12|a>>>20)+r|0,i+=(a&r|~a&n)+t[14]-1502002290|0,i=(i<<17|i>>>15)+a|0,n+=(i&a|~i&r)+t[15]+1236535329|0,n=(n<<22|n>>>10)+i|0,r+=(n&a|i&~a)+t[1]-165796510|0,r=(r<<5|r>>>27)+n|0,a+=(r&i|n&~i)+t[6]-1069501632|0,a=(a<<9|a>>>23)+r|0,i+=(a&n|r&~n)+t[11]+643717713|0,i=(i<<14|i>>>18)+a|0,n+=(i&r|a&~r)+t[0]-373897302|0,n=(n<<20|n>>>12)+i|0,r+=(n&a|i&~a)+t[5]-701558691|0,r=(r<<5|r>>>27)+n|0,a+=(r&i|n&~i)+t[10]+38016083|0,a=(a<<9|a>>>23)+r|0,i+=(a&n|r&~n)+t[15]-660478335|0,i=(i<<14|i>>>18)+a|0,n+=(i&r|a&~r)+t[4]-405537848|0,n=(n<<20|n>>>12)+i|0,r+=(n&a|i&~a)+t[9]+568446438|0,r=(r<<5|r>>>27)+n|0,a+=(r&i|n&~i)+t[14]-1019803690|0,a=(a<<9|a>>>23)+r|0,i+=(a&n|r&~n)+t[3]-187363961|0,i=(i<<14|i>>>18)+a|0,n+=(i&r|a&~r)+t[8]+1163531501|0,n=(n<<20|n>>>12)+i|0,r+=(n&a|i&~a)+t[13]-1444681467|0,r=(r<<5|r>>>27)+n|0,a+=(r&i|n&~i)+t[2]-51403784|0,a=(a<<9|a>>>23)+r|0,i+=(a&n|r&~n)+t[7]+1735328473|0,i=(i<<14|i>>>18)+a|0,n+=(i&r|a&~r)+t[12]-1926607734|0,n=(n<<20|n>>>12)+i|0,r+=(n^i^a)+t[5]-378558|0,r=(r<<4|r>>>28)+n|0,a+=(r^n^i)+t[8]-2022574463|0,a=(a<<11|a>>>21)+r|0,i+=(a^r^n)+t[11]+1839030562|0,i=(i<<16|i>>>16)+a|0,n+=(i^a^r)+t[14]-35309556|0,n=(n<<23|n>>>9)+i|0,r+=(n^i^a)+t[1]-1530992060|0,r=(r<<4|r>>>28)+n|0,a+=(r^n^i)+t[4]+1272893353|0,a=(a<<11|a>>>21)+r|0,i+=(a^r^n)+t[7]-155497632|0,i=(i<<16|i>>>16)+a|0,n+=(i^a^r)+t[10]-1094730640|0,n=(n<<23|n>>>9)+i|0,r+=(n^i^a)+t[13]+681279174|0,r=(r<<4|r>>>28)+n|0,a+=(r^n^i)+t[0]-358537222|0,a=(a<<11|a>>>21)+r|0,i+=(a^r^n)+t[3]-722521979|0,i=(i<<16|i>>>16)+a|0,n+=(i^a^r)+t[6]+76029189|0,n=(n<<23|n>>>9)+i|0,r+=(n^i^a)+t[9]-640364487|0,r=(r<<4|r>>>28)+n|0,a+=(r^n^i)+t[12]-421815835|0,a=(a<<11|a>>>21)+r|0,i+=(a^r^n)+t[15]+530742520|0,i=(i<<16|i>>>16)+a|0,n+=(i^a^r)+t[2]-995338651|0,n=(n<<23|n>>>9)+i|0,r+=(i^(n|~a))+t[0]-198630844|0,r=(r<<6|r>>>26)+n|0,a+=(n^(r|~i))+t[7]+1126891415|0,a=(a<<10|a>>>22)+r|0,i+=(r^(a|~n))+t[14]-1416354905|0,i=(i<<15|i>>>17)+a|0,n+=(a^(i|~r))+t[5]-57434055|0,n=(n<<21|n>>>11)+i|0,r+=(i^(n|~a))+t[12]+1700485571|0,r=(r<<6|r>>>26)+n|0,a+=(n^(r|~i))+t[3]-1894986606|0,a=(a<<10|a>>>22)+r|0,i+=(r^(a|~n))+t[10]-1051523|0,i=(i<<15|i>>>17)+a|0,n+=(a^(i|~r))+t[1]-2054922799|0,n=(n<<21|n>>>11)+i|0,r+=(i^(n|~a))+t[8]+1873313359|0,r=(r<<6|r>>>26)+n|0,a+=(n^(r|~i))+t[15]-30611744|0,a=(a<<10|a>>>22)+r|0,i+=(r^(a|~n))+t[6]-1560198380|0,i=(i<<15|i>>>17)+a|0,n+=(a^(i|~r))+t[13]+1309151649|0,n=(n<<21|n>>>11)+i|0,r+=(i^(n|~a))+t[4]-145523070|0,r=(r<<6|r>>>26)+n|0,a+=(n^(r|~i))+t[11]-1120210379|0,a=(a<<10|a>>>22)+r|0,i+=(r^(a|~n))+t[2]+718787259|0,i=(i<<15|i>>>17)+a|0,n+=(a^(i|~r))+t[9]-343485551|0,n=(n<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=a+e[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(Ge.stateIdentity),this}appendStr(e){let t=this._buffer8,r=this._buffer32,n=this._bufferLength,i,a;for(a=0;a<e.length;a+=1){if(i=e.charCodeAt(a),i<128)t[n++]=i;else if(i<2048)t[n++]=(i>>>6)+192,t[n++]=i&63|128;else if(i<55296||i>56319)t[n++]=(i>>>12)+224,t[n++]=i>>>6&63|128,t[n++]=i&63|128;else{if(i=(i-55296)*1024+(e.charCodeAt(++a)-56320)+65536,i>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");t[n++]=(i>>>18)+240,t[n++]=i>>>12&63|128,t[n++]=i>>>6&63|128,t[n++]=i&63|128}n>=64&&(this._dataLength+=64,Ge._md5cycle(this._state,r),n-=64,r[0]=r[16])}return this._bufferLength=n,this}appendAsciiStr(e){let t=this._buffer8,r=this._buffer32,n=this._bufferLength,i,a=0;for(;;){for(i=Math.min(e.length-a,64-n);i--;)t[n++]=e.charCodeAt(a++);if(n<64)break;this._dataLength+=64,Ge._md5cycle(this._state,r),n=0}return this._bufferLength=n,this}appendByteArray(e){let t=this._buffer8,r=this._buffer32,n=this._bufferLength,i,a=0;for(;;){for(i=Math.min(e.length-a,64-n);i--;)t[n++]=e[a++];if(n<64)break;this._dataLength+=64,Ge._md5cycle(this._state,r),n=0}return this._bufferLength=n,this}getState(){let e=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[e[0],e[1],e[2],e[3]]}}setState(e){let t=e.buffer,r=e.state,n=this._state,i;for(this._dataLength=e.length,this._bufferLength=e.buflen,n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],i=0;i<t.length;i+=1)this._buffer8[i]=t.charCodeAt(i)}end(e=!1){let t=this._bufferLength,r=this._buffer8,n=this._buffer32,i=(t>>2)+1;this._dataLength+=t;let a=this._dataLength*8;if(r[t]=128,r[t+1]=r[t+2]=r[t+3]=0,n.set(Ge.buffer32Identity.subarray(i),i),t>55&&(Ge._md5cycle(this._state,n),n.set(Ge.buffer32Identity)),a<=4294967295)n[14]=a;else{let o=a.toString(16).match(/(.*?)(.{0,8})$/);if(o===null)return;let u=parseInt(o[2],16),y=parseInt(o[1],16)||0;n[14]=u,n[15]=y}return Ge._md5cycle(this._state,n),e?this._state:Ge._hex(this._state)}},w(_t,"Md5"),se(_t,"stateIdentity",new Int32Array([1732584193,-271733879,-1732584194,271733878])),se(_t,"buffer32Identity",new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),se(_t,"hexChars","0123456789abcdef"),se(_t,"hexOut",[]),se(_t,"onePassHasher",new _t),Ba=_t}),ja={};et(ja,{createHash:()=>Pu,createHmac:()=>Tu,randomBytes:()=>Eu});function Eu(s){return crypto.getRandomValues(re.alloc(s))}function Pu(s){if(s==="sha256")return{update:w(function(e){return{digest:w(function(){return re.from(Qs(e))},"digest")}},"update")};if(s==="md5")return{update:w(function(e){return{digest:w(function(){return typeof e=="string"?Ba.hashStr(e):Ba.hashByteArray(e)},"digest")}},"update")};throw new Error(`Hash type '${s}' not supported`)}function Tu(s,e){if(s!=="sha256")throw new Error(`Only sha256 is supported (requested: '${s}')`);return{update:w(function(t){return{digest:w(function(){typeof e=="string"&&(e=new TextEncoder().encode(e)),typeof t=="string"&&(t=new TextEncoder().encode(t));let r=e.length;if(r>64)e=Qs(e);else if(r<64){let u=new Uint8Array(64);u.set(e),e=u}let n=new Uint8Array(64),i=new Uint8Array(64);for(let u=0;u<64;u++)n[u]=54^e[u],i[u]=92^e[u];let a=new Uint8Array(t.length+64);a.set(n,0),a.set(t,64);let o=new Uint8Array(96);return o.set(i,0),o.set(Qs(a),64),re.from(Qs(o))},"digest")}},"update")}}var Iu=je(()=>{"use strict";Y(),ep(),tp(),w(Eu,"randomBytes"),w(Pu,"createHash"),w(Tu,"createHmac")}),Qn=ce((s,e)=>{"use strict";Y(),e.exports={host:"localhost",user:le.platform==="win32"?le.env.USERNAME:le.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var t=qn(),r=t.getTypeParser(20,"text"),n=t.getTypeParser(1016,"text");e.exports.__defineSetter__("parseInt8",function(i){t.setTypeParser(20,"text",i?t.getTypeParser(23,"text"):r),t.setTypeParser(1016,"text",i?t.getTypeParser(1007,"text"):n)})}),jn=ce((s,e)=>{"use strict";Y();var t=(Iu(),Oe(ja)),r=Qn();function n(g){var c=g.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+c+'"'}w(n,"escapeElement");function i(g){for(var c="{",_=0;_<g.length;_++)_>0&&(c=c+","),g[_]===null||typeof g[_]>"u"?c=c+"NULL":Array.isArray(g[_])?c=c+i(g[_]):g[_]instanceof re?c+="\\\\x"+g[_].toString("hex"):c+=n(a(g[_]));return c=c+"}",c}w(i,"arrayString");var a=w(function(g,c){if(g==null)return null;if(g instanceof re)return g;if(ArrayBuffer.isView(g)){var _=re.from(g.buffer,g.byteOffset,g.byteLength);return _.length===g.byteLength?_:_.slice(g.byteOffset,g.byteOffset+g.byteLength)}return g instanceof Date?r.parseInputDatesAsUTC?f(g):y(g):Array.isArray(g)?i(g):typeof g=="object"?o(g,c):g.toString()},"prepareValue");function o(g,c){if(g&&typeof g.toPostgres=="function"){if(c=c||[],c.indexOf(g)!==-1)throw new Error('circular reference detected while preparing "'+g+'" for query');return c.push(g),a(g.toPostgres(a),c)}return JSON.stringify(g)}w(o,"prepareObject");function u(g,c){for(g=""+g;g.length<c;)g="0"+g;return g}w(u,"pad");function y(g){var c=-g.getTimezoneOffset(),_=g.getFullYear(),S=_<1;S&&(_=Math.abs(_)+1);var v=u(_,4)+"-"+u(g.getMonth()+1,2)+"-"+u(g.getDate(),2)+"T"+u(g.getHours(),2)+":"+u(g.getMinutes(),2)+":"+u(g.getSeconds(),2)+"."+u(g.getMilliseconds(),3);return c<0?(v+="-",c*=-1):v+="+",v+=u(Math.floor(c/60),2)+":"+u(c%60,2),S&&(v+=" BC"),v}w(y,"dateToString");function f(g){var c=g.getUTCFullYear(),_=c<1;_&&(c=Math.abs(c)+1);var S=u(c,4)+"-"+u(g.getUTCMonth()+1,2)+"-"+u(g.getUTCDate(),2)+"T"+u(g.getUTCHours(),2)+":"+u(g.getUTCMinutes(),2)+":"+u(g.getUTCSeconds(),2)+"."+u(g.getUTCMilliseconds(),3);return S+="+00:00",_&&(S+=" BC"),S}w(f,"dateToStringUTC");function p(g,c,_){return g=typeof g=="string"?{text:g}:g,c&&(typeof c=="function"?g.callback=c:g.values=c),_&&(g.callback=_),g}w(p,"normalizeQueryConfig");var d=w(function(g){return t.createHash("md5").update(g,"utf-8").digest("hex")},"md5"),m=w(function(g,c,_){var S=d(c+g),v=d(re.concat([re.from(S),_]));return"md5"+v},"postgresMd5PasswordHash");e.exports={prepareValue:w(function(g){return a(g)},"prepareValueWrapper"),normalizeQueryConfig:p,postgresMd5PasswordHash:m,md5:d}}),Ws={};et(Ws,{default:()=>Ru});var Ru,Un=je(()=>{"use strict";Y(),Ru={}}),rp=ce((s,e)=>{"use strict";Y();var t=(Iu(),Oe(ja));function r(c){if(c.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let _=t.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:_,response:"n,,n=*,r="+_,message:"SASLInitialResponse"}}w(r,"startSession");function n(c,_,S){if(c.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof _!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(typeof S!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let v=y(S);if(v.nonce.startsWith(c.clientNonce)){if(v.nonce.length===c.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var A=re.from(v.salt,"base64"),L=g(_,A,v.iteration),k=m(L,"Client Key"),x=d(k),T="n=*,r="+c.clientNonce,P="r="+v.nonce+",s="+v.salt+",i="+v.iteration,C="c=biws,r="+v.nonce,B=T+","+P+","+C,$=m(x,B),H=p(k,$),K=H.toString("base64"),M=m(L,"Server Key"),j=m(M,B);c.message="SASLResponse",c.serverSignature=j.toString("base64"),c.response=C+",p="+K}w(n,"continueSession");function i(c,_){if(c.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof _!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:S}=f(_);if(S!==c.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}w(i,"finalizeSession");function a(c){if(typeof c!="string")throw new TypeError("SASL: text must be a string");return c.split("").map((_,S)=>c.charCodeAt(S)).every(_=>_>=33&&_<=43||_>=45&&_<=126)}w(a,"isPrintableChars");function o(c){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(c)}w(o,"isBase64");function u(c){if(typeof c!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(c.split(",").map(_=>{if(!/^.=/.test(_))throw new Error("SASL: Invalid attribute pair entry");let S=_[0],v=_.substring(2);return[S,v]}))}w(u,"parseAttributePairs");function y(c){let _=u(c),S=_.get("r");if(S){if(!a(S))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let v=_.get("s");if(v){if(!o(v))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let A=_.get("i");if(A){if(!/^[1-9][0-9]*$/.test(A))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let L=parseInt(A,10);return{nonce:S,salt:v,iteration:L}}w(y,"parseServerFirstMessage");function f(c){let _=u(c).get("v");if(_){if(!o(_))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:_}}w(f,"parseServerFinalMessage");function p(c,_){if(!re.isBuffer(c))throw new TypeError("first argument must be a Buffer");if(!re.isBuffer(_))throw new TypeError("second argument must be a Buffer");if(c.length!==_.length)throw new Error("Buffer lengths must match");if(c.length===0)throw new Error("Buffers cannot be empty");return re.from(c.map((S,v)=>c[v]^_[v]))}w(p,"xorBuffers");function d(c){return t.createHash("sha256").update(c).digest()}w(d,"sha256");function m(c,_){return t.createHmac("sha256",c).update(_).digest()}w(m,"hmacSha256");function g(c,_,S){for(var v=m(c,re.concat([_,re.from([0,0,0,1])])),A=v,L=0;L<S-1;L++)v=m(c,v),A=p(A,v);return A}w(g,"Hi"),e.exports={startSession:r,continueSession:n,finalizeSession:i}}),Ua={};et(Ua,{join:()=>Ou});function Ou(...s){return s.join("/")}var Nu=je(()=>{"use strict";Y(),w(Ou,"join")}),Wa={};et(Wa,{stat:()=>Lu});function Lu(s,e){e(new Error("No filesystem"))}var $u=je(()=>{"use strict";Y(),w(Lu,"stat")}),Va={};et(Va,{default:()=>ku});var ku,Bu=je(()=>{"use strict";Y(),ku={}}),Mu={};et(Mu,{StringDecoder:()=>Fu});var ka,Fu,sp=je(()=>{"use strict";Y(),ka=class{constructor(e){se(this,"td"),this.td=new TextDecoder(e)}write(e){return this.td.decode(e,{stream:!0})}end(e){return this.td.decode(e)}},w(ka,"StringDecoder"),Fu=ka}),np=ce((s,e)=>{"use strict";Y();var{Transform:t}=(Bu(),Oe(Va)),{StringDecoder:r}=(sp(),Oe(Mu)),n=Symbol("last"),i=Symbol("decoder");function a(p,d,m){let g;if(this.overflow){if(g=this[i].write(p).split(this.matcher),g.length===1)return m();g.shift(),this.overflow=!1}else this[n]+=this[i].write(p),g=this[n].split(this.matcher);this[n]=g.pop();for(let c=0;c<g.length;c++)try{u(this,this.mapper(g[c]))}catch(_){return m(_)}if(this.overflow=this[n].length>this.maxLength,this.overflow&&!this.skipOverflow){m(new Error("maximum buffer reached"));return}m()}w(a,"transform");function o(p){if(this[n]+=this[i].end(),this[n])try{u(this,this.mapper(this[n]))}catch(d){return p(d)}p()}w(o,"flush");function u(p,d){d!==void 0&&p.push(d)}w(u,"push");function y(p){return p}w(y,"noop");function f(p,d,m){switch(p=p||/\r?\n/,d=d||y,m=m||{},arguments.length){case 1:typeof p=="function"?(d=p,p=/\r?\n/):typeof p=="object"&&!(p instanceof RegExp)&&!p[Symbol.split]&&(m=p,p=/\r?\n/);break;case 2:typeof p=="function"?(m=d,d=p,p=/\r?\n/):typeof d=="object"&&(m=d,d=y)}m=Object.assign({},m),m.autoDestroy=!0,m.transform=a,m.flush=o,m.readableObjectMode=!0;let g=new t(m);return g[n]="",g[i]=new r("utf8"),g.matcher=p,g.mapper=d,g.maxLength=m.maxLength,g.skipOverflow=m.skipOverflow||!1,g.overflow=!1,g._destroy=function(c,_){this._writableState.errorEmitted=!1,_(c)},g}w(f,"split"),e.exports=f}),ip=ce((s,e)=>{"use strict";Y();var t=(Nu(),Oe(Ua)),r=(Bu(),Oe(Va)).Stream,n=np(),i=(Un(),Oe(Ws)),a=5432,o=le.platform==="win32",u=le.stderr,y=56,f=7,p=61440,d=32768;function m(k){return(k&p)==d}w(m,"isRegFile");var g=["host","port","database","user","password"],c=g.length,_=g[c-1];function S(){var k=u instanceof r&&u.writable===!0;if(k){var x=Array.prototype.slice.call(arguments).concat(`
`);u.write(i.format.apply(i,x))}}w(S,"warn"),Object.defineProperty(e.exports,"isWin",{get:w(function(){return o},"get"),set:w(function(k){o=k},"set")}),e.exports.warnTo=function(k){var x=u;return u=k,x},e.exports.getFileName=function(k){var x=k||le.env,T=x.PGPASSFILE||(o?t.join(x.APPDATA||"./","postgresql","pgpass.conf"):t.join(x.HOME||"./",".pgpass"));return T},e.exports.usePgPass=function(k,x){return Object.prototype.hasOwnProperty.call(le.env,"PGPASSWORD")?!1:o?!0:(x=x||"<unkn>",m(k.mode)?k.mode&(y|f)?(S('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',x),!1):!0:(S('WARNING: password file "%s" is not a plain file',x),!1))};var v=e.exports.match=function(k,x){return g.slice(0,-1).reduce(function(T,P,C){return C==1&&Number(k[P]||a)===Number(x[P])?T&&!0:T&&(x[P]==="*"||x[P]===k[P])},!0)};e.exports.getPassword=function(k,x,T){var P,C=x.pipe(n());function B(K){var M=A(K);M&&L(M)&&v(k,M)&&(P=M[_],C.end())}w(B,"onLine");var $=w(function(){x.destroy(),T(P)},"onEnd"),H=w(function(K){x.destroy(),S("WARNING: error on reading file: %s",K),T(void 0)},"onErr");x.on("error",H),C.on("data",B).on("end",$).on("error",H)};var A=e.exports.parseLine=function(k){if(k.length<11||k.match(/^\s+#/))return null;for(var x="",T="",P=0,C=0,B=0,$={},H=!1,K=w(function(j,te,ne){var he=k.substring(te,ne);Object.hasOwnProperty.call(le.env,"PGPASS_NO_DEESCAPE")||(he=he.replace(/\\([:\\])/g,"$1")),$[g[j]]=he},"addToObj"),M=0;M<k.length-1;M+=1){if(x=k.charAt(M+1),T=k.charAt(M),H=P==c-1,H){K(P,C);break}M>=0&&x==":"&&T!=="\\"&&(K(P,C,M+1),C=M+2,P+=1)}return $=Object.keys($).length===c?$:null,$},L=e.exports.isValidEntry=function(k){for(var x={0:function($){return $.length>0},1:function($){return $==="*"?!0:($=Number($),isFinite($)&&$>0&&$<9007199254740992&&Math.floor($)===$)},2:function($){return $.length>0},3:function($){return $.length>0},4:function($){return $.length>0}},T=0;T<g.length;T+=1){var P=x[T],C=k[g[T]]||"",B=P(C);if(!B)return!1}return!0}}),op=ce((s,e)=>{"use strict";Y();var t=(Nu(),Oe(Ua)),r=($u(),Oe(Wa)),n=ip();e.exports=function(i,a){var o=n.getFileName();r.stat(o,function(u,y){if(u||!n.usePgPass(y,o))return a(void 0);var f=r.createReadStream(o);n.getPassword(i,f,a)})},e.exports.warnTo=n.warnTo}),Du={};et(Du,{default:()=>qu});var qu,ap=je(()=>{"use strict";Y(),qu={}}),lp=ce((s,e)=>{"use strict";Y();var t=(vu(),Oe(Su)),r=($u(),Oe(Wa));function n(i){if(i.charAt(0)==="/"){var o=i.split(" ");return{host:o[0],database:o[1]}}var a=t.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(i)?encodeURI(i).replace(/\%25(\d\d)/g,"%$1"):i,!0),o=a.query;for(var u in o)Array.isArray(o[u])&&(o[u]=o[u][o[u].length-1]);var y=(a.auth||":").split(":");if(o.user=y[0],o.password=y.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var f=a.pathname;if(!o.host&&f&&/^%2f/i.test(f)){var p=f.split("/");o.host=decodeURIComponent(p[0]),f=p.splice(1).join("/")}switch(f&&f.charAt(0)==="/"&&(f=f.slice(1)||null),o.database=f&&decodeURI(f),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=r.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=r.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=r.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}w(n,"parse"),e.exports=n,n.parse=n}),za=ce((s,e)=>{"use strict";Y();var t=(ap(),Oe(Du)),r=Qn(),n=lp().parse,i=w(function(p,d,m){return m===void 0?m=le.env["PG"+p.toUpperCase()]:m===!1||(m=le.env[m]),d[p]||m||r[p]},"val"),a=w(function(){switch(le.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return r.ssl},"readSSLConfigFromEnvironment"),o=w(function(p){return"'"+(""+p).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),u=w(function(p,d,m){var g=d[m];g!=null&&p.push(m+"="+o(g))},"add"),y=class{constructor(d){d=typeof d=="string"?n(d):d||{},d.connectionString&&(d=Object.assign({},d,n(d.connectionString))),this.user=i("user",d),this.database=i("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(i("port",d),10),this.host=i("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:i("password",d)}),this.binary=i("binary",d),this.options=i("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=i("client_encoding",d),this.replication=i("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=i("application_name",d,"PGAPPNAME"),this.fallback_application_name=i("fallback_application_name",d,!1),this.statement_timeout=i("statement_timeout",d,!1),this.lock_timeout=i("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=i("idle_in_transaction_session_timeout",d,!1),this.query_timeout=i("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=le.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var m=[];u(m,this,"user"),u(m,this,"password"),u(m,this,"port"),u(m,this,"application_name"),u(m,this,"fallback_application_name"),u(m,this,"connect_timeout"),u(m,this,"options");var g=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(u(m,g,"sslmode"),u(m,g,"sslca"),u(m,g,"sslkey"),u(m,g,"sslcert"),u(m,g,"sslrootcert"),this.database&&m.push("dbname="+o(this.database)),this.replication&&m.push("replication="+o(this.replication)),this.host&&m.push("host="+o(this.host)),this.isDomainSocket)return d(null,m.join(" "));this.client_encoding&&m.push("client_encoding="+o(this.client_encoding)),t.lookup(this.host,function(c,_){return c?d(c,null):(m.push("hostaddr="+o(_)),d(null,m.join(" ")))})}};w(y,"ConnectionParameters");var f=y;e.exports=f}),cp=ce((s,e)=>{"use strict";Y();var t=qn(),r=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,n=class{constructor(o,u){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=u,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var u;o.text?u=r.exec(o.text):u=r.exec(o.command),u&&(this.command=u[1],u[3]?(this.oid=parseInt(u[2],10),this.rowCount=parseInt(u[3],10)):u[2]&&(this.rowCount=parseInt(u[2],10)))}_parseRowAsArray(o){for(var u=new Array(o.length),y=0,f=o.length;y<f;y++){var p=o[y];p!==null?u[y]=this._parsers[y](p):u[y]=null}return u}parseRow(o){for(var u={},y=0,f=o.length;y<f;y++){var p=o[y],d=this.fields[y].name;p!==null?u[d]=this._parsers[y](p):u[d]=null}return u}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var u=0;u<o.length;u++){var y=o[u];this._types?this._parsers[u]=this._types.getTypeParser(y.dataTypeID,y.format||"text"):this._parsers[u]=t.getTypeParser(y.dataTypeID,y.format||"text")}}};w(n,"Result");var i=n;e.exports=i}),up=ce((s,e)=>{"use strict";Y();var{EventEmitter:t}=Xt(),r=cp(),n=jn(),i=class extends t{constructor(u,y,f){super(),u=n.normalizeQueryConfig(u,y,f),this.text=u.text,this.values=u.values,this.rows=u.rows,this.types=u.types,this.name=u.name,this.binary=u.binary,this.portal=u.portal||"",this.callback=u.callback,this._rowMode=u.rowMode,le.domain&&u.callback&&(this.callback=le.domain.bind(u.callback)),this._result=new r(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new r(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(u){this._checkForMultirow(),this._result.addFields(u.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(u){let y;if(!this._canceledDueToError){try{y=this._result.parseRow(u.fields)}catch(f){this._canceledDueToError=f;return}this.emit("row",y,this._result),this._accumulateRows&&this._result.addRow(y)}}handleCommandComplete(u,y){this._checkForMultirow(),this._result.addCommandComplete(u),this.rows&&y.sync()}handleEmptyQuery(u){this.rows&&u.sync()}handleError(u,y){if(this._canceledDueToError&&(u=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(u);this.emit("error",u)}handleReadyForQuery(u){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,u);if(this.callback)try{this.callback(null,this._results)}catch(y){le.nextTick(()=>{throw y})}this.emit("end",this._results)}submit(u){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let y=u.parsedStatements[this.name];return this.text&&y&&this.text!==y?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(u):u.query(this.text),null)}hasBeenParsed(u){return this.name&&u.parsedStatements[this.name]}handlePortalSuspended(u){this._getRows(u,this.rows)}_getRows(u,y){u.execute({portal:this.portal,rows:y}),y?u.flush():u.sync()}prepare(u){this.isPreparedStatement=!0,this.hasBeenParsed(u)||u.parse({text:this.text,name:this.name,types:this.types});try{u.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:n.prepareValue})}catch(y){this.handleError(y,u);return}u.describe({type:"P",name:this.portal||""}),this._getRows(u,this.rows)}handleCopyInResponse(u){u.sendCopyFail("No source stream defined")}handleCopyData(u,y){}};w(i,"Query");var a=i;e.exports=a}),Qu=ce(s=>{"use strict";Y(),Object.defineProperty(s,"__esModule",{value:!0}),s.NoticeMessage=s.DataRowMessage=s.CommandCompleteMessage=s.ReadyForQueryMessage=s.NotificationResponseMessage=s.BackendKeyDataMessage=s.AuthenticationMD5Password=s.ParameterStatusMessage=s.ParameterDescriptionMessage=s.RowDescriptionMessage=s.Field=s.CopyResponse=s.CopyDataMessage=s.DatabaseError=s.copyDone=s.emptyQuery=s.replicationStart=s.portalSuspended=s.noData=s.closeComplete=s.bindComplete=s.parseComplete=void 0,s.parseComplete={name:"parseComplete",length:5},s.bindComplete={name:"bindComplete",length:5},s.closeComplete={name:"closeComplete",length:5},s.noData={name:"noData",length:5},s.portalSuspended={name:"portalSuspended",length:5},s.replicationStart={name:"replicationStart",length:4},s.emptyQuery={name:"emptyQuery",length:4},s.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(M,j,te){super(M),this.length=j,this.name=te}};w(e,"DatabaseError");var t=e;s.DatabaseError=t;var r=class{constructor(M,j){this.length=M,this.chunk=j,this.name="copyData"}};w(r,"CopyDataMessage");var n=r;s.CopyDataMessage=n;var i=class{constructor(M,j,te,ne){this.length=M,this.name=j,this.binary=te,this.columnTypes=new Array(ne)}};w(i,"CopyResponse");var a=i;s.CopyResponse=a;var o=class{constructor(M,j,te,ne,he,oe,We){this.name=M,this.tableID=j,this.columnID=te,this.dataTypeID=ne,this.dataTypeSize=he,this.dataTypeModifier=oe,this.format=We}};w(o,"Field");var u=o;s.Field=u;var y=class{constructor(M,j){this.length=M,this.fieldCount=j,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};w(y,"RowDescriptionMessage");var f=y;s.RowDescriptionMessage=f;var p=class{constructor(M,j){this.length=M,this.parameterCount=j,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};w(p,"ParameterDescriptionMessage");var d=p;s.ParameterDescriptionMessage=d;var m=class{constructor(M,j,te){this.length=M,this.parameterName=j,this.parameterValue=te,this.name="parameterStatus"}};w(m,"ParameterStatusMessage");var g=m;s.ParameterStatusMessage=g;var c=class{constructor(M,j){this.length=M,this.salt=j,this.name="authenticationMD5Password"}};w(c,"AuthenticationMD5Password");var _=c;s.AuthenticationMD5Password=_;var S=class{constructor(M,j,te){this.length=M,this.processID=j,this.secretKey=te,this.name="backendKeyData"}};w(S,"BackendKeyDataMessage");var v=S;s.BackendKeyDataMessage=v;var A=class{constructor(M,j,te,ne){this.length=M,this.processId=j,this.channel=te,this.payload=ne,this.name="notification"}};w(A,"NotificationResponseMessage");var L=A;s.NotificationResponseMessage=L;var k=class{constructor(M,j){this.length=M,this.status=j,this.name="readyForQuery"}};w(k,"ReadyForQueryMessage");var x=k;s.ReadyForQueryMessage=x;var T=class{constructor(M,j){this.length=M,this.text=j,this.name="commandComplete"}};w(T,"CommandCompleteMessage");var P=T;s.CommandCompleteMessage=P;var C=class{constructor(M,j){this.length=M,this.fields=j,this.name="dataRow",this.fieldCount=j.length}};w(C,"DataRowMessage");var B=C;s.DataRowMessage=B;var $=class{constructor(M,j){this.length=M,this.message=j,this.name="notice"}};w($,"NoticeMessage");var H=$;s.NoticeMessage=H}),hp=ce(s=>{"use strict";Y(),Object.defineProperty(s,"__esModule",{value:!0}),s.Writer=void 0;var e=class{constructor(n=256){this.size=n,this.offset=5,this.headerPosition=0,this.buffer=re.allocUnsafe(n)}ensure(n){if(this.buffer.length-this.offset<n){let i=this.buffer,a=i.length+(i.length>>1)+n;this.buffer=re.allocUnsafe(a),i.copy(this.buffer)}}addInt32(n){return this.ensure(4),this.buffer[this.offset++]=n>>>24&255,this.buffer[this.offset++]=n>>>16&255,this.buffer[this.offset++]=n>>>8&255,this.buffer[this.offset++]=n>>>0&255,this}addInt16(n){return this.ensure(2),this.buffer[this.offset++]=n>>>8&255,this.buffer[this.offset++]=n>>>0&255,this}addCString(n){if(!n)this.ensure(1);else{let i=re.byteLength(n);this.ensure(i+1),this.buffer.write(n,this.offset,"utf-8"),this.offset+=i}return this.buffer[this.offset++]=0,this}addString(n=""){let i=re.byteLength(n);return this.ensure(i),this.buffer.write(n,this.offset),this.offset+=i,this}add(n){return this.ensure(n.length),n.copy(this.buffer,this.offset),this.offset+=n.length,this}join(n){if(n){this.buffer[this.headerPosition]=n;let i=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(i,this.headerPosition+1)}return this.buffer.slice(n?0:5,this.offset)}flush(n){let i=this.join(n);return this.offset=5,this.headerPosition=0,this.buffer=re.allocUnsafe(this.size),i}};w(e,"Writer");var t=e;s.Writer=t}),fp=ce(s=>{"use strict";Y(),Object.defineProperty(s,"__esModule",{value:!0}),s.serialize=void 0;var e=hp(),t=new e.Writer,r=w(M=>{t.addInt16(3).addInt16(0);for(let ne of Object.keys(M))t.addCString(ne).addCString(M[ne]);t.addCString("client_encoding").addCString("UTF8");let j=t.addCString("").flush(),te=j.length+4;return new e.Writer().addInt32(te).add(j).flush()},"startup"),n=w(()=>{let M=re.allocUnsafe(8);return M.writeInt32BE(8,0),M.writeInt32BE(80877103,4),M},"requestSsl"),i=w(M=>t.addCString(M).flush(112),"password"),a=w(function(M,j){return t.addCString(M).addInt32(re.byteLength(j)).addString(j),t.flush(112)},"sendSASLInitialResponseMessage"),o=w(function(M){return t.addString(M).flush(112)},"sendSCRAMClientFinalMessage"),u=w(M=>t.addCString(M).flush(81),"query"),y=[],f=w(M=>{let j=M.name||"";j.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",j,j.length),console.error("This can cause conflicts and silent errors executing queries"));let te=M.types||y,ne=te.length,he=t.addCString(j).addCString(M.text).addInt16(ne);for(let oe=0;oe<ne;oe++)he.addInt32(te[oe]);return t.flush(80)},"parse"),p=new e.Writer,d=w(function(M,j){for(let te=0;te<M.length;te++){let ne=j?j(M[te],te):M[te];ne==null?(t.addInt16(0),p.addInt32(-1)):ne instanceof re?(t.addInt16(1),p.addInt32(ne.length),p.add(ne)):(t.addInt16(0),p.addInt32(re.byteLength(ne)),p.addString(ne))}},"writeValues"),m=w((M={})=>{let j=M.portal||"",te=M.statement||"",ne=M.binary||!1,he=M.values||y,oe=he.length;return t.addCString(j).addCString(te),t.addInt16(oe),d(he,M.valueMapper),t.addInt16(oe),t.add(p.flush()),t.addInt16(ne?1:0),t.flush(66)},"bind"),g=re.from([69,0,0,0,9,0,0,0,0,0]),c=w(M=>{if(!M||!M.portal&&!M.rows)return g;let j=M.portal||"",te=M.rows||0,ne=re.byteLength(j),he=4+ne+1+4,oe=re.allocUnsafe(1+he);return oe[0]=69,oe.writeInt32BE(he,1),oe.write(j,5,"utf-8"),oe[ne+5]=0,oe.writeUInt32BE(te,oe.length-4),oe},"execute"),_=w((M,j)=>{let te=re.allocUnsafe(16);return te.writeInt32BE(16,0),te.writeInt16BE(1234,4),te.writeInt16BE(5678,6),te.writeInt32BE(M,8),te.writeInt32BE(j,12),te},"cancel"),S=w((M,j)=>{let te=4+re.byteLength(j)+1,ne=re.allocUnsafe(1+te);return ne[0]=M,ne.writeInt32BE(te,1),ne.write(j,5,"utf-8"),ne[te]=0,ne},"cstringMessage"),v=t.addCString("P").flush(68),A=t.addCString("S").flush(68),L=w(M=>M.name?S(68,`${M.type}${M.name||""}`):M.type==="P"?v:A,"describe"),k=w(M=>{let j=`${M.type}${M.name||""}`;return S(67,j)},"close"),x=w(M=>t.add(M).flush(100),"copyData"),T=w(M=>S(102,M),"copyFail"),P=w(M=>re.from([M,0,0,0,4]),"codeOnlyBuffer"),C=P(72),B=P(83),$=P(88),H=P(99),K={startup:r,password:i,requestSsl:n,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:u,parse:f,bind:m,execute:c,describe:L,close:k,flush:w(()=>C,"flush"),sync:w(()=>B,"sync"),end:w(()=>$,"end"),copyData:x,copyDone:w(()=>H,"copyDone"),copyFail:T,cancel:_};s.serialize=K}),pp=ce(s=>{"use strict";Y(),Object.defineProperty(s,"__esModule",{value:!0}),s.BufferReader=void 0;var e=re.allocUnsafe(0),t=class{constructor(i=0){this.offset=i,this.buffer=e,this.encoding="utf-8"}setBuffer(i,a){this.offset=i,this.buffer=a}int16(){let i=this.buffer.readInt16BE(this.offset);return this.offset+=2,i}byte(){let i=this.buffer[this.offset];return this.offset++,i}int32(){let i=this.buffer.readInt32BE(this.offset);return this.offset+=4,i}uint32(){let i=this.buffer.readUInt32BE(this.offset);return this.offset+=4,i}string(i){let a=this.buffer.toString(this.encoding,this.offset,this.offset+i);return this.offset+=i,a}cstring(){let i=this.offset,a=i;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,i,a-1)}bytes(i){let a=this.buffer.slice(this.offset,this.offset+i);return this.offset+=i,a}};w(t,"BufferReader");var r=t;s.BufferReader=r}),dp=ce(s=>{"use strict";Y(),Object.defineProperty(s,"__esModule",{value:!0}),s.Parser=void 0;var e=Qu(),t=pp(),r=1,n=4,i=r+n,a=re.allocUnsafe(0),o=class{constructor(f){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new t.BufferReader,f?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=f?.mode||"text"}parse(f,p){this.mergeBuffer(f);let d=this.bufferOffset+this.bufferLength,m=this.bufferOffset;for(;m+i<=d;){let g=this.buffer[m],c=this.buffer.readUInt32BE(m+r),_=r+c;if(_+m<=d){let S=this.handlePacket(m+i,g,c,this.buffer);p(S),m+=_}else break}m===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-m,this.bufferOffset=m)}mergeBuffer(f){if(this.bufferLength>0){let p=this.bufferLength+f.byteLength;if(p+this.bufferOffset>this.buffer.byteLength){let d;if(p<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let m=this.buffer.byteLength*2;for(;p>=m;)m*=2;d=re.allocUnsafe(m)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}f.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=p}else this.buffer=f,this.bufferOffset=0,this.bufferLength=f.byteLength}handlePacket(f,p,d,m){switch(p){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(f,d,m);case 67:return this.parseCommandCompleteMessage(f,d,m);case 90:return this.parseReadyForQueryMessage(f,d,m);case 65:return this.parseNotificationMessage(f,d,m);case 82:return this.parseAuthenticationResponse(f,d,m);case 83:return this.parseParameterStatusMessage(f,d,m);case 75:return this.parseBackendKeyData(f,d,m);case 69:return this.parseErrorMessage(f,d,m,"error");case 78:return this.parseErrorMessage(f,d,m,"notice");case 84:return this.parseRowDescriptionMessage(f,d,m);case 116:return this.parseParameterDescriptionMessage(f,d,m);case 71:return this.parseCopyInMessage(f,d,m);case 72:return this.parseCopyOutMessage(f,d,m);case 100:return this.parseCopyData(f,d,m);default:return new e.DatabaseError("received invalid response: "+p.toString(16),d,"error")}}parseReadyForQueryMessage(f,p,d){this.reader.setBuffer(f,d);let m=this.reader.string(1);return new e.ReadyForQueryMessage(p,m)}parseCommandCompleteMessage(f,p,d){this.reader.setBuffer(f,d);let m=this.reader.cstring();return new e.CommandCompleteMessage(p,m)}parseCopyData(f,p,d){let m=d.slice(f,f+(p-4));return new e.CopyDataMessage(p,m)}parseCopyInMessage(f,p,d){return this.parseCopyMessage(f,p,d,"copyInResponse")}parseCopyOutMessage(f,p,d){return this.parseCopyMessage(f,p,d,"copyOutResponse")}parseCopyMessage(f,p,d,m){this.reader.setBuffer(f,d);let g=this.reader.byte()!==0,c=this.reader.int16(),_=new e.CopyResponse(p,m,g,c);for(let S=0;S<c;S++)_.columnTypes[S]=this.reader.int16();return _}parseNotificationMessage(f,p,d){this.reader.setBuffer(f,d);let m=this.reader.int32(),g=this.reader.cstring(),c=this.reader.cstring();return new e.NotificationResponseMessage(p,m,g,c)}parseRowDescriptionMessage(f,p,d){this.reader.setBuffer(f,d);let m=this.reader.int16(),g=new e.RowDescriptionMessage(p,m);for(let c=0;c<m;c++)g.fields[c]=this.parseField();return g}parseField(){let f=this.reader.cstring(),p=this.reader.uint32(),d=this.reader.int16(),m=this.reader.uint32(),g=this.reader.int16(),c=this.reader.int32(),_=this.reader.int16()===0?"text":"binary";return new e.Field(f,p,d,m,g,c,_)}parseParameterDescriptionMessage(f,p,d){this.reader.setBuffer(f,d);let m=this.reader.int16(),g=new e.ParameterDescriptionMessage(p,m);for(let c=0;c<m;c++)g.dataTypeIDs[c]=this.reader.int32();return g}parseDataRowMessage(f,p,d){this.reader.setBuffer(f,d);let m=this.reader.int16(),g=new Array(m);for(let c=0;c<m;c++){let _=this.reader.int32();g[c]=_===-1?null:this.reader.string(_)}return new e.DataRowMessage(p,g)}parseParameterStatusMessage(f,p,d){this.reader.setBuffer(f,d);let m=this.reader.cstring(),g=this.reader.cstring();return new e.ParameterStatusMessage(p,m,g)}parseBackendKeyData(f,p,d){this.reader.setBuffer(f,d);let m=this.reader.int32(),g=this.reader.int32();return new e.BackendKeyDataMessage(p,m,g)}parseAuthenticationResponse(f,p,d){this.reader.setBuffer(f,d);let m=this.reader.int32(),g={name:"authenticationOk",length:p};switch(m){case 0:break;case 3:g.length===8&&(g.name="authenticationCleartextPassword");break;case 5:if(g.length===12){g.name="authenticationMD5Password";let c=this.reader.bytes(4);return new e.AuthenticationMD5Password(p,c)}break;case 10:{g.name="authenticationSASL",g.mechanisms=[];let c;do c=this.reader.cstring(),c&&g.mechanisms.push(c);while(c)}break;case 11:g.name="authenticationSASLContinue",g.data=this.reader.string(p-8);break;case 12:g.name="authenticationSASLFinal",g.data=this.reader.string(p-8);break;default:throw new Error("Unknown authenticationOk message type "+m)}return g}parseErrorMessage(f,p,d,m){this.reader.setBuffer(f,d);let g={},c=this.reader.string(1);for(;c!=="\0";)g[c]=this.reader.cstring(),c=this.reader.string(1);let _=g.M,S=m==="notice"?new e.NoticeMessage(p,_):new e.DatabaseError(_,p,m);return S.severity=g.S,S.code=g.C,S.detail=g.D,S.hint=g.H,S.position=g.P,S.internalPosition=g.p,S.internalQuery=g.q,S.where=g.W,S.schema=g.s,S.table=g.t,S.column=g.c,S.dataType=g.d,S.constraint=g.n,S.file=g.F,S.line=g.L,S.routine=g.R,S}};w(o,"Parser");var u=o;s.Parser=u}),ju=ce(s=>{"use strict";Y(),Object.defineProperty(s,"__esModule",{value:!0}),s.DatabaseError=s.serialize=s.parse=void 0;var e=Qu();Object.defineProperty(s,"DatabaseError",{enumerable:!0,get:w(function(){return e.DatabaseError},"get")});var t=fp();Object.defineProperty(s,"serialize",{enumerable:!0,get:w(function(){return t.serialize},"get")});var r=dp();function n(i,a){let o=new r.Parser;return i.on("data",u=>o.parse(u,a)),new Promise(u=>i.on("end",()=>u()))}w(n,"parse"),s.parse=n}),Uu={};et(Uu,{connect:()=>Wu});function Wu({socket:s,servername:e}){return s.startTls(e),s}var mp=je(()=>{"use strict";Y(),w(Wu,"connect")}),Vu=ce((s,e)=>{"use strict";Y();var t=(Us(),Oe(wu)),r=Xt().EventEmitter,{parse:n,serialize:i}=ju(),a=i.flush(),o=i.sync(),u=i.end(),y=class extends r{constructor(d){super(),d=d||{},this.stream=d.stream||new t.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var m=this;this.on("newListener",function(g){g==="message"&&(m._emitMessage=!0)})}connect(d,m){var g=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,m),this.stream.once("connect",function(){g._keepAlive&&g.stream.setKeepAlive(!0,g._keepAliveInitialDelayMillis),g.emit("connect")});let c=w(function(_){g._ending&&(_.code==="ECONNRESET"||_.code==="EPIPE")||g.emit("error",_)},"reportStreamError");if(this.stream.on("error",c),this.stream.on("close",function(){g.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(_){var S=_.toString("utf8");switch(S){case"S":break;case"N":return g.stream.end(),g.emit("error",new Error("The server does not support SSL connections"));default:return g.stream.end(),g.emit("error",new Error("There was an error establishing an SSL connection"))}var v=(mp(),Oe(Uu));let A={socket:g.stream};g.ssl!==!0&&(Object.assign(A,g.ssl),"key"in g.ssl&&(A.key=g.ssl.key)),t.isIP(m)===0&&(A.servername=m);try{g.stream=v.connect(A)}catch(L){return g.emit("error",L)}g.attachListeners(g.stream),g.stream.on("error",c),g.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),n(d,m=>{var g=m.name==="error"?"errorMessage":m.name;this._emitMessage&&this.emit("message",m),this.emit(g,m)})}requestSsl(){this.stream.write(i.requestSsl())}startup(d){this.stream.write(i.startup(d))}cancel(d,m){this._send(i.cancel(d,m))}password(d){this._send(i.password(d))}sendSASLInitialResponseMessage(d,m){this._send(i.sendSASLInitialResponseMessage(d,m))}sendSCRAMClientFinalMessage(d){this._send(i.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(i.query(d))}parse(d){this._send(i.parse(d))}bind(d){this._send(i.bind(d))}execute(d){this._send(i.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(u,()=>{this.stream.end()})}close(d){this._send(i.close(d))}describe(d){this._send(i.describe(d))}sendCopyFromChunk(d){this._send(i.copyData(d))}endCopyFrom(){this._send(i.copyDone())}sendCopyFail(d){this._send(i.copyFail(d))}};w(y,"Connection");var f=y;e.exports=f}),gp=ce((s,e)=>{"use strict";Y();var t=Xt().EventEmitter,r=(Un(),Oe(Ws)),n=jn(),i=rp(),a=op(),o=Qa(),u=za(),y=up(),f=Qn(),p=Vu(),d=class extends t{constructor(c){super(),this.connectionParameters=new u(c),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var _=c||{};this._Promise=_.Promise||Dn.Promise,this._types=new o(_.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=_.connection||new p({stream:_.stream,ssl:this.connectionParameters.ssl,keepAlive:_.keepAlive||!1,keepAliveInitialDelayMillis:_.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=_.binary||f.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=_.connectionTimeoutMillis||0}_errorAllQueries(c){let _=w(S=>{le.nextTick(()=>{S.handleError(c,this.connection)})},"enqueueError");this.activeQuery&&(_(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(_),this.queryQueue.length=0}_connect(c){var _=this,S=this.connection;if(this._connectionCallback=c,this._connecting||this._connected){let v=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{c(v)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{S._ending=!0,S.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?S.connect(this.host+"/.s.PGSQL."+this.port):S.connect(this.port,this.host),S.on("connect",function(){_.ssl?S.requestSsl():S.startup(_.getStartupConf())}),S.on("sslconnect",function(){S.startup(_.getStartupConf())}),this._attachListeners(S),S.once("end",()=>{let v=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(v),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(v):this._handleErrorEvent(v):this._connectionError||this._handleErrorEvent(v)),le.nextTick(()=>{this.emit("end")})})}connect(c){if(c){this._connect(c);return}return new this._Promise((_,S)=>{this._connect(v=>{v?S(v):_()})})}_attachListeners(c){c.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),c.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),c.on("authenticationSASL",this._handleAuthSASL.bind(this)),c.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),c.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),c.on("backendKeyData",this._handleBackendKeyData.bind(this)),c.on("error",this._handleErrorEvent.bind(this)),c.on("errorMessage",this._handleErrorMessage.bind(this)),c.on("readyForQuery",this._handleReadyForQuery.bind(this)),c.on("notice",this._handleNotice.bind(this)),c.on("rowDescription",this._handleRowDescription.bind(this)),c.on("dataRow",this._handleDataRow.bind(this)),c.on("portalSuspended",this._handlePortalSuspended.bind(this)),c.on("emptyQuery",this._handleEmptyQuery.bind(this)),c.on("commandComplete",this._handleCommandComplete.bind(this)),c.on("parseComplete",this._handleParseComplete.bind(this)),c.on("copyInResponse",this._handleCopyInResponse.bind(this)),c.on("copyData",this._handleCopyData.bind(this)),c.on("notification",this._handleNotification.bind(this))}_checkPgPass(c){let _=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(S=>{if(S!==void 0){if(typeof S!="string"){_.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=S}else this.connectionParameters.password=this.password=null;c()}).catch(S=>{_.emit("error",S)}):this.password!==null?c():a(this.connectionParameters,S=>{S!==void 0&&(this.connectionParameters.password=this.password=S),c()})}_handleAuthCleartextPassword(c){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(c){this._checkPgPass(()=>{let _=n.postgresMd5PasswordHash(this.user,this.password,c.salt);this.connection.password(_)})}_handleAuthSASL(c){this._checkPgPass(()=>{this.saslSession=i.startSession(c.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(c){i.continueSession(this.saslSession,this.password,c.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(c){i.finalizeSession(this.saslSession,c.data),this.saslSession=null}_handleBackendKeyData(c){this.processID=c.processID,this.secretKey=c.secretKey}_handleReadyForQuery(c){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:_}=this;this.activeQuery=null,this.readyForQuery=!0,_&&_.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(c){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(c);this.emit("error",c)}}_handleErrorEvent(c){if(this._connecting)return this._handleErrorWhileConnecting(c);this._queryable=!1,this._errorAllQueries(c),this.emit("error",c)}_handleErrorMessage(c){if(this._connecting)return this._handleErrorWhileConnecting(c);let _=this.activeQuery;if(!_){this._handleErrorEvent(c);return}this.activeQuery=null,_.handleError(c,this.connection)}_handleRowDescription(c){this.activeQuery.handleRowDescription(c)}_handleDataRow(c){this.activeQuery.handleDataRow(c)}_handlePortalSuspended(c){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(c){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(c){this.activeQuery.handleCommandComplete(c,this.connection)}_handleParseComplete(c){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(c){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(c){this.activeQuery.handleCopyData(c,this.connection)}_handleNotification(c){this.emit("notification",c)}_handleNotice(c){this.emit("notice",c)}getStartupConf(){var c=this.connectionParameters,_={user:c.user,database:c.database},S=c.application_name||c.fallback_application_name;return S&&(_.application_name=S),c.replication&&(_.replication=""+c.replication),c.statement_timeout&&(_.statement_timeout=String(parseInt(c.statement_timeout,10))),c.lock_timeout&&(_.lock_timeout=String(parseInt(c.lock_timeout,10))),c.idle_in_transaction_session_timeout&&(_.idle_in_transaction_session_timeout=String(parseInt(c.idle_in_transaction_session_timeout,10))),c.options&&(_.options=c.options),_}cancel(c,_){if(c.activeQuery===_){var S=this.connection;this.host&&this.host.indexOf("/")===0?S.connect(this.host+"/.s.PGSQL."+this.port):S.connect(this.port,this.host),S.on("connect",function(){S.cancel(c.processID,c.secretKey)})}else c.queryQueue.indexOf(_)!==-1&&c.queryQueue.splice(c.queryQueue.indexOf(_),1)}setTypeParser(c,_,S){return this._types.setTypeParser(c,_,S)}getTypeParser(c,_){return this._types.getTypeParser(c,_)}escapeIdentifier(c){return'"'+c.replace(/"/g,'""')+'"'}escapeLiteral(c){for(var _=!1,S="'",v=0;v<c.length;v++){var A=c[v];A==="'"?S+=A+A:A==="\\"?(S+=A+A,_=!0):S+=A}return S+="'",_===!0&&(S=" E"+S),S}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let c=this.activeQuery.submit(this.connection);c&&le.nextTick(()=>{this.activeQuery.handleError(c,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(c,_,S){var v,A,L,k,x;if(c==null)throw new TypeError("Client was passed a null or undefined query");return typeof c.submit=="function"?(L=c.query_timeout||this.connectionParameters.query_timeout,A=v=c,typeof _=="function"&&(v.callback=v.callback||_)):(L=this.connectionParameters.query_timeout,v=new y(c,_,S),v.callback||(A=new this._Promise((T,P)=>{v.callback=(C,B)=>C?P(C):T(B)}))),L&&(x=v.callback,k=setTimeout(()=>{var T=new Error("Query read timeout");le.nextTick(()=>{v.handleError(T,this.connection)}),x(T),v.callback=()=>{};var P=this.queryQueue.indexOf(v);P>-1&&this.queryQueue.splice(P,1),this._pulseQueryQueue()},L),v.callback=(T,P)=>{clearTimeout(k),x(T,P)}),this.binary&&!v.binary&&(v.binary=!0),v._result&&!v._result._types&&(v._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"),this.connection)}),A):(this.queryQueue.push(v),this._pulseQueryQueue(),A):(le.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),A)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(c){if(this._ending=!0,!this.connection._connecting)if(c)c();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),c)this.connection.once("end",c);else return new this._Promise(_=>{this.connection.once("end",_)})}};w(d,"Client");var m=d;m.Query=y,e.exports=m}),yp=ce((s,e)=>{"use strict";Y();var t=Xt().EventEmitter,r=w(function(){},"NOOP"),n=w((g,c)=>{let _=g.findIndex(c);return _===-1?void 0:g.splice(_,1)[0]},"removeWhere"),i=class{constructor(c,_,S){this.client=c,this.idleListener=_,this.timeoutId=S}};w(i,"IdleItem");var a=i,o=class{constructor(c){this.callback=c}};w(o,"PendingItem");var u=o;function y(){throw new Error("Release called on client which has already been released to the pool.")}w(y,"throwOnDoubleRelease");function f(g,c){if(c)return{callback:c,result:void 0};let _,S,v=w(function(L,k){L?_(L):S(k)},"cb"),A=new g(function(L,k){S=L,_=k}).catch(L=>{throw Error.captureStackTrace(L),L});return{callback:v,result:A}}w(f,"promisify");function p(g,c){return w(function _(S){S.client=c,c.removeListener("error",_),c.on("error",()=>{g.log("additional client error after disconnection due to error",S)}),g._remove(c),g.emit("error",S,c)},"idleListener")}w(p,"makeIdleListener");var d=class extends t{constructor(c,_){super(),this.options=Object.assign({},c),c!=null&&"password"in c&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:c.password}),c!=null&&c.ssl&&c.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||_||Wn().Client,this.Promise=this.options.Promise||Dn.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(_=>{this._remove(_.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let c=this._pendingQueue.shift();if(this._idle.length){let _=this._idle.pop();clearTimeout(_.timeoutId);let S=_.client;S.ref&&S.ref();let v=_.idleListener;return this._acquireClient(S,c,v,!1)}if(!this._isFull())return this.newClient(c);throw new Error("unexpected condition")}_remove(c){let _=n(this._idle,S=>S.client===c);_!==void 0&&clearTimeout(_.timeoutId),this._clients=this._clients.filter(S=>S!==c),c.end(),this.emit("remove",c)}connect(c){if(this.ending){let v=new Error("Cannot use a pool after calling end on the pool");return c?c(v):this.Promise.reject(v)}let _=f(this.Promise,c),S=_.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new u(_.callback)),S;let v=w((k,x,T)=>{clearTimeout(L),_.callback(k,x,T)},"queueCallback"),A=new u(v),L=setTimeout(()=>{n(this._pendingQueue,k=>k.callback===v),A.timedOut=!0,_.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return L.unref&&L.unref(),this._pendingQueue.push(A),S}return this.newClient(new u(_.callback)),S}newClient(c){let _=new this.Client(this.options);this._clients.push(_);let S=p(this,_);this.log("checking client timeout");let v,A=!1;this.options.connectionTimeoutMillis&&(v=setTimeout(()=>{this.log("ending client due to timeout"),A=!0,_.connection?_.connection.stream.destroy():_.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),_.connect(L=>{if(v&&clearTimeout(v),_.on("error",S),L)this.log("client failed to connect",L),this._clients=this._clients.filter(k=>k!==_),A&&(L=new Error("Connection terminated due to connection timeout",{cause:L})),this._pulseQueue(),c.timedOut||c.callback(L,void 0,r);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let k=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(_),this._idle.findIndex(x=>x.client===_)!==-1&&this._acquireClient(_,new u((x,T,P)=>P()),S,!1)},this.options.maxLifetimeSeconds*1e3);k.unref(),_.once("end",()=>clearTimeout(k))}return this._acquireClient(_,c,S,!0)}})}_acquireClient(c,_,S,v){v&&this.emit("connect",c),this.emit("acquire",c),c.release=this._releaseOnce(c,S),c.removeListener("error",S),_.timedOut?v&&this.options.verify?this.options.verify(c,c.release):c.release():v&&this.options.verify?this.options.verify(c,A=>{if(A)return c.release(A),_.callback(A,void 0,r);_.callback(void 0,c,c.release)}):_.callback(void 0,c,c.release)}_releaseOnce(c,_){let S=!1;return v=>{S&&y(),S=!0,this._release(c,_,v)}}_release(c,_,S){if(c.on("error",_),c._poolUseCount=(c._poolUseCount||0)+1,this.emit("release",S,c),S||this.ending||!c._queryable||c._ending||c._poolUseCount>=this.options.maxUses){c._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(c),this._pulseQueue();return}if(this._expired.has(c)){this.log("remove expired client"),this._expired.delete(c),this._remove(c),this._pulseQueue();return}let v;this.options.idleTimeoutMillis&&this._isAboveMin()&&(v=setTimeout(()=>{this.log("remove idle client"),this._remove(c)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&v.unref()),this.options.allowExitOnIdle&&c.unref(),this._idle.push(new a(c,_,v)),this._pulseQueue()}query(c,_,S){if(typeof c=="function"){let A=f(this.Promise,c);return Da(function(){return A.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),A.result}typeof _=="function"&&(S=_,_=void 0);let v=f(this.Promise,S);return S=v.callback,this.connect((A,L)=>{if(A)return S(A);let k=!1,x=w(T=>{k||(k=!0,L.release(T),S(T))},"onError");L.once("error",x),this.log("dispatching query");try{L.query(c,_,(T,P)=>{if(this.log("query dispatched"),L.removeListener("error",x),!k)return k=!0,L.release(T),T?S(T):S(void 0,P)})}catch(T){return L.release(T),S(T)}}),v.result}end(c){if(this.log("ending"),this.ending){let S=new Error("Called end on pool more than once");return c?c(S):this.Promise.reject(S)}this.ending=!0;let _=f(this.Promise,c);return this._endCallback=_.callback,this._pulseQueue(),_.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((c,_)=>c+(this._expired.has(_)?1:0),0)}get totalCount(){return this._clients.length}};w(d,"Pool");var m=d;e.exports=m}),zu={};et(zu,{default:()=>Ku});var Ku,bp=je(()=>{"use strict";Y(),Ku={}}),wp=ce((s,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),_p=ce((s,e)=>{"use strict";Y();var t=Xt().EventEmitter,r=(Un(),Oe(Ws)),n=jn(),i=e.exports=function(o,u,y){t.call(this),o=n.normalizeQueryConfig(o,u,y),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(f){f==="row"&&(this._emitRowEvents=!0)}.bind(this))};r.inherits(i,t);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};i.prototype.handleError=function(o){var u=this.native.pq.resultErrorFields();if(u)for(var y in u){var f=a[y]||y;o[f]=u[y]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},i.prototype.then=function(o,u){return this._getPromise().then(o,u)},i.prototype.catch=function(o){return this._getPromise().catch(o)},i.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,u){this._once("end",o),this._once("error",u)}.bind(this)),this._promise)},i.prototype.submit=function(o){this.state="running";var u=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var y=w(function(d,m,g){if(o.native.arrayMode=!1,Da(function(){u.emit("_done")}),d)return u.handleError(d);u._emitRowEvents&&(g.length>1?m.forEach((c,_)=>{c.forEach(S=>{u.emit("row",S,g[_])})}):m.forEach(function(c){u.emit("row",c,g)})),u.state="end",u.emit("end",g),u.callback&&u.callback(null,g)},"after");if(le.domain&&(y=le.domain.bind(y)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var f=(this.values||[]).map(n.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return y(d)}return o.native.execute(this.name,f,y)}return o.native.prepare(this.name,this.text,f.length,function(d){return d?y(d):(o.namedQueries[u.name]=u.text,u.native.execute(u.name,f,y))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return y(d)}var p=this.values.map(n.prepareValue);o.native.query(this.text,p,y)}else o.native.query(this.text,y)}}),Sp=ce((s,e)=>{"use strict";Y();var t=(bp(),Oe(zu)),r=Qa(),n=wp(),i=Xt().EventEmitter,a=(Un(),Oe(Ws)),o=za(),u=_p(),y=e.exports=function(f){i.call(this),f=f||{},this._Promise=f.Promise||Dn.Promise,this._types=new r(f.types),this.native=new t({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var p=this.connectionParameters=new o(f);this.user=p.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),this.database=p.database,this.host=p.host,this.port=p.port,this.namedQueries={}};y.Query=u,a.inherits(y,i),y.prototype._errorAllQueries=function(f){let p=w(d=>{le.nextTick(()=>{d.native=this.native,d.handleError(f)})},"enqueueError");this._hasActiveQuery()&&(p(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(p),this._queryQueue.length=0},y.prototype._connect=function(f){var p=this;if(this._connecting){le.nextTick(()=>f(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,m){if(d)return f(d);p.native.connect(m,function(g){if(g)return p.native.end(),f(g);p._connected=!0,p.native.on("error",function(c){p._queryable=!1,p._errorAllQueries(c),p.emit("error",c)}),p.native.on("notification",function(c){p.emit("notification",{channel:c.relname,payload:c.extra})}),p.emit("connect"),p._pulseQueryQueue(!0),f()})})},y.prototype.connect=function(f){if(f){this._connect(f);return}return new this._Promise((p,d)=>{this._connect(m=>{m?d(m):p()})})},y.prototype.query=function(f,p,d){var m,g,c,_,S;if(f==null)throw new TypeError("Client was passed a null or undefined query");if(typeof f.submit=="function")c=f.query_timeout||this.connectionParameters.query_timeout,g=m=f,typeof p=="function"&&(f.callback=p);else if(c=this.connectionParameters.query_timeout,m=new u(f,p,d),!m.callback){let v,A;g=new this._Promise((L,k)=>{v=L,A=k}),m.callback=(L,k)=>L?A(L):v(k)}return c&&(S=m.callback,_=setTimeout(()=>{var v=new Error("Query read timeout");le.nextTick(()=>{m.handleError(v,this.connection)}),S(v),m.callback=()=>{};var A=this._queryQueue.indexOf(m);A>-1&&this._queryQueue.splice(A,1),this._pulseQueryQueue()},c),m.callback=(v,A)=>{clearTimeout(_),S(v,A)}),this._queryable?this._ending?(m.native=this.native,le.nextTick(()=>{m.handleError(new Error("Client was closed and is not queryable"))}),g):(this._queryQueue.push(m),this._pulseQueryQueue(),g):(m.native=this.native,le.nextTick(()=>{m.handleError(new Error("Client has encountered a connection error and is not queryable"))}),g)},y.prototype.end=function(f){var p=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,f));var d;return f||(d=new this._Promise(function(m,g){f=w(c=>c?g(c):m(),"cb")})),this.native.end(function(){p._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{p.emit("end"),f&&f()})}),d},y.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},y.prototype._pulseQueryQueue=function(f){if(this._connected&&!this._hasActiveQuery()){var p=this._queryQueue.shift();if(!p){f||this.emit("drain");return}this._activeQuery=p,p.submit(this);var d=this;p.once("_done",function(){d._pulseQueryQueue()})}},y.prototype.cancel=function(f){this._activeQuery===f?this.native.cancel(function(){}):this._queryQueue.indexOf(f)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(f),1)},y.prototype.ref=function(){},y.prototype.unref=function(){},y.prototype.setTypeParser=function(f,p,d){return this._types.setTypeParser(f,p,d)},y.prototype.getTypeParser=function(f,p){return this._types.getTypeParser(f,p)}}),pu=ce((s,e)=>{"use strict";Y(),e.exports=Sp()}),Wn=ce((s,e)=>{"use strict";Y();var t=gp(),r=Qn(),n=Vu(),i=yp(),{DatabaseError:a}=ju(),o=w(y=>{var f;return f=class extends i{constructor(p){super(p,y)}},w(f,"BoundPool"),f},"poolFactory"),u=w(function(y){this.defaults=r,this.Client=y,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=n,this.types=qn(),this.DatabaseError=a},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new u(pu()):(e.exports=new u(t),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var y=null;try{y=new u(pu())}catch(f){if(f.code!=="MODULE_NOT_FOUND")throw f}return Object.defineProperty(e.exports,"native",{value:y}),y}}))});Y();Y();Us();vu();Y();var vp=Object.defineProperty,xp=Object.defineProperties,Ap=Object.getOwnPropertyDescriptors,du=Object.getOwnPropertySymbols,Cp=Object.prototype.hasOwnProperty,Ep=Object.prototype.propertyIsEnumerable,mu=w((s,e,t)=>e in s?vp(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,"__defNormalProp"),Pp=w((s,e)=>{for(var t in e||(e={}))Cp.call(e,t)&&mu(s,t,e[t]);if(du)for(var t of du(e))Ep.call(e,t)&&mu(s,t,e[t]);return s},"__spreadValues"),Tp=w((s,e)=>xp(s,Ap(e)),"__spreadProps"),Ip=1008e3,gu=new Uint8Array(new Uint16Array([258]).buffer)[0]===2,Rp=new TextDecoder,Ka=new TextEncoder,kn=Ka.encode("0123456789abcdef"),Bn=Ka.encode("0123456789ABCDEF"),Op=Ka.encode("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Hu=Op.slice();Hu[62]=45;Hu[63]=95;var qs,Mn;function Ju(s,{alphabet:e,scratchArr:t}={}){if(!qs)if(qs=new Uint16Array(256),Mn=new Uint16Array(256),gu)for(let m=0;m<256;m++)qs[m]=kn[m&15]<<8|kn[m>>>4],Mn[m]=Bn[m&15]<<8|Bn[m>>>4];else for(let m=0;m<256;m++)qs[m]=kn[m&15]|kn[m>>>4]<<8,Mn[m]=Bn[m&15]|Bn[m>>>4]<<8;s.byteOffset%4!==0&&(s=new Uint8Array(s));let r=s.length,n=r>>>1,i=r>>>2,a=t||new Uint16Array(r),o=new Uint32Array(s.buffer,s.byteOffset,i),u=new Uint32Array(a.buffer,a.byteOffset,n),y=e==="upper"?Mn:qs,f=0,p=0,d;if(gu)for(;f<i;)d=o[f++],u[p++]=y[d>>>8&255]<<16|y[d&255],u[p++]=y[d>>>24]<<16|y[d>>>16&255];else for(;f<i;)d=o[f++],u[p++]=y[d>>>24]<<16|y[d>>>16&255],u[p++]=y[d>>>8&255]<<16|y[d&255];for(f<<=2;f<r;)a[f]=y[s[f++]];return Rp.decode(a.subarray(0,r))}w(Ju,"_toHex");function Gu(s,e={}){let t="",r=s.length,n=Ip>>>1,i=Math.ceil(r/n),a=new Uint16Array(i>1?n:r);for(let o=0;o<i;o++){let u=o*n,y=u+n;t+=Ju(s.subarray(u,y),Tp(Pp({},e),{scratchArr:a}))}return t}w(Gu,"_toHexChunked");function Xu(s,e={}){return e.alphabet!=="upper"&&typeof s.toHex=="function"?s.toHex():Gu(s,e)}w(Xu,"toHex");Y();var Yu=class Zu{constructor(e,t){this.strings=e,this.values=t}toParameterizedQuery(e={query:"",params:[]}){let{strings:t,values:r}=this;for(let n=0,i=t.length;n<i;n++)if(e.query+=t[n],n<r.length){let a=r[n];if(a instanceof rh)e.query+=a.sql;else if(a instanceof Fn)if(a.queryData instanceof Zu)a.queryData.toParameterizedQuery(e);else{if(a.queryData.params?.length)throw new Error("This query is not composable");e.query+=a.queryData.query}else{let{params:o}=e;o.push(a),e.query+="$"+o.length,(a instanceof re||ArrayBuffer.isView(a))&&(e.query+="::bytea")}}return e}};w(Yu,"SqlTemplate");var eh=Yu,th=class{constructor(e){this.sql=e}};w(th,"UnsafeRawSql");var rh=th;Y();function Ha(){typeof window<"u"&&typeof document<"u"&&typeof console<"u"&&typeof console.warn=="function"&&console.warn(`          
        ************************************************************
        *                                                          *
        *  WARNING: Running SQL directly from the browser can have *
        *  security implications. Even if your database is         *
        *  protected by Row-Level Security (RLS), use it at your   *
        *  own risk. This approach is great for fast prototyping,  *
        *  but ensure proper safeguards are in place to prevent    *
        *  misuse or execution of expensive SQL queries by your    *
        *  end users.                                              *
        *                                                          *
        *  If you've assessed the risks, suppress this message     *
        *  using the disableWarningInBrowsers configuration        *
        *  parameter.                                              *
        *                                                          *
        ************************************************************`)}w(Ha,"warnIfBrowser");Us();var Np=Gt(Qa()),Lp=Gt(jn()),sh=class nh extends Error{constructor(e){super(e),se(this,"name","NeonDbError"),se(this,"severity"),se(this,"code"),se(this,"detail"),se(this,"hint"),se(this,"position"),se(this,"internalPosition"),se(this,"internalQuery"),se(this,"where"),se(this,"schema"),se(this,"table"),se(this,"column"),se(this,"dataType"),se(this,"constraint"),se(this,"file"),se(this,"line"),se(this,"routine"),se(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,nh)}};w(sh,"NeonDbError");var Cr=sh,yu="transaction() expects an array of queries, or a function returning an array of queries",$p=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function ih(s){return s instanceof re?"\\x"+Xu(s):s}w(ih,"encodeBuffersAsBytea");function Ma(s){let{query:e,params:t}=s instanceof eh?s.toParameterizedQuery():s;return{query:e,params:t.map(r=>ih((0,Lp.prepareValue)(r)))}}w(Ma,"prepareQuery");function Pr(s,{arrayMode:e,fullResults:t,fetchOptions:r,isolationLevel:n,readOnly:i,deferrable:a,authToken:o,disableWarningInBrowsers:u}={}){if(!s)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let y;try{y=qa(s)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(s))}let{protocol:f,username:p,hostname:d,port:m,pathname:g}=y;if(f!=="postgres:"&&f!=="postgresql:"||!p||!d||!g)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function c(S,...v){if(!(Array.isArray(S)&&Array.isArray(S.raw)&&Array.isArray(v)))throw new Error('This function can now be called only as a tagged-template function: sql`SELECT ${value}`, not sql("SELECT $1", [value], options). For a conventional function call with value placeholders ($1, $2, etc.), use sql.query("SELECT $1", [value], options).');return new Fn(_,new eh(S,v))}w(c,"templateFn"),c.query=(S,v,A)=>new Fn(_,{query:S,params:v??[]},A),c.unsafe=S=>new rh(S),c.transaction=async(S,v)=>{if(typeof S=="function"&&(S=S(c)),!Array.isArray(S))throw new Error(yu);S.forEach(k=>{if(!(k instanceof Fn))throw new Error(yu)});let A=S.map(k=>k.queryData),L=S.map(k=>k.opts??{});return _(A,L,v)};async function _(S,v,A){let{fetchEndpoint:L,fetchFunction:k}=js,x=Array.isArray(S)?{queries:S.map(he=>Ma(he))}:Ma(S),T=r??{},P=e??!1,C=t??!1,B=n,$=i,H=a;A!==void 0&&(A.fetchOptions!==void 0&&(T={...T,...A.fetchOptions}),A.arrayMode!==void 0&&(P=A.arrayMode),A.fullResults!==void 0&&(C=A.fullResults),A.isolationLevel!==void 0&&(B=A.isolationLevel),A.readOnly!==void 0&&($=A.readOnly),A.deferrable!==void 0&&(H=A.deferrable)),v!==void 0&&!Array.isArray(v)&&v.fetchOptions!==void 0&&(T={...T,...v.fetchOptions});let K=o;!Array.isArray(v)&&v?.authToken!==void 0&&(K=v.authToken);let M=typeof L=="function"?L(d,m,{jwtAuth:K!==void 0}):L,j={"Neon-Connection-String":s,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},te=await ah(K);te&&(j.Authorization=`Bearer ${te}`),Array.isArray(S)&&(B!==void 0&&(j["Neon-Batch-Isolation-Level"]=B),$!==void 0&&(j["Neon-Batch-Read-Only"]=String($)),H!==void 0&&(j["Neon-Batch-Deferrable"]=String(H))),u||js.disableWarningInBrowsers||Ha();let ne;try{ne=await(k??fetch)(M,{method:"POST",body:JSON.stringify(x),headers:j,...T})}catch(he){let oe=new Cr(`Error connecting to database: ${he}`);throw oe.sourceError=he,oe}if(ne.ok){let he=await ne.json();if(Array.isArray(S)){let oe=he.results;if(!Array.isArray(oe))throw new Cr("Neon internal error: unexpected result format");return oe.map((We,pe)=>{let Ee=v[pe]??{},ws=Ee.arrayMode??P,_s=Ee.fullResults??C;return Fa(We,{arrayMode:ws,fullResults:_s,types:Ee.types})})}else{let oe=v??{},We=oe.arrayMode??P,pe=oe.fullResults??C;return Fa(he,{arrayMode:We,fullResults:pe,types:oe.types})}}else{let{status:he}=ne;if(he===400){let oe=await ne.json(),We=new Cr(oe.message);for(let pe of $p)We[pe]=oe[pe]??void 0;throw We}else{let oe=await ne.text();throw new Cr(`Server error (HTTP status ${he}): ${oe}`)}}}return w(_,"execute"),c}w(Pr,"neon");var oh=class{constructor(e,t,r){this.execute=e,this.queryData=t,this.opts=r}then(e,t){return this.execute(this.queryData,this.opts).then(e,t)}catch(e){return this.execute(this.queryData,this.opts).catch(e)}finally(e){return this.execute(this.queryData,this.opts).finally(e)}};w(oh,"NeonQueryPromise");var Fn=oh;function Fa(s,{arrayMode:e,fullResults:t,types:r}){let n=new Np.default(r),i=s.fields.map(u=>u.name),a=s.fields.map(u=>n.getTypeParser(u.dataTypeID)),o=e===!0?s.rows.map(u=>u.map((y,f)=>y===null?null:a[f](y))):s.rows.map(u=>Object.fromEntries(u.map((y,f)=>[i[f],y===null?null:a[f](y)])));return t?(s.viaNeonFetch=!0,s.rowAsArray=e,s.rows=o,s._parsers=a,s._types=n,s):o}w(Fa,"processQueryResult");async function ah(s){if(typeof s=="string")return s;if(typeof s=="function")try{return await Promise.resolve(s())}catch(e){let t=new Cr("Error getting auth token.");throw e instanceof Error&&(t=new Cr(`Error getting auth token: ${e.message}`)),t}}w(ah,"getAuthToken");Y();var kp=Gt(Wn());Y();var Bp=Gt(Wn()),lh=class extends Bp.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:t}=this;t.forceDisablePgSSL&&(this.ssl=this.connection.ssl=!1),this.ssl&&t.useSecureWebSocket&&console.warn("SSL is enabled for both Postgres (e.g. ?sslmode=require in the connection string + forceDisablePgSSL = false) and the WebSocket tunnel (useSecureWebSocket = true). Double encryption will increase latency and CPU usage. It may be appropriate to disable SSL in the Postgres connection parameters or set forceDisablePgSSL = true.");let r=typeof this.config!="string"&&this.config?.host!==void 0||typeof this.config!="string"&&this.config?.connectionString!==void 0||le.env.PGHOST!==void 0,n=le.env.USER??le.env.USERNAME;if(!r&&this.host==="localhost"&&this.user===n&&this.database===n&&this.password===null)throw new Error(`No database host or connection string was set, and key parameters have default values (host: localhost, user: ${n}, db: ${n}, password: null). Is an environment variable missing? Alternatively, if you intended to connect with these parameters, please set the host to 'localhost' explicitly.`);let i=super.connect(e),a=t.pipelineTLS&&this.ssl,o=t.pipelineConnect==="password";if(!a&&!t.pipelineConnect)return i;let u=this.connection;if(a&&u.on("connect",()=>u.stream.emit("data","S")),o){u.removeAllListeners("authenticationCleartextPassword"),u.removeAllListeners("readyForQuery"),u.once("readyForQuery",()=>u.on("readyForQuery",this._handleReadyForQuery.bind(this)));let y=this.ssl?"sslconnect":"connect";u.on(y,()=>{this.neonConfig.disableWarningInBrowsers||Ha(),this._handleAuthCleartextPassword(),this._handleReadyForQuery()})}return i}async _handleAuthSASLContinue(e){if(typeof crypto>"u"||crypto.subtle===void 0||crypto.subtle.importKey===void 0)throw new Error("Cannot use SASL auth when `crypto.subtle` is not defined");let t=crypto.subtle,r=this.saslSession,n=this.password,i=e.data;if(r.message!=="SASLInitialResponse"||typeof n!="string"||typeof i!="string")throw new Error("SASL: protocol error");let a=Object.fromEntries(i.split(",").map(he=>{if(!/^.=/.test(he))throw new Error("SASL: Invalid attribute pair entry");let oe=he[0],We=he.substring(2);return[oe,We]})),o=a.r,u=a.s,y=a.i;if(!o||!/^[!-+--~]+$/.test(o))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing/unprintable");if(!u||!/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(u))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing/not base64");if(!y||!/^[1-9][0-9]*$/.test(y))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: missing/invalid iteration count");if(!o.startsWith(r.clientNonce))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");if(o.length===r.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short");let f=parseInt(y,10),p=re.from(u,"base64"),d=new TextEncoder,m=d.encode(n),g=await t.importKey("raw",m,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),c=new Uint8Array(await t.sign("HMAC",g,re.concat([p,re.from([0,0,0,1])]))),_=c;for(var S=0;S<f-1;S++)c=new Uint8Array(await t.sign("HMAC",g,c)),_=re.from(_.map((he,oe)=>_[oe]^c[oe]));let v=_,A=await t.importKey("raw",v,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),L=new Uint8Array(await t.sign("HMAC",A,d.encode("Client Key"))),k=await t.digest("SHA-256",L),x="n=*,r="+r.clientNonce,T="r="+o+",s="+u+",i="+f,P="c=biws,r="+o,C=x+","+T+","+P,B=await t.importKey("raw",k,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);var $=new Uint8Array(await t.sign("HMAC",B,d.encode(C))),H=re.from(L.map((he,oe)=>L[oe]^$[oe])),K=H.toString("base64");let M=await t.importKey("raw",v,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),j=await t.sign("HMAC",M,d.encode("Server Key")),te=await t.importKey("raw",j,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);var ne=re.from(await t.sign("HMAC",te,d.encode(C)));r.message="SASLResponse",r.serverSignature=ne.toString("base64"),r.response=P+",p="+K,this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}};w(lh,"NeonClient");var Mp=lh;Us();var Fp=Gt(za());function ch(s,e){if(e)return{callback:e,result:void 0};let t,r,n=w(function(a,o){a?t(a):r(o)},"cb"),i=new s(function(a,o){r=a,t=o});return{callback:n,result:i}}w(ch,"promisify");var Dp=class extends kp.Pool{constructor(){super(...arguments),se(this,"Client",Mp),se(this,"hasFetchUnsupportedListeners",!1),se(this,"addListener",this.on)}on(e,t){return e!=="error"&&(this.hasFetchUnsupportedListeners=!0),super.on(e,t)}query(e,t,r){if(!js.poolQueryViaFetch||this.hasFetchUnsupportedListeners||typeof e=="function")return super.query(e,t,r);typeof t=="function"&&(r=t,t=void 0);let n=ch(this.Promise,r);r=n.callback;try{let i=new Fp.default(this.options),a=encodeURIComponent,o=encodeURI,u=`postgresql://${a(i.user)}:${a(i.password)}@${a(i.host)}/${o(i.database)}`,y=typeof e=="string"?e:e.text,f=t??e.values??[];Pr(u,{fullResults:!0,arrayMode:e.rowMode==="array"}).query(y,f,{types:e.types??this.options?.types}).then(p=>r(void 0,p)).catch(p=>r(p))}catch(i){r(i)}return n.result}};w(Dp,"NeonPool");Us();var Vs=Gt(Wn());var v0=Vs.DatabaseError,x0=Vs.defaults,A0=Vs.escapeIdentifier,C0=Vs.escapeLiteral,Ue=Vs.types;var we=class s{static[E]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,t){if(t==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(t===ge)return{...e[ge],selectedFields:new Proxy(e[ge].selectedFields,this)};if(typeof t=="symbol")return e[t];let n=(F(e,be)?e._.selectedFields:F(e,Me)?e[ge].selectedFields:e)[t];if(F(n,G.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!n.isSelectionField)return n.sql;let i=n.clone();return i.isSelectionField=!0,i}if(F(n,G)){if(this.config.sqlBehavior==="sql")return n;throw new Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return F(n,fe)?this.config.alias?new Proxy(n,new Jt(new Proxy(n.table,new xr(this.config.alias,this.config.replaceOriginalName??!1)))):n:typeof n!="object"||n===null?n:new Proxy(n,new s(this.config))}};function qp(s){return(s.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(t=>t.toLowerCase()).join("_")}function Qp(s){return(s.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((t,r,n)=>{let i=n===0?r.toLowerCase():`${r[0].toUpperCase()}${r.slice(1)}`;return t+i},"")}function jp(s){return s}var Vn=class{static[E]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?qp:e==="camelCase"?Qp:jp}getColumnCasing(e){if(!e.keyAsName)return e.name;let t=e.table[V.Symbol.Schema]??"public",r=e.table[V.Symbol.OriginalName],n=`${t}.${r}.${e.name}`;return this.cache[n]||this.cacheTable(e.table),this.cache[n]}cacheTable(e){let t=e[V.Symbol.Schema]??"public",r=e[V.Symbol.OriginalName],n=`${t}.${r}`;if(!this.cachedTables[n]){for(let i of Object.values(e[V.Symbol.Columns])){let a=`${n}.${i.name}`;this.cache[a]=this.convert(i.name)}this.cachedTables[n]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var Tr=class extends Me{static[E]="PgViewBase"};var Rt=class{static[E]="PgDialect";casing;constructor(e){this.casing=new Vn(e?.casing)}async migrate(e,t,r){let n=typeof r=="string"?"__drizzle_migrations":r.migrationsTable??"__drizzle_migrations",i=typeof r=="string"?"drizzle":r.migrationsSchema??"drizzle",a=R`
			CREATE TABLE IF NOT EXISTS ${R.identifier(i)}.${R.identifier(n)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(R`CREATE SCHEMA IF NOT EXISTS ${R.identifier(i)}`),await t.execute(a);let u=(await t.all(R`select id, hash, created_at from ${R.identifier(i)}.${R.identifier(n)} order by created_at desc limit 1`))[0];await t.transaction(async y=>{for await(let f of e)if(!u||Number(u.created_at)<f.folderMillis){for(let p of f.sql)await y.execute(R.raw(p));await y.execute(R`insert into ${R.identifier(i)}.${R.identifier(n)} ("hash", "created_at") values(${f.hash}, ${f.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[R`with `];for(let[r,n]of e.entries())t.push(R`${R.identifier(n._.alias)} as (${n._.sql})`),r<e.length-1&&t.push(R`, `);return t.push(R` `),R.join(t)}buildDeleteQuery({table:e,where:t,returning:r,withList:n}){let i=this.buildWithCTE(n),a=r?R` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,o=t?R` where ${t}`:void 0;return R`${i}delete from ${e}${o}${a}`}buildUpdateSet(e,t){let r=e[V.Symbol.Columns],n=Object.keys(r).filter(a=>t[a]!==void 0||r[a]?.onUpdateFn!==void 0),i=n.length;return R.join(n.flatMap((a,o)=>{let u=r[a],y=t[a]??R.param(u.onUpdateFn(),u),f=R`${R.identifier(this.casing.getColumnCasing(u))} = ${y}`;return o<i-1?[f,R.raw(", ")]:[f]}))}buildUpdateQuery({table:e,set:t,where:r,returning:n,withList:i,from:a,joins:o}){let u=this.buildWithCTE(i),y=e[Ae.Symbol.Name],f=e[Ae.Symbol.Schema],p=e[Ae.Symbol.OriginalName],d=y===p?void 0:y,m=R`${f?R`${R.identifier(f)}.`:void 0}${R.identifier(p)}${d&&R` ${R.identifier(d)}`}`,g=this.buildUpdateSet(e,t),c=a&&R.join([R.raw(" from "),this.buildFromTable(a)]),_=this.buildJoins(o),S=n?R` returning ${this.buildSelection(n,{isSingleTable:!a})}`:void 0,v=r?R` where ${r}`:void 0;return R`${u}update ${m} set ${g}${c}${_}${v}${S}`}buildSelection(e,{isSingleTable:t=!1}={}){let r=e.length,n=e.flatMap(({field:i},a)=>{let o=[];if(F(i,G.Aliased)&&i.isSelectionField)o.push(R.identifier(i.fieldAlias));else if(F(i,G.Aliased)||F(i,G)){let u=F(i,G.Aliased)?i.sql:i;t?o.push(new G(u.queryChunks.map(y=>F(y,W)?R.identifier(this.casing.getColumnCasing(y)):y))):o.push(u),F(i,G.Aliased)&&o.push(R` as ${R.identifier(i.fieldAlias)}`)}else F(i,fe)&&(t?o.push(R.identifier(this.casing.getColumnCasing(i))):o.push(i));return a<r-1&&o.push(R`, `),o});return R.join(n)}buildJoins(e){if(!e||e.length===0)return;let t=[];for(let[r,n]of e.entries()){r===0&&t.push(R` `);let i=n.table,a=n.lateral?R` lateral`:void 0,o=n.on?R` on ${n.on}`:void 0;if(F(i,Ae)){let u=i[Ae.Symbol.Name],y=i[Ae.Symbol.Schema],f=i[Ae.Symbol.OriginalName],p=u===f?void 0:n.alias;t.push(R`${R.raw(n.joinType)} join${a} ${y?R`${R.identifier(y)}.`:void 0}${R.identifier(f)}${p&&R` ${R.identifier(p)}`}${o}`)}else if(F(i,Me)){let u=i[ge].name,y=i[ge].schema,f=i[ge].originalName,p=u===f?void 0:n.alias;t.push(R`${R.raw(n.joinType)} join${a} ${y?R`${R.identifier(y)}.`:void 0}${R.identifier(f)}${p&&R` ${R.identifier(p)}`}${o}`)}else t.push(R`${R.raw(n.joinType)} join${a} ${i}${o}`);r<e.length-1&&t.push(R` `)}return R.join(t)}buildFromTable(e){if(F(e,V)&&e[V.Symbol.IsAlias]){let t=R`${R.identifier(e[V.Symbol.OriginalName])}`;return e[V.Symbol.Schema]&&(t=R`${R.identifier(e[V.Symbol.Schema])}.${t}`),R`${t} ${R.identifier(e[V.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:t,fieldsFlat:r,where:n,having:i,table:a,joins:o,orderBy:u,groupBy:y,limit:f,offset:p,lockingClause:d,distinct:m,setOperators:g}){let c=r??Je(t);for(let M of c)if(F(M.field,fe)&&De(M.field.table)!==(F(a,be)?a._.alias:F(a,Tr)?a[ge].name:F(a,G)?void 0:De(a))&&!(j=>o?.some(({alias:te})=>te===(j[V.Symbol.IsAlias]?De(j):j[V.Symbol.BaseName])))(M.field.table)){let j=De(M.field.table);throw new Error(`Your "${M.path.join("->")}" field references a column "${j}"."${M.field.name}", but the table "${j}" is not part of the query! Did you forget to join it?`)}let _=!o||o.length===0,S=this.buildWithCTE(e),v;m&&(v=m===!0?R` distinct`:R` distinct on (${R.join(m.on,R`, `)})`);let A=this.buildSelection(c,{isSingleTable:_}),L=this.buildFromTable(a),k=this.buildJoins(o),x=n?R` where ${n}`:void 0,T=i?R` having ${i}`:void 0,P;u&&u.length>0&&(P=R` order by ${R.join(u,R`, `)}`);let C;y&&y.length>0&&(C=R` group by ${R.join(y,R`, `)}`);let B=typeof f=="object"||typeof f=="number"&&f>=0?R` limit ${f}`:void 0,$=p?R` offset ${p}`:void 0,H=R.empty();if(d){let M=R` for ${R.raw(d.strength)}`;d.config.of&&M.append(R` of ${R.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],R`, `)}`),d.config.noWait?M.append(R` nowait`):d.config.skipLocked&&M.append(R` skip locked`),H.append(M)}let K=R`${S}select${v} ${A} from ${L}${k}${x}${C}${T}${P}${B}${$}${H}`;return g.length>0?this.buildSetOperations(K,g):K}buildSetOperations(e,t){let[r,...n]=t;if(!r)throw new Error("Cannot pass undefined values to any set operator");return n.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),n)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:r,rightSelect:n,limit:i,orderBy:a,offset:o}}){let u=R`(${e.getSQL()}) `,y=R`(${n.getSQL()})`,f;if(a&&a.length>0){let g=[];for(let c of a)if(F(c,W))g.push(R.identifier(c.name));else if(F(c,G)){for(let _=0;_<c.queryChunks.length;_++){let S=c.queryChunks[_];F(S,W)&&(c.queryChunks[_]=R.identifier(S.name))}g.push(R`${c}`)}else g.push(R`${c}`);f=R` order by ${R.join(g,R`, `)} `}let p=typeof i=="object"||typeof i=="number"&&i>=0?R` limit ${i}`:void 0,d=R.raw(`${t} ${r?"all ":""}`),m=o?R` offset ${o}`:void 0;return R`${u}${d}${y}${f}${p}${m}`}buildInsertQuery({table:e,values:t,onConflict:r,returning:n,withList:i,select:a,overridingSystemValue_:o}){let u=[],y=e[V.Symbol.Columns],f=Object.entries(y).filter(([S,v])=>!v.shouldDisableInsert()),p=f.map(([,S])=>R.identifier(this.casing.getColumnCasing(S)));if(a){let S=t;F(S,G)?u.push(S):u.push(S.getSQL())}else{let S=t;u.push(R.raw("values "));for(let[v,A]of S.entries()){let L=[];for(let[k,x]of f){let T=A[k];if(T===void 0||F(T,qe)&&T.value===void 0)if(x.defaultFn!==void 0){let P=x.defaultFn(),C=F(P,G)?P:R.param(P,x);L.push(C)}else if(!x.default&&x.onUpdateFn!==void 0){let P=x.onUpdateFn(),C=F(P,G)?P:R.param(P,x);L.push(C)}else L.push(R`default`);else L.push(T)}u.push(L),v<S.length-1&&u.push(R`, `)}}let d=this.buildWithCTE(i),m=R.join(u),g=n?R` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,c=r?R` on conflict ${r}`:void 0,_=o===!0?R`overriding system value `:void 0;return R`${d}insert into ${e} ${p} ${_}${m}${c}${g}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:r}){let n=t?R` concurrently`:void 0,i=r?R` with no data`:void 0;return R`refresh materialized view${n} ${e}${i}`}prepareTyping(e){return F(e,Os)||F(e,Rs)?"json":F(e,Ns)?"decimal":F(e,Ls)?"time":F(e,$s)||F(e,ks)?"timestamp":F(e,Ts)||F(e,Is)?"date":F(e,Bs)?"uuid":"none"}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:r,table:n,tableConfig:i,queryConfig:a,tableAlias:o,nestedQueryRelation:u,joinOn:y}){let f=[],p,d,m=[],g,c=[];if(a===!0)f=Object.entries(i.columns).map(([v,A])=>({dbKey:A.name,tsKey:v,field:nt(A,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let S=Object.fromEntries(Object.entries(i.columns).map(([T,P])=>[T,nt(P,o)]));if(a.where){let T=typeof a.where=="function"?a.where(S,au()):a.where;g=T&&Cs(T,o)}let v=[],A=[];if(a.columns){let T=!1;for(let[P,C]of Object.entries(a.columns))C!==void 0&&P in i.columns&&(!T&&C===!0&&(T=!0),A.push(P));A.length>0&&(A=T?A.filter(P=>a.columns?.[P]===!0):Object.keys(i.columns).filter(P=>!A.includes(P)))}else A=Object.keys(i.columns);for(let T of A){let P=i.columns[T];v.push({tsKey:T,value:P})}let L=[];a.with&&(L=Object.entries(a.with).filter(T=>!!T[1]).map(([T,P])=>({tsKey:T,queryConfig:P,relation:i.relations[T]})));let k;if(a.extras){k=typeof a.extras=="function"?a.extras(S,{sql:R}):a.extras;for(let[T,P]of Object.entries(k))v.push({tsKey:T,value:ao(P,o)})}for(let{tsKey:T,value:P}of v)f.push({dbKey:F(P,G.Aliased)?P.fieldAlias:i.columns[T].name,tsKey:T,field:F(P,fe)?nt(P,o):P,relationTableTsKey:void 0,isJson:!1,selection:[]});let x=typeof a.orderBy=="function"?a.orderBy(S,lu()):a.orderBy??[];Array.isArray(x)||(x=[x]),m=x.map(T=>F(T,fe)?nt(T,o):Cs(T,o)),p=a.limit,d=a.offset;for(let{tsKey:T,queryConfig:P,relation:C}of L){let B=uu(t,r,C),$=Ht(C.referencedTable),H=r[$],K=`${o}_${T}`,M=Ms(...B.fields.map((ne,he)=>wt(nt(B.references[he],K),nt(ne,o)))),j=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:r,table:e[H],tableConfig:t[H],queryConfig:F(C,It)?P===!0?{limit:1}:{...P,limit:1}:P,tableAlias:K,joinOn:M,nestedQueryRelation:C}),te=R`${R.identifier(K)}.${R.identifier("data")}`.as(T);c.push({on:R`true`,table:new be(j.sql,{},K),alias:K,joinType:"left",lateral:!0}),f.push({dbKey:T,tsKey:T,field:te,relationTableTsKey:H,isJson:!0,selection:j.selection})}}if(f.length===0)throw new Es({message:`No fields selected for table "${i.tsName}" ("${o}")`});let _;if(g=Ms(y,g),u){let S=R`json_build_array(${R.join(f.map(({field:L,tsKey:k,isJson:x})=>x?R`${R.identifier(`${o}_${k}`)}.${R.identifier("data")}`:F(L,G.Aliased)?L.sql:L),R`, `)})`;F(u,Fs)&&(S=R`coalesce(json_agg(${S}${m.length>0?R` order by ${R.join(m,R`, `)}`:void 0}), '[]'::json)`);let v=[{dbKey:"data",tsKey:"data",field:S.as("data"),isJson:!0,relationTableTsKey:i.tsName,selection:f}];p!==void 0||d!==void 0||m.length>0?(_=this.buildSelectQuery({table:As(n,o),fields:{},fieldsFlat:[{path:[],field:R.raw("*")}],where:g,limit:p,offset:d,orderBy:m,setOperators:[]}),g=void 0,p=void 0,d=void 0,m=[]):_=As(n,o),_=this.buildSelectQuery({table:F(_,Ae)?_:new be(_,{},o),fields:{},fieldsFlat:v.map(({field:L})=>({path:[],field:F(L,fe)?nt(L,o):L})),joins:c,where:g,limit:p,offset:d,orderBy:m,setOperators:[]})}else _=this.buildSelectQuery({table:As(n,o),fields:{},fieldsFlat:f.map(({field:S})=>({path:[],field:F(S,fe)?nt(S,o):S})),joins:c,where:g,limit:p,offset:d,orderBy:m,setOperators:[]});return{tableTsKey:i.tsName,sql:_,selection:f}}};var zn=class{static[E]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var ke=class{static[E]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let t=!!this.fields,r=e,n;return this.fields?n=this.fields:F(r,be)?n=Object.fromEntries(Object.keys(r._.selectedFields).map(i=>[i,r[i]])):F(r,Tr)?n=r[ge].selectedFields:F(r,G)?n={}:n=cc(r),new Kn({table:r,fields:n,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},Ja=class extends zn{static[E]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:e,fields:t,isPartialSelect:r,session:n,dialect:i,withList:a,distinct:o}){super(),this.config={withList:a,table:e,fields:{...t},distinct:o,setOperators:[]},this.isPartialSelect=r,this.session=n,this.dialect=i,this._={selectedFields:t,config:this.config},this.tableName=yt(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{};for(let u of tt(e))this.usedTables.add(u)}getUsedTables(){return[...this.usedTables]}createJoin(e,t){return(r,n)=>{let i=this.tableName,a=yt(r);for(let o of tt(r))this.usedTables.add(o);if(typeof a=="string"&&this.config.joins?.some(o=>o.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof a=="string"&&!F(r,G))){let o=F(r,be)?r._.selectedFields:F(r,Me)?r[ge].selectedFields:r[V.Symbol.Columns];this.config.fields[a]=o}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new we({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:a,lateral:t}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[a]=!0;break}case"cross":case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left",!1);leftJoinLateral=this.createJoin("left",!0);rightJoin=this.createJoin("right",!1);innerJoin=this.createJoin("inner",!1);innerJoinLateral=this.createJoin("inner",!0);fullJoin=this.createJoin("full",!1);crossJoin=this.createJoin("cross",!1);crossJoinLateral=this.createJoin("cross",!0);createSetOperator(e,t){return r=>{let n=typeof r=="function"?r(Up()):r;if(!Ps(this.getSelectedFields(),n.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:n}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new we({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new we({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new we({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new we({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{let t=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){let t=[];if(t.push(...tt(this.config.table)),this.config.joins)for(let r of this.config.joins)t.push(...tt(r.table));return new Proxy(new be(this.getSQL(),this.config.fields,e,!1,[...new Set(t)]),new we({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new we({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}$withCache(e){return this.cacheConfig=e===void 0?{config:{},enable:!0,autoInvalidate:!0}:e===!1?{enable:!1}:{enable:!0,autoInvalidate:!0,...e},this}},Kn=class extends Ja{static[E]="PgSelect";_prepare(e){let{session:t,config:r,dialect:n,joinsNotNullableMap:i,authToken:a,cacheConfig:o,usedTables:u}=this;if(!t)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");let{fields:y}=r;return ve.startActiveSpan("drizzle.prepareQuery",()=>{let f=Je(y),p=t.prepareQuery(n.sqlToQuery(this.getSQL()),f,e,!0,void 0,{type:"select",tables:[...u]},o);return p.joinsNotNullableMap=i,p.setToken(a)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lc(Kn,[$e]);function Ir(s,e){return(t,r,...n)=>{let i=[r,...n].map(a=>({type:s,isAll:e,rightSelect:a}));for(let a of i)if(!Ps(t.getSelectedFields(),a.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return t.addSetOperators(i)}}var Up=()=>({union:Wp,unionAll:Vp,intersect:zp,intersectAll:Kp,except:Hp,exceptAll:Jp}),Wp=Ir("union",!1),Vp=Ir("union",!0),zp=Ir("intersect",!1),Kp=Ir("intersect",!0),Hp=Ir("except",!1),Jp=Ir("except",!0);var Rr=class{static[E]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=F(e,Rt)?e:void 0,this.dialectConfig=F(e,Rt)?void 0:e}$with=(e,t)=>{let r=this;return{as:i=>(typeof i=="function"&&(i=i(r)),new Proxy(new vr(i.getSQL(),t??("getSelectedFields"in i?i.getSelectedFields()??{}:{}),e,!0),new we({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let t=this;function r(a){return new ke({fields:a??void 0,session:void 0,dialect:t.getDialect(),withList:e})}function n(a){return new ke({fields:a??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})}function i(a,o){return new ke({fields:o??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:a}})}return{select:r,selectDistinct:n,selectDistinctOn:i}}select(e){return new ke({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new ke({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new ke({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Rt(this.dialectConfig)),this.dialect}};function tt(s){return F(s,Ae)?[s[Kt]?`${s[Kt]}.${s[V.Symbol.BaseName]}`:s[V.Symbol.BaseName]]:F(s,be)?s._.usedTables??[]:F(s,G)?s.usedTables??[]:[]}var zs=class extends $e{constructor(e,t,r,n){super(),this.session=t,this.dialect=r,this.config={table:e,withList:n}}static[E]="PgDelete";config;cacheConfig;where(e){return this.config.where=e,this}returning(e=this.config.table[V.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Je(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"delete",tables:tt(this.config.table)},this.cacheConfig))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new we({alias:De(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var Ks=class{constructor(e,t,r,n,i){this.table=e,this.session=t,this.dialect=r,this.withList=n,this.overridingSystemValue_=i}static[E]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let t=e.map(r=>{let n={},i=this.table[V.Symbol.Columns];for(let a of Object.keys(r)){let o=r[a];n[a]=F(o,G)?o:new qe(o,i[a])}return n});return new Hn(this.table,t,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let t=typeof e=="function"?e(new Rr):e;if(!F(t,G)&&!Ps(this.table[xn],t._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new Hn(this.table,t,this.session,this.dialect,this.withList,!0)}},Hn=class extends $e{constructor(e,t,r,n,i,a,o){super(),this.session=r,this.dialect=n,this.config={table:e,values:t,withList:i,select:a,overridingSystemValue_:o}}static[E]="PgInsert";config;cacheConfig;returning(e=this.config.table[V.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Je(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=R`do nothing`;else{let t="";t=Array.isArray(e.target)?e.target.map(n=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(n))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let r=e.where?R` where ${e.where}`:void 0;this.config.onConflict=R`(${R.raw(t)})${r} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let t=e.where?R` where ${e.where}`:void 0,r=e.targetWhere?R` where ${e.targetWhere}`:void 0,n=e.setWhere?R` where ${e.setWhere}`:void 0,i=this.dialect.buildUpdateSet(this.config.table,Tn(this.config.table,e.set)),a="";return a=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=R`(${R.raw(a)})${r} do update set ${i}${t}${n}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"insert",tables:tt(this.config.table)},this.cacheConfig))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new we({alias:De(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var Jn=class extends $e{constructor(e,t,r){super(),this.session=t,this.dialect=r,this.config={view:e}}static[E]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var Hs=class{constructor(e,t,r,n){this.table=e,this.session=t,this.dialect=r,this.withList=n}static[E]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Ga(this.table,Tn(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Ga=class extends $e{constructor(e,t,r,n,i){super(),this.session=r,this.dialect=n,this.config={set:t,table:e,withList:i,joins:[]},this.tableName=yt(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[E]="PgUpdate";config;tableName;joinsNotNullableMap;cacheConfig;from(e){let t=e,r=yt(t);return typeof r=="string"&&(this.joinsNotNullableMap[r]=!0),this.config.from=t,this}getTableLikeFields(e){return F(e,Ae)?e[V.Symbol.Columns]:F(e,be)?e._.selectedFields:e[ge].selectedFields}createJoin(e){return(t,r)=>{let n=yt(t);if(typeof n=="string"&&this.config.joins.some(i=>i.alias===n))throw new Error(`Alias "${n}" is already used in this query`);if(typeof r=="function"){let i=this.config.from&&!F(this.config.from,G)?this.getTableLikeFields(this.config.from):void 0;r=r(new Proxy(this.config.table[V.Symbol.Columns],new we({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),i&&new Proxy(i,new we({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:r,table:t,joinType:e,alias:n}),typeof n=="string")switch(e){case"left":{this.joinsNotNullableMap[n]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([i])=>[i,!1])),this.joinsNotNullableMap[n]=!0;break}case"inner":{this.joinsNotNullableMap[n]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([i])=>[i,!1])),this.joinsNotNullableMap[n]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[V.Symbol.Columns]),this.config.from)){let t=yt(this.config.from);if(typeof t=="string"&&this.config.from&&!F(this.config.from,G)){let r=this.getTableLikeFields(this.config.from);e[t]=r}for(let r of this.config.joins){let n=yt(r.table);if(typeof n=="string"&&!F(r.table,G)){let i=this.getTableLikeFields(r.table);e[n]=i}}}return this.config.returningFields=e,this.config.returning=Je(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){let t=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"insert",tables:tt(this.config.table)},this.cacheConfig);return t.joinsNotNullableMap=this.joinsNotNullableMap,t}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new we({alias:De(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var Gn=class s extends G{constructor(e){super(s.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=s.buildCount(e.source,e.filters)}sql;token;static[E]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,t){return R`(select count(*) from ${e}${R.raw(" where ").if(t)}${t})`}static buildCount(e,t){return R`select count(*) as count from ${e}${R.raw(" where ").if(t)}${t};`}setToken(e){return this.token=e,this}then(e,t){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,t)}catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}};var Xn=class{constructor(e,t,r,n,i,a,o){this.fullSchema=e,this.schema=t,this.tableNamesMap=r,this.table=n,this.tableConfig=i,this.dialect=a,this.session=o}static[E]="PgRelationalQueryBuilder";findMany(e){return new Yn(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Yn(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Yn=class extends $e{constructor(e,t,r,n,i,a,o,u,y){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=r,this.table=n,this.tableConfig=i,this.dialect=a,this.session=o,this.config=u,this.mode=y}static[E]="PgRelationalQuery";_prepare(e){return ve.startActiveSpan("drizzle.prepareQuery",()=>{let{query:t,builtQuery:r}=this._toSQL();return this.session.prepareQuery(r,void 0,e,!0,(n,i)=>{let a=n.map(o=>$n(this.schema,this.tableConfig,o,t.selection,i));return this.mode==="first"?a[0]:a})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),t=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:t}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ve.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var Zn=class extends $e{constructor(e,t,r,n){super(),this.execute=e,this.sql=t,this.query=r,this.mapBatchResult=n}static[E]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Or=class{constructor(e,t,r){if(this.dialect=e,this.session=t,this._=r?{schema:r.schema,fullSchema:r.fullSchema,tableNamesMap:r.tableNamesMap,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:t},this.query={},this._.schema)for(let[n,i]of Object.entries(this._.schema))this.query[n]=new Xn(r.fullSchema,this._.schema,this._.tableNamesMap,r.fullSchema[n],i,e,t);this.$cache={invalidate:async n=>{}}}static[E]="PgDatabase";query;$with=(e,t)=>{let r=this;return{as:i=>(typeof i=="function"&&(i=i(new Rr(r.dialect))),new Proxy(new vr(i.getSQL(),t??("getSelectedFields"in i?i.getSelectedFields()??{}:{}),e,!0),new we({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,t){return new Gn({source:e,filters:t,session:this.session})}$cache;with(...e){let t=this;function r(y){return new ke({fields:y??void 0,session:t.session,dialect:t.dialect,withList:e})}function n(y){return new ke({fields:y??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})}function i(y,f){return new ke({fields:f??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:{on:y}})}function a(y){return new Hs(y,t.session,t.dialect,e)}function o(y){return new Ks(y,t.session,t.dialect,e)}function u(y){return new zs(y,t.session,t.dialect,e)}return{select:r,selectDistinct:n,selectDistinctOn:i,update:a,insert:o,delete:u}}select(e){return new ke({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new ke({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,t){return new ke({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new Hs(e,this.session,this.dialect)}insert(e){return new Ks(e,this.session,this.dialect)}delete(e){return new zs(e,this.session,this.dialect)}refreshMaterializedView(e){return new Jn(e,this.session,this.dialect)}authToken;execute(e){let t=typeof e=="string"?R.raw(e):e.getSQL(),r=this.dialect.sqlToQuery(t),n=this.session.prepareQuery(r,void 0,void 0,!1);return new Zn(()=>n.execute(void 0,this.authToken),t,r,i=>n.mapResult(i,!0))}transaction(e,t){return this.session.transaction(e,t)}};var Xa=class{static[E]="Cache"},Nr=class extends Xa{strategy(){return"all"}static[E]="NoopCache";async get(e){}async put(e,t,r,n){}async onMutate(e){}};async function Ya(s,e){let t=`${s}-${JSON.stringify(e)}`,n=new TextEncoder().encode(t),i=await crypto.subtle.digest("SHA-256",n);return[...new Uint8Array(i)].map(u=>u.toString(16).padStart(2,"0")).join("")}var St=class s extends Error{constructor(e,t,r){super(`Failed query: ${e}
params: ${t}`),this.query=e,this.params=t,this.cause=r,Error.captureStackTrace(this,s),r&&(this.cause=r)}};var ei=class{constructor(e,t,r,n){this.query=e,this.cache=t,this.queryMetadata=r,this.cacheConfig=n,t&&t.strategy()==="all"&&n===void 0&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}authToken;getQuery(){return this.query}mapResult(e,t){return e}setToken(e){return this.authToken=e,this}static[E]="PgPreparedQuery";joinsNotNullableMap;async queryWithCache(e,t,r){if(this.cache===void 0||F(this.cache,Nr)||this.queryMetadata===void 0)try{return await r()}catch(n){throw new St(e,t,n)}if(this.cacheConfig&&!this.cacheConfig.enable)try{return await r()}catch(n){throw new St(e,t,n)}if((this.queryMetadata.type==="insert"||this.queryMetadata.type==="update"||this.queryMetadata.type==="delete")&&this.queryMetadata.tables.length>0)try{let[n]=await Promise.all([r(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return n}catch(n){throw new St(e,t,n)}if(!this.cacheConfig)try{return await r()}catch(n){throw new St(e,t,n)}if(this.queryMetadata.type==="select"){let n=await this.cache.get(this.cacheConfig.tag??await Ya(e,t),this.queryMetadata.tables,this.cacheConfig.tag!==void 0,this.cacheConfig.autoInvalidate);if(n===void 0){let i;try{i=await r()}catch(a){throw new St(e,t,a)}return await this.cache.put(this.cacheConfig.tag??await Ya(e,t),i,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],this.cacheConfig.tag!==void 0,this.cacheConfig.config),i}return n}try{return await r()}catch(n){throw new St(e,t,n)}}},ti=class{constructor(e){this.dialect=e}static[E]="PgSession";execute(e,t){return ve.startActiveSpan("drizzle.operation",()=>ve.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(t).execute(void 0,t))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,t){let r=await this.execute(e,t);return Number(r[0].count)}},ri=class extends Or{constructor(e,t,r,n=0){super(e,t,r),this.schema=r,this.nestedIndex=n}static[E]="PgTransaction";rollback(){throw new Cn}getTransactionConfigSQL(e){let t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),typeof e.deferrable=="boolean"&&t.push(e.deferrable?"deferrable":"not deferrable"),R.raw(t.join(" "))}setTransaction(e){return this.session.execute(R`set transaction ${this.getTransactionConfigSQL(e)}`)}};var si={arrayMode:!1,fullResults:!0},Za={arrayMode:!0,fullResults:!0},el=class extends ei{constructor(e,t,r,n,i,a,o,u,y){super(t,n,i,a),this.client=e,this.logger=r,this.fields=o,this._isResponseInArrayMode=u,this.customResultMapper=y,this.clientQuery=e.query??e}static[E]="NeonHttpPreparedQuery";clientQuery;async execute(e={},t=this.authToken){let r=An(this.query.params,e);this.logger.logQuery(this.query.sql,r);let{fields:n,clientQuery:i,query:a,customResultMapper:o}=this;if(!n&&!o)return this.queryWithCache(a.sql,r,async()=>i(a.sql,r,t===void 0?si:{...si,authToken:t}));let u=await this.queryWithCache(a.sql,r,async()=>await i(a.sql,r,t===void 0?Za:{...Za,authToken:t}));return this.mapResult(u)}mapResult(e){if(!this.fields&&!this.customResultMapper)return e;let t=e.rows;return this.customResultMapper?this.customResultMapper(t):t.map(r=>ac(this.fields,r,this.joinsNotNullableMap))}all(e={}){let t=An(this.query.params,e);return this.logger.logQuery(this.query.sql,t),this.clientQuery(this.query.sql,t,this.authToken===void 0?si:{...si,authToken:this.authToken}).then(r=>r.rows)}values(e={},t){let r=An(this.query.params,e);return this.logger.logQuery(this.query.sql,r),this.clientQuery(this.query.sql,r,{arrayMode:!0,fullResults:!0,authToken:t}).then(n=>n.rows)}isResponseInArrayMode(){return this._isResponseInArrayMode}},ni=class extends ti{constructor(e,t,r,n={}){super(t),this.client=e,this.schema=r,this.options=n,this.clientQuery=e.query??e,this.logger=n.logger??new Pn,this.cache=n.cache??new Nr}static[E]="NeonHttpSession";clientQuery;logger;cache;prepareQuery(e,t,r,n,i,a,o){return new el(this.client,e,this.logger,this.cache,a,o,t,n,i)}async batch(e){let t=[],r=[];for(let i of e){let a=i._prepare(),o=a.getQuery();t.push(a),r.push(this.clientQuery(o.sql,o.params,{fullResults:!0,arrayMode:a.isResponseInArrayMode()}))}return(await this.client.transaction(r,Za)).map((i,a)=>t[a].mapResult(i,!0))}async query(e,t){return this.logger.logQuery(e,t),await this.clientQuery(e,t,{arrayMode:!0,fullResults:!0})}async queryObjects(e,t){return this.clientQuery(e,t,{arrayMode:!1,fullResults:!0})}async count(e,t){let r=await this.execute(e,t);return Number(r.rows[0].count)}async transaction(e,t={}){throw new Error("No transactions support in neon-http driver")}},uh=class extends ri{static[E]="NeonHttpTransaction";async transaction(e){throw new Error("No transactions support in neon-http driver")}};var tl=class{constructor(e,t,r={}){this.client=e,this.dialect=t,this.options=r,this.initMappers()}static[E]="NeonHttpDriver";createSession(e){return new ni(this.client,this.dialect,e,{logger:this.options.logger,cache:this.options.cache})}initMappers(){Ue.setTypeParser(Ue.builtins.TIMESTAMPTZ,e=>e),Ue.setTypeParser(Ue.builtins.TIMESTAMP,e=>e),Ue.setTypeParser(Ue.builtins.DATE,e=>e),Ue.setTypeParser(Ue.builtins.INTERVAL,e=>e),Ue.setTypeParser(1231,e=>e),Ue.setTypeParser(1115,e=>e),Ue.setTypeParser(1185,e=>e),Ue.setTypeParser(1187,e=>e),Ue.setTypeParser(1182,e=>e)}};function ii(s,e,t,r){return new Proxy(s,{get(n,i){let a=n[i];return typeof a!="function"&&(typeof a!="object"||a===null)?a:r?ii(a,e,t):i==="query"?ii(a,e,t,!0):new Proxy(a,{apply(o,u,y){let f=o.call(u,...y);return typeof f=="object"&&f!==null&&"setToken"in f&&typeof f.setToken=="function"&&f.setToken(e),t(o,i,f)}})}})}var rl=class extends Or{static[E]="NeonHttpDatabase";$withAuth(e){return this.authToken=e,ii(this,e,(t,r,n)=>r==="with"?ii(n,e,(i,a,o)=>o):n)}async batch(e){return this.session.batch(e)}};function Lr(s,e={}){let t=new Rt({casing:e.casing}),r;e.logger===!0?r=new En:e.logger!==!1&&(r=e.logger);let n;if(e.schema){let u=cu(e.schema,hu);n={fullSchema:e.schema,schema:u.tables,tableNamesMap:u.tableNamesMap}}let a=new tl(s,t,{logger:r,cache:e.cache}).createSession(n),o=new rl(t,a,n);return o.$client=s,o.$cache=e.cache,o.$cache&&(o.$cache.invalidate=e.cache?.onMutate),o}function oi(...s){if(typeof s[0]=="string"){let e=Pr(s[0]);return Lr(e,s[1])}if(uc(s[0])){let{connection:e,client:t,...r}=s[0];if(t)return Lr(t,r);if(typeof e=="object"){let{connectionString:i,...a}=e,o=Pr(i,a);return Lr(o,r)}let n=Pr(e);return Lr(n,r)}return Lr(s[0],s[1])}(s=>{function e(t){return Lr({},t)}s.mock=e})(oi||(oi={}));var sl={};zl(sl,{mealInputType:()=>ph,mealStatus:()=>fh,mealsTable:()=>vt,usersTable:()=>hh});var hh=Oa("users",{id:Ar().primaryKey().defaultRandom(),name:Ze({length:255}).notNull(),email:Ze({length:255}).notNull().unique(),password:Ze({length:255}).notNull(),goal:Ze({length:8}).notNull(),gender:Ze({length:6}).notNull(),birthDate:In("birth_date").notNull(),height:ot().notNull(),weight:ot().notNull(),activityLevel:ot("activity_level").notNull(),calories:ot().notNull(),proteins:ot().notNull(),carbohydrates:ot().notNull(),fats:ot().notNull()}),fh=to("meal_status",["uploading","processing","success","failed"]),ph=to("meal_input_type",["audio","picture"]),vt=Oa("meals",{id:Ar().primaryKey().defaultRandom(),userId:Ar("user_id").notNull().references(()=>hh.id,{onDelete:"cascade"}),status:fh().notNull(),inputType:ph("input_type").notNull(),inputFileKey:Ze("input_file_key",{length:255}).notNull(),name:Ze({length:255}).notNull(),icon:Ze({length:100}).notNull(),foods:Rn(),createdAt:On("created_at").notNull().defaultNow()});var Js=oi(process.env.DATABASE_URL,{schema:sl});function Z(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t}function N(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)}var nl=function(){let{crypto:s}=globalThis;if(s?.randomUUID)return nl=s.randomUUID.bind(s),s.randomUUID();let e=new Uint8Array(1),t=s?()=>s.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^t()&15>>+r/4).toString(16))};function Gs(s){return typeof s=="object"&&s!==null&&("name"in s&&s.name==="AbortError"||"message"in s&&String(s.message).includes("FetchRequestCanceledException"))}var Xs=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null){try{if(Object.prototype.toString.call(s)==="[object Error]"){let e=new Error(s.message,s.cause?{cause:s.cause}:{});return s.stack&&(e.stack=s.stack),s.cause&&!e.cause&&(e.cause=s.cause),s.name&&(e.name=s.name),e}}catch{}try{return new Error(JSON.stringify(s))}catch{}}return new Error(s)};var X=class extends Error{},Pe=class s extends X{constructor(e,t,r,n){super(`${s.makeMessage(e,t,r)}`),this.status=e,this.headers=n,this.requestID=n?.get("x-request-id"),this.error=t;let i=t;this.code=i?.code,this.param=i?.param,this.type=i?.type}static makeMessage(e,t,r){let n=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){if(!e||!n)return new Ot({message:r,cause:Xs(t)});let i=t?.error;return e===400?new $r(e,i,r,n):e===401?new kr(e,i,r,n):e===403?new Br(e,i,r,n):e===404?new Mr(e,i,r,n):e===409?new Fr(e,i,r,n):e===422?new Dr(e,i,r,n):e===429?new qr(e,i,r,n):e>=500?new Qr(e,i,r,n):new s(e,i,r,n)}},Ce=class extends Pe{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Ot=class extends Pe{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Nt=class extends Ot{constructor({message:e}={}){super({message:e??"Request timed out."})}},$r=class extends Pe{},kr=class extends Pe{},Br=class extends Pe{},Mr=class extends Pe{},Fr=class extends Pe{},Dr=class extends Pe{},qr=class extends Pe{},Qr=class extends Pe{},jr=class extends X{constructor(){super("Could not parse response content as the length limit was reached")}},Ur=class extends X{constructor(){super("Could not parse response content as the request was rejected by the content filter")}},at=class extends Error{constructor(e){super(e)}};var Xp=/^[a-z][a-z0-9+.-]*:/i,dh=s=>Xp.test(s),Be=s=>(Be=Array.isArray,Be(s)),il=Be;function mh(s){return typeof s!="object"?{}:s??{}}function gh(s){if(!s)return!0;for(let e in s)return!1;return!0}function yh(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function Ys(s){return s!=null&&typeof s=="object"&&!Array.isArray(s)}var bh=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new X(`${s} must be an integer`);if(e<0)throw new X(`${s} must be a positive integer`);return e};var wh=s=>{try{return JSON.parse(s)}catch{return}};var lt=s=>new Promise(e=>setTimeout(e,s));var Lt="5.10.1";var xh=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function Yp(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var Zp=()=>{let s=Yp();if(s==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Lt,"X-Stainless-OS":Sh(Deno.build.os),"X-Stainless-Arch":_h(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Lt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(s==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Lt,"X-Stainless-OS":Sh(globalThis.process.platform??"unknown"),"X-Stainless-Arch":_h(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let e=ed();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Lt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Lt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function ed(){if(typeof navigator>"u"||!navigator)return null;let s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of s){let r=t.exec(navigator.userAgent);if(r){let n=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${n}.${i}.${a}`}}}return null}var _h=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",Sh=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown"),vh,Ah=()=>vh??(vh=Zp());function Ch(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function ol(...s){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...s)}function ai(s){let e=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s[Symbol.iterator]();return ol({start(){},async pull(t){let{done:r,value:n}=await e.next();r?t.close():t.enqueue(n)},async cancel(){await e.return?.()}})}function al(s){if(s[Symbol.asyncIterator])return s;let e=s.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Eh(s){if(s===null||typeof s!="object")return;if(s[Symbol.asyncIterator]){await s[Symbol.asyncIterator]().return?.();return}let e=s.getReader(),t=e.cancel();e.releaseLock(),await t}var Ph=({headers:s,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var li="RFC3986",ll=s=>String(s),ci={RFC1738:s=>String(s).replace(/%20/g,"+"),RFC3986:ll},cl="RFC1738";var ui=(s,e)=>(ui=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),ui(s,e)),ct=(()=>{let s=[];for(let e=0;e<256;++e)s.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return s})();var ul=1024,Th=(s,e,t,r,n)=>{if(s.length===0)return s;let i=s;if(typeof s=="symbol"?i=Symbol.prototype.toString.call(s):typeof s!="string"&&(i=String(s)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=ul){let u=i.length>=ul?i.slice(o,o+ul):i,y=[];for(let f=0;f<u.length;++f){let p=u.charCodeAt(f);if(p===45||p===46||p===95||p===126||p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||n===cl&&(p===40||p===41)){y[y.length]=u.charAt(f);continue}if(p<128){y[y.length]=ct[p];continue}if(p<2048){y[y.length]=ct[192|p>>6]+ct[128|p&63];continue}if(p<55296||p>=57344){y[y.length]=ct[224|p>>12]+ct[128|p>>6&63]+ct[128|p&63];continue}f+=1,p=65536+((p&1023)<<10|u.charCodeAt(f)&1023),y[y.length]=ct[240|p>>18]+ct[128|p>>12&63]+ct[128|p>>6&63]+ct[128|p&63]}a+=y.join("")}return a};function Ih(s){return!s||typeof s!="object"?!1:!!(s.constructor&&s.constructor.isBuffer&&s.constructor.isBuffer(s))}function hl(s,e){if(Be(s)){let t=[];for(let r=0;r<s.length;r+=1)t.push(e(s[r]));return t}return e(s)}var Oh={brackets(s){return String(s)+"[]"},comma:"comma",indices(s,e){return String(s)+"["+e+"]"},repeat(s){return String(s)}},Nh=function(s,e){Array.prototype.push.apply(s,Be(e)?e:[e])},Rh,Te={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Th,encodeValuesOnly:!1,format:li,formatter:ll,indices:!1,serializeDate(s){return(Rh??(Rh=Function.prototype.call.bind(Date.prototype.toISOString)))(s)},skipNulls:!1,strictNullHandling:!1};function sd(s){return typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="symbol"||typeof s=="bigint"}var fl={};function Lh(s,e,t,r,n,i,a,o,u,y,f,p,d,m,g,c,_,S){let v=s,A=S,L=0,k=!1;for(;(A=A.get(fl))!==void 0&&!k;){let B=A.get(s);if(L+=1,typeof B<"u"){if(B===L)throw new RangeError("Cyclic object value");k=!0}typeof A.get(fl)>"u"&&(L=0)}if(typeof y=="function"?v=y(e,v):v instanceof Date?v=d?.(v):t==="comma"&&Be(v)&&(v=hl(v,function(B){return B instanceof Date?d?.(B):B})),v===null){if(i)return u&&!c?u(e,Te.encoder,_,"key",m):e;v=""}if(sd(v)||Ih(v)){if(u){let B=c?e:u(e,Te.encoder,_,"key",m);return[g?.(B)+"="+g?.(u(v,Te.encoder,_,"value",m))]}return[g?.(e)+"="+g?.(String(v))]}let x=[];if(typeof v>"u")return x;let T;if(t==="comma"&&Be(v))c&&u&&(v=hl(v,u)),T=[{value:v.length>0?v.join(",")||null:void 0}];else if(Be(y))T=y;else{let B=Object.keys(v);T=f?B.sort(f):B}let P=o?String(e).replace(/\./g,"%2E"):String(e),C=r&&Be(v)&&v.length===1?P+"[]":P;if(n&&Be(v)&&v.length===0)return C+"[]";for(let B=0;B<T.length;++B){let $=T[B],H=typeof $=="object"&&typeof $.value<"u"?$.value:v[$];if(a&&H===null)continue;let K=p&&o?$.replace(/\./g,"%2E"):$,M=Be(v)?typeof t=="function"?t(C,K):C:C+(p?"."+K:"["+K+"]");S.set(s,L);let j=new WeakMap;j.set(fl,S),Nh(x,Lh(H,M,t,r,n,i,a,o,t==="comma"&&c&&Be(v)?null:u,y,f,p,d,m,g,c,_,j))}return x}function nd(s=Te){if(typeof s.allowEmptyArrays<"u"&&typeof s.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof s.encodeDotInKeys<"u"&&typeof s.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(s.encoder!==null&&typeof s.encoder<"u"&&typeof s.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=s.charset||Te.charset;if(typeof s.charset<"u"&&s.charset!=="utf-8"&&s.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=li;if(typeof s.format<"u"){if(!ui(ci,s.format))throw new TypeError("Unknown format option provided.");t=s.format}let r=ci[t],n=Te.filter;(typeof s.filter=="function"||Be(s.filter))&&(n=s.filter);let i;if(s.arrayFormat&&s.arrayFormat in Oh?i=s.arrayFormat:"indices"in s?i=s.indices?"indices":"repeat":i=Te.arrayFormat,"commaRoundTrip"in s&&typeof s.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let a=typeof s.allowDots>"u"?s.encodeDotInKeys?!0:Te.allowDots:!!s.allowDots;return{addQueryPrefix:typeof s.addQueryPrefix=="boolean"?s.addQueryPrefix:Te.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof s.allowEmptyArrays=="boolean"?!!s.allowEmptyArrays:Te.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof s.charsetSentinel=="boolean"?s.charsetSentinel:Te.charsetSentinel,commaRoundTrip:!!s.commaRoundTrip,delimiter:typeof s.delimiter>"u"?Te.delimiter:s.delimiter,encode:typeof s.encode=="boolean"?s.encode:Te.encode,encodeDotInKeys:typeof s.encodeDotInKeys=="boolean"?s.encodeDotInKeys:Te.encodeDotInKeys,encoder:typeof s.encoder=="function"?s.encoder:Te.encoder,encodeValuesOnly:typeof s.encodeValuesOnly=="boolean"?s.encodeValuesOnly:Te.encodeValuesOnly,filter:n,format:t,formatter:r,serializeDate:typeof s.serializeDate=="function"?s.serializeDate:Te.serializeDate,skipNulls:typeof s.skipNulls=="boolean"?s.skipNulls:Te.skipNulls,sort:typeof s.sort=="function"?s.sort:null,strictNullHandling:typeof s.strictNullHandling=="boolean"?s.strictNullHandling:Te.strictNullHandling}}function pl(s,e={}){let t=s,r=nd(e),n,i;typeof r.filter=="function"?(i=r.filter,t=i("",t)):Be(r.filter)&&(i=r.filter,n=i);let a=[];if(typeof t!="object"||t===null)return"";let o=Oh[r.arrayFormat],u=o==="comma"&&r.commaRoundTrip;n||(n=Object.keys(t)),r.sort&&n.sort(r.sort);let y=new WeakMap;for(let d=0;d<n.length;++d){let m=n[d];r.skipNulls&&t[m]===null||Nh(a,Lh(t[m],m,o,u,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,y))}let f=a.join(r.delimiter),p=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),f.length>0?p+f:""}function Bh(s){let e=0;for(let n of s)e+=n.length;let t=new Uint8Array(e),r=0;for(let n of s)t.set(n,r),r+=n.length;return t}var $h;function Wr(s){let e;return($h??(e=new globalThis.TextEncoder,$h=e.encode.bind(e)))(s)}var kh;function dl(s){let e;return(kh??(e=new globalThis.TextDecoder,kh=e.decode.bind(e)))(s)}var Ve,ze,Yt=class{constructor(){Ve.set(this,void 0),ze.set(this,void 0),Z(this,Ve,new Uint8Array,"f"),Z(this,ze,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Wr(e):e;Z(this,Ve,Bh([N(this,Ve,"f"),t]),"f");let r=[],n;for(;(n=od(N(this,Ve,"f"),N(this,ze,"f")))!=null;){if(n.carriage&&N(this,ze,"f")==null){Z(this,ze,n.index,"f");continue}if(N(this,ze,"f")!=null&&(n.index!==N(this,ze,"f")+1||n.carriage)){r.push(dl(N(this,Ve,"f").subarray(0,N(this,ze,"f")-1))),Z(this,Ve,N(this,Ve,"f").subarray(N(this,ze,"f")),"f"),Z(this,ze,null,"f");continue}let i=N(this,ze,"f")!==null?n.preceding-1:n.preceding,a=dl(N(this,Ve,"f").subarray(0,i));r.push(a),Z(this,Ve,N(this,Ve,"f").subarray(n.index),"f"),Z(this,ze,null,"f")}return r}flush(){return N(this,Ve,"f").length?this.decode(`
`):[]}};Ve=new WeakMap,ze=new WeakMap;Yt.NEWLINE_CHARS=new Set([`
`,"\r"]);Yt.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function od(s,e){for(let n=e??0;n<s.length;n++){if(s[n]===10)return{preceding:n,index:n+1,carriage:!1};if(s[n]===13)return{preceding:n,index:n+1,carriage:!0}}return null}function Mh(s){for(let r=0;r<s.length-1;r++){if(s[r]===10&&s[r+1]===10||s[r]===13&&s[r+1]===13)return r+2;if(s[r]===13&&s[r+1]===10&&r+3<s.length&&s[r+2]===13&&s[r+3]===10)return r+4}return-1}var fi={off:0,error:200,warn:300,info:400,debug:500},ml=(s,e,t)=>{if(s){if(yh(fi,s))return s;_e(t).warn(`${e} was set to ${JSON.stringify(s)}, expected one of ${JSON.stringify(Object.keys(fi))}`)}};function Zs(){}function hi(s,e,t){return!e||fi[s]>fi[t]?Zs:e[s].bind(e)}var ad={error:Zs,warn:Zs,info:Zs,debug:Zs},Fh=new WeakMap;function _e(s){let e=s.logger,t=s.logLevel??"off";if(!e)return ad;let r=Fh.get(e);if(r&&r[0]===t)return r[1];let n={error:hi("error",e,t),warn:hi("warn",e,t),info:hi("info",e,t),debug:hi("debug",e,t)};return Fh.set(e,[t,n]),n}var xt=s=>(s.options&&(s.options={...s.options},delete s.options.headers),s.headers&&(s.headers=Object.fromEntries((s.headers instanceof Headers?[...s.headers]:Object.entries(s.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in s&&(s.retryOfRequestLogID&&(s.retryOf=s.retryOfRequestLogID),delete s.retryOfRequestLogID),s);var en,ut=class s{constructor(e,t,r){this.iterator=e,en.set(this,void 0),this.controller=t,Z(this,en,r,"f")}static fromSSEResponse(e,t,r){let n=!1,i=r?_e(r):console;async function*a(){if(n)throw new X("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let o=!1;try{for await(let u of ld(e,t))if(!o){if(u.data.startsWith("[DONE]")){o=!0;continue}if(u.event===null||u.event.startsWith("response.")||u.event.startsWith("image_edit.")||u.event.startsWith("image_generation.")||u.event.startsWith("transcript.")){let y;try{y=JSON.parse(u.data)}catch(f){throw i.error("Could not parse message into JSON:",u.data),i.error("From chunk:",u.raw),f}if(y&&y.error)throw new Pe(void 0,y.error,void 0,e.headers);yield y}else{let y;try{y=JSON.parse(u.data)}catch(f){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),f}if(u.event=="error")throw new Pe(void 0,y.error,y.message,void 0);yield{event:u.event,data:y}}}o=!0}catch(u){if(Gs(u))return;throw u}finally{o||t.abort()}}return new s(a,t,r)}static fromReadableStream(e,t,r){let n=!1;async function*i(){let o=new Yt,u=al(e);for await(let y of u)for(let f of o.decode(y))yield f;for(let y of o.flush())yield y}async function*a(){if(n)throw new X("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let o=!1;try{for await(let u of i())o||u&&(yield JSON.parse(u));o=!0}catch(u){if(Gs(u))return;throw u}finally{o||t.abort()}}return new s(a,t,r)}[(en=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),n=i=>({next:()=>{if(i.length===0){let a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new s(()=>n(e),this.controller,N(this,en,"f")),new s(()=>n(t),this.controller,N(this,en,"f"))]}toReadableStream(){let e=this,t;return ol({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{let{value:n,done:i}=await t.next();if(i)return r.close();let a=Wr(JSON.stringify(n)+`
`);r.enqueue(a)}catch(n){r.error(n)}},async cancel(){await t.return?.()}})}};async function*ld(s,e){if(!s.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new X("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new X("Attempted to iterate over a response with no body");let t=new gl,r=new Yt,n=al(s.body);for await(let i of cd(n))for(let a of r.decode(i)){let o=t.decode(a);o&&(yield o)}for(let i of r.flush()){let a=t.decode(i);a&&(yield a)}}async function*cd(s){let e=new Uint8Array;for await(let t of s){if(t==null)continue;let r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?Wr(t):t,n=new Uint8Array(e.length+r.length);n.set(e),n.set(r,e.length),e=n;let i;for(;(i=Mh(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}var gl=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=ud(e,":");return n.startsWith(" ")&&(n=n.substring(1)),t==="event"?this.event=n:t==="data"&&this.data.push(n),null}};function ud(s,e){let t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}async function pi(s,e){let{response:t,requestLogID:r,retryOfRequestLogID:n,startTime:i}=e,a=await(async()=>{if(e.options.stream)return _e(s).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,s):ut.fromSSEResponse(t,e.controller,s);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let u=t.headers.get("content-type")?.split(";")[0]?.trim();if(u?.includes("application/json")||u?.endsWith("+json")){let p=await t.json();return yl(p,t)}return await t.text()})();return _e(s).debug(`[${r}] response parsed`,xt({retryOfRequestLogID:n,url:t.url,status:t.status,body:a,durationMs:Date.now()-i})),a}function yl(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var tn,Zt=class s extends Promise{constructor(e,t,r=pi){super(n=>{n(null)}),this.responsePromise=t,this.parseResponse=r,tn.set(this,void 0),Z(this,tn,e,"f")}_thenUnwrap(e){return new s(N(this,tn,"f"),this.responsePromise,async(t,r)=>yl(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(N(this,tn,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};tn=new WeakMap;var di,mi=class{constructor(e,t,r,n){di.set(this,void 0),Z(this,di,e,"f"),this.options=n,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new X("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await N(this,di,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(di=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},rn=class extends Zt{constructor(e,t,r){super(e,t,async(n,i)=>new r(n,i.response,await pi(n,i),i.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},ht=class extends mi{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}},ae=class extends mi{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...mh(this.options.query),after:t}}:null}};var wl=()=>{if(typeof File>"u"){let{process:s}=globalThis,e=typeof s?.versions?.node=="string"&&parseInt(s.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Vr(s,e,t){return wl(),new File(s,e??"unknown_file",t)}function sn(s){return(typeof s=="object"&&s!==null&&("name"in s&&s.name&&String(s.name)||"url"in s&&s.url&&String(s.url)||"filename"in s&&s.filename&&String(s.filename)||"path"in s&&s.path&&String(s.path))||"").split(/[\\/]/).pop()||void 0}var _l=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function";var Ke=async(s,e)=>({...s,body:await pd(s.body,e)}),Dh=new WeakMap;function fd(s){let e=typeof s=="function"?s:s.fetch,t=Dh.get(e);if(t)return t;let r=(async()=>{try{let n="Response"in e?e.Response:(await e("data:,")).constructor,i=new FormData;return i.toString()!==await new n(i).text()}catch{return!0}})();return Dh.set(e,r),r}var pd=async(s,e)=>{if(!await fd(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let t=new FormData;return await Promise.all(Object.entries(s||{}).map(([r,n])=>bl(t,r,n))),t},dd=s=>s instanceof Blob&&"name"in s;var bl=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(t instanceof Response)s.append(e,Vr([await t.blob()],sn(t)));else if(_l(t))s.append(e,Vr([await new Response(ai(t)).blob()],sn(t)));else if(dd(t))s.append(e,t,sn(t));else if(Array.isArray(t))await Promise.all(t.map(r=>bl(s,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,n])=>bl(s,`${e}[${r}]`,n)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var qh=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",md=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&qh(s),gd=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function";async function zr(s,e,t){if(wl(),s=await s,md(s))return s instanceof File?s:Vr([await s.arrayBuffer()],s.name);if(gd(s)){let n=await s.blob();return e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()),Vr(await Sl(n),e,t)}let r=await Sl(s);if(e||(e=sn(s)),!t?.type){let n=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof n=="string"&&(t={...t,type:n})}return Vr(r,e,t)}async function Sl(s){let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(qh(s))e.push(s instanceof Blob?s:await s.arrayBuffer());else if(_l(s))for await(let t of s)e.push(...await Sl(t));else{let t=s?.constructor?.name;throw new Error(`Unexpected data type: ${typeof s}${t?`; constructor: ${t}`:""}${yd(s)}`)}return e}function yd(s){return typeof s!="object"||s===null?"":`; props: [${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}var Q=class{constructor(e){this._client=e}};function jh(s){return s.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var Qh=Object.freeze(Object.create(null)),wd=(s=jh)=>function(t,...r){if(t.length===1)return t[0];let n=!1,i=[],a=t.reduce((f,p,d)=>{/[?#]/.test(p)&&(n=!0);let m=r[d],g=(n?encodeURIComponent:s)(""+m);return d!==r.length&&(m==null||typeof m=="object"&&m.toString===Object.getPrototypeOf(Object.getPrototypeOf(m.hasOwnProperty??Qh)??Qh)?.toString)&&(g=m+"",i.push({start:f.length+p.length,length:g.length,error:`Value of type ${Object.prototype.toString.call(m).slice(8,-1)} is not a valid path parameter`})),f+p+(d===r.length?"":g)},""),o=a.split(/[?#]/,1)[0],u=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,y;for(;(y=u.exec(o))!==null;)i.push({start:y.index,length:y[0].length,error:`Value "${y[0]}" can't be safely passed as a path parameter`});if(i.sort((f,p)=>f.start-p.start),i.length>0){let f=0,p=i.reduce((d,m)=>{let g=" ".repeat(m.start-f),c="^".repeat(m.length);return f=m.start+m.length,d+g+c},"");throw new X(`Path parameters result in path with invalid segments:
${i.map(d=>d.error).join(`
`)}
${a}
${p}`)}return a},q=wd(jh);var er=class extends Q{list(e,t={},r){return this._client.getAPIList(q`/chat/completions/${e}/messages`,ae,{query:t,...r})}};function Uh(s){return typeof s.parse=="function"}var Kr=s=>s?.role==="assistant",vl=s=>s?.role==="tool";var xl,gi,yi,nn,on,bi,an,At,ln,wi,_i,Hr,Wh,$t=class{constructor(){xl.add(this),this.controller=new AbortController,gi.set(this,void 0),yi.set(this,()=>{}),nn.set(this,()=>{}),on.set(this,void 0),bi.set(this,()=>{}),an.set(this,()=>{}),At.set(this,{}),ln.set(this,!1),wi.set(this,!1),_i.set(this,!1),Hr.set(this,!1),Z(this,gi,new Promise((e,t)=>{Z(this,yi,e,"f"),Z(this,nn,t,"f")}),"f"),Z(this,on,new Promise((e,t)=>{Z(this,bi,e,"f"),Z(this,an,t,"f")}),"f"),N(this,gi,"f").catch(()=>{}),N(this,on,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},N(this,xl,"m",Wh).bind(this))},0)}_connected(){this.ended||(N(this,yi,"f").call(this),this._emit("connect"))}get ended(){return N(this,ln,"f")}get errored(){return N(this,wi,"f")}get aborted(){return N(this,_i,"f")}abort(){this.controller.abort()}on(e,t){return(N(this,At,"f")[e]||(N(this,At,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=N(this,At,"f")[e];if(!r)return this;let n=r.findIndex(i=>i.listener===t);return n>=0&&r.splice(n,1),this}once(e,t){return(N(this,At,"f")[e]||(N(this,At,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Z(this,Hr,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Z(this,Hr,!0,"f"),await N(this,on,"f")}_emit(e,...t){if(N(this,ln,"f"))return;e==="end"&&(Z(this,ln,!0,"f"),N(this,bi,"f").call(this));let r=N(this,At,"f")[e];if(r&&(N(this,At,"f")[e]=r.filter(n=>!n.once),r.forEach(({listener:n})=>n(...t))),e==="abort"){let n=t[0];!N(this,Hr,"f")&&!r?.length&&Promise.reject(n),N(this,nn,"f").call(this,n),N(this,an,"f").call(this,n),this._emit("end");return}if(e==="error"){let n=t[0];!N(this,Hr,"f")&&!r?.length&&Promise.reject(n),N(this,nn,"f").call(this,n),N(this,an,"f").call(this,n),this._emit("end")}}_emitFinal(){}};gi=new WeakMap,yi=new WeakMap,nn=new WeakMap,on=new WeakMap,bi=new WeakMap,an=new WeakMap,At=new WeakMap,ln=new WeakMap,wi=new WeakMap,_i=new WeakMap,Hr=new WeakMap,xl=new WeakSet,Wh=function(e){if(Z(this,wi,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Ce),e instanceof Ce)return Z(this,_i,!0,"f"),this._emit("abort",e);if(e instanceof X)return this._emit("error",e);if(e instanceof Error){let t=new X(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new X(String(e)))};function cn(s){return s?.$brand==="auto-parseable-response-format"}function tr(s){return s?.$brand==="auto-parseable-tool"}function Vh(s,e){return!e||!Al(e)?{...s,choices:s.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:un(s,e)}function un(s,e){let t=s.choices.map(r=>{if(r.finish_reason==="length")throw new jr;if(r.finish_reason==="content_filter")throw new Ur;return{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:r.message.tool_calls?.map(n=>xd(e,n))??void 0}:void 0,parsed:r.message.content&&!r.message.refusal?vd(e,r.message.content):null}}});return{...s,choices:t}}function vd(s,e){return s.response_format?.type!=="json_schema"?null:s.response_format?.type==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(e):JSON.parse(e):null}function xd(s,e){let t=s.tools?.find(r=>r.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:tr(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null}}}function zh(s,e){if(!s)return!1;let t=s.tools?.find(r=>r.function?.name===e.function.name);return tr(t)||t?.function.strict||!1}function Al(s){return cn(s.response_format)?!0:s.tools?.some(e=>tr(e)||e.type==="function"&&e.function.strict===!0)??!1}function Kh(s){for(let e of s??[]){if(e.type!=="function")throw new X(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new X(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Fe,Cl,Si,El,Pl,Tl,Hh,Jh,Ad=10,Jr=class extends $t{constructor(){super(...arguments),Fe.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),vl(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(Kr(e)&&e.tool_calls)for(let r of e.tool_calls)r.type==="function"&&this._emit("functionToolCall",r.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new X("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),N(this,Fe,"m",Cl).call(this)}async finalMessage(){return await this.done(),N(this,Fe,"m",Si).call(this)}async finalFunctionToolCall(){return await this.done(),N(this,Fe,"m",El).call(this)}async finalFunctionToolCallResult(){return await this.done(),N(this,Fe,"m",Pl).call(this)}async totalUsage(){return await this.done(),N(this,Fe,"m",Tl).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=N(this,Fe,"m",Si).call(this);t&&this._emit("finalMessage",t);let r=N(this,Fe,"m",Cl).call(this);r&&this._emit("finalContent",r);let n=N(this,Fe,"m",El).call(this);n&&this._emit("finalFunctionToolCall",n);let i=N(this,Fe,"m",Pl).call(this);i!=null&&this._emit("finalFunctionToolCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",N(this,Fe,"m",Tl).call(this))}async _createChatCompletion(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),N(this,Fe,"m",Hh).call(this,t);let i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(un(i,t))}async _runChatCompletion(e,t,r){for(let n of t.messages)this._addMessage(n,!1);return await this._createChatCompletion(e,t,r)}async _runTools(e,t,r){let n="tool",{tool_choice:i="auto",stream:a,...o}=t,u=typeof i!="string"&&i?.function?.name,{maxChatCompletions:y=Ad}=r||{},f=t.tools.map(m=>{if(tr(m)){if(!m.$callback)throw new X("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:m.$callback,name:m.function.name,description:m.function.description||"",parameters:m.function.parameters,parse:m.$parseRaw,strict:!0}}}return m}),p={};for(let m of f)m.type==="function"&&(p[m.function.name||m.function.function.name]=m.function);let d="tools"in t?f.map(m=>m.type==="function"?{type:"function",function:{name:m.function.name||m.function.function.name,parameters:m.function.parameters,description:m.function.description,strict:m.function.strict}}:m):void 0;for(let m of t.messages)this._addMessage(m,!1);for(let m=0;m<y;++m){let c=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:d,messages:[...this.messages]},r)).choices[0]?.message;if(!c)throw new X("missing message in ChatCompletion response");if(!c.tool_calls?.length)return;for(let _ of c.tool_calls){if(_.type!=="function")continue;let S=_.id,{name:v,arguments:A}=_.function,L=p[v];if(L){if(u&&u!==v){let P=`Invalid tool_call: ${JSON.stringify(v)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:n,tool_call_id:S,content:P});continue}}else{let P=`Invalid tool_call: ${JSON.stringify(v)}. Available options are: ${Object.keys(p).map(C=>JSON.stringify(C)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:S,content:P});continue}let k;try{k=Uh(L)?await L.parse(A):A}catch(P){let C=P instanceof Error?P.message:String(P);this._addMessage({role:n,tool_call_id:S,content:C});continue}let x=await L.function(k,this),T=N(this,Fe,"m",Jh).call(this,x);if(this._addMessage({role:n,tool_call_id:S,content:T}),u)return}}}};Fe=new WeakSet,Cl=function(){return N(this,Fe,"m",Si).call(this).content??null},Si=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(Kr(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new X("stream ended without producing a ChatCompletionMessage with role=assistant")},El=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Kr(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},Pl=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(vl(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>r.role==="assistant"&&r.tool_calls?.some(n=>n.type==="function"&&n.id===t.tool_call_id)))return t.content}},Tl=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Hh=function(e){if(e.n!=null&&e.n>1)throw new X("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Jh=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var hn=class s extends Jr{static runTools(e,t,r){let n=new s,i={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,i)),n}_addMessage(e,t=!0){super._addMessage(e,t),Kr(e)&&e.content&&this._emit("content",e.content)}};var Ne={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},Il=class extends Error{},Rl=class extends Error{};function Cd(s,e=Ne.ALL){if(typeof s!="string")throw new TypeError(`expecting str, got ${typeof s}`);if(!s.trim())throw new Error(`${s} is empty`);return Ed(s.trim(),e)}var Ed=(s,e)=>{let t=s.length,r=0,n=d=>{throw new Il(`${d} at position ${r}`)},i=d=>{throw new Rl(`${d} at position ${r}`)},a=()=>(p(),r>=t&&n("Unexpected end of input"),s[r]==='"'?o():s[r]==="{"?u():s[r]==="["?y():s.substring(r,r+4)==="null"||Ne.NULL&e&&t-r<4&&"null".startsWith(s.substring(r))?(r+=4,null):s.substring(r,r+4)==="true"||Ne.BOOL&e&&t-r<4&&"true".startsWith(s.substring(r))?(r+=4,!0):s.substring(r,r+5)==="false"||Ne.BOOL&e&&t-r<5&&"false".startsWith(s.substring(r))?(r+=5,!1):s.substring(r,r+8)==="Infinity"||Ne.INFINITY&e&&t-r<8&&"Infinity".startsWith(s.substring(r))?(r+=8,1/0):s.substring(r,r+9)==="-Infinity"||Ne.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(s.substring(r))?(r+=9,-1/0):s.substring(r,r+3)==="NaN"||Ne.NAN&e&&t-r<3&&"NaN".startsWith(s.substring(r))?(r+=3,NaN):f()),o=()=>{let d=r,m=!1;for(r++;r<t&&(s[r]!=='"'||m&&s[r-1]==="\\");)m=s[r]==="\\"?!m:!1,r++;if(s.charAt(r)=='"')try{return JSON.parse(s.substring(d,++r-Number(m)))}catch(g){i(String(g))}else if(Ne.STR&e)try{return JSON.parse(s.substring(d,r-Number(m))+'"')}catch{return JSON.parse(s.substring(d,s.lastIndexOf("\\"))+'"')}n("Unterminated string literal")},u=()=>{r++,p();let d={};try{for(;s[r]!=="}";){if(p(),r>=t&&Ne.OBJ&e)return d;let m=o();p(),r++;try{let g=a();Object.defineProperty(d,m,{value:g,writable:!0,enumerable:!0,configurable:!0})}catch(g){if(Ne.OBJ&e)return d;throw g}p(),s[r]===","&&r++}}catch{if(Ne.OBJ&e)return d;n("Expected '}' at end of object")}return r++,d},y=()=>{r++;let d=[];try{for(;s[r]!=="]";)d.push(a()),p(),s[r]===","&&r++}catch{if(Ne.ARR&e)return d;n("Expected ']' at end of array")}return r++,d},f=()=>{if(r===0){s==="-"&&Ne.NUM&e&&n("Not sure what '-' is");try{return JSON.parse(s)}catch(m){if(Ne.NUM&e)try{return s[s.length-1]==="."?JSON.parse(s.substring(0,s.lastIndexOf("."))):JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch{}i(String(m))}}let d=r;for(s[r]==="-"&&r++;s[r]&&!",]}".includes(s[r]);)r++;r==t&&!(Ne.NUM&e)&&n("Unterminated number literal");try{return JSON.parse(s.substring(d,r))}catch{s.substring(d,r)==="-"&&Ne.NUM&e&&n("Not sure what '-' is");try{return JSON.parse(s.substring(d,s.lastIndexOf("e")))}catch(g){i(String(g))}}},p=()=>{for(;r<t&&` 
\r	`.includes(s[r]);)r++};return a()},Ol=s=>Cd(s,Ne.ALL^Ne.NUM);var Ie,Ct,Gr,kt,Nl,vi,Ll,$l,kl,xi,Bl,Gh,rr=class s extends Jr{constructor(e){super(),Ie.add(this),Ct.set(this,void 0),Gr.set(this,void 0),kt.set(this,void 0),Z(this,Ct,e,"f"),Z(this,Gr,[],"f")}get currentChatCompletionSnapshot(){return N(this,kt,"f")}static fromReadableStream(e){let t=new s(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let n=new s(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,r){super._createChatCompletion;let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),N(this,Ie,"m",Nl).call(this);let i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(let a of i)N(this,Ie,"m",Ll).call(this,a);if(i.controller.signal?.aborted)throw new Ce;return this._addChatCompletion(N(this,Ie,"m",xi).call(this))}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),N(this,Ie,"m",Nl).call(this),this._connected();let n=ut.fromReadableStream(e,this.controller),i;for await(let a of n)i&&i!==a.id&&this._addChatCompletion(N(this,Ie,"m",xi).call(this)),N(this,Ie,"m",Ll).call(this,a),i=a.id;if(n.controller.signal?.aborted)throw new Ce;return this._addChatCompletion(N(this,Ie,"m",xi).call(this))}[(Ct=new WeakMap,Gr=new WeakMap,kt=new WeakMap,Ie=new WeakSet,Nl=function(){this.ended||Z(this,kt,void 0,"f")},vi=function(t){let r=N(this,Gr,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},N(this,Gr,"f")[t.index]=r,r)},Ll=function(t){if(this.ended)return;let r=N(this,Ie,"m",Gh).call(this,t);this._emit("chunk",t,r);for(let n of t.choices){let i=r.choices[n.index];n.delta.content!=null&&i.message?.role==="assistant"&&i.message?.content&&(this._emit("content",n.delta.content,i.message.content),this._emit("content.delta",{delta:n.delta.content,snapshot:i.message.content,parsed:i.message.parsed})),n.delta.refusal!=null&&i.message?.role==="assistant"&&i.message?.refusal&&this._emit("refusal.delta",{delta:n.delta.refusal,snapshot:i.message.refusal}),n.logprobs?.content!=null&&i.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:n.logprobs?.content,snapshot:i.logprobs?.content??[]}),n.logprobs?.refusal!=null&&i.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:n.logprobs?.refusal,snapshot:i.logprobs?.refusal??[]});let a=N(this,Ie,"m",vi).call(this,i);i.finish_reason&&(N(this,Ie,"m",kl).call(this,i),a.current_tool_call_index!=null&&N(this,Ie,"m",$l).call(this,i,a.current_tool_call_index));for(let o of n.delta.tool_calls??[])a.current_tool_call_index!==o.index&&(N(this,Ie,"m",kl).call(this,i),a.current_tool_call_index!=null&&N(this,Ie,"m",$l).call(this,i,a.current_tool_call_index)),a.current_tool_call_index=o.index;for(let o of n.delta.tool_calls??[]){let u=i.message.tool_calls?.[o.index];u?.type&&(u?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:u.function?.name,index:o.index,arguments:u.function.arguments,parsed_arguments:u.function.parsed_arguments,arguments_delta:o.function?.arguments??""}):(u?.type,void 0))}}},$l=function(t,r){if(N(this,Ie,"m",vi).call(this,t).done_tool_calls.has(r))return;let i=t.message.tool_calls?.[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){let a=N(this,Ct,"f")?.tools?.find(o=>o.type==="function"&&o.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:tr(a)?a.$parseRaw(i.function.arguments):a?.function.strict?JSON.parse(i.function.arguments):null})}else i.type},kl=function(t){let r=N(this,Ie,"m",vi).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;let n=N(this,Ie,"m",Bl).call(this);this._emit("content.done",{content:t.message.content,parsed:n?n.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},xi=function(){if(this.ended)throw new X("stream has ended, this shouldn't happen");let t=N(this,kt,"f");if(!t)throw new X("request ended without sending any chunks");return Z(this,kt,void 0,"f"),Z(this,Gr,[],"f"),Pd(t,N(this,Ct,"f"))},Bl=function(){let t=N(this,Ct,"f")?.response_format;return cn(t)?t:null},Gh=function(t){var r,n,i,a;let o=N(this,kt,"f"),{choices:u,...y}=t;o?Object.assign(o,y):o=Z(this,kt,{...y,choices:[]},"f");for(let{delta:f,finish_reason:p,index:d,logprobs:m=null,...g}of t.choices){let c=o.choices[d];if(c||(c=o.choices[d]={finish_reason:p,index:d,message:{},logprobs:m,...g}),m)if(!c.logprobs)c.logprobs=Object.assign({},m);else{let{content:x,refusal:T,...P}=m;Object.assign(c.logprobs,P),x&&((r=c.logprobs).content??(r.content=[]),c.logprobs.content.push(...x)),T&&((n=c.logprobs).refusal??(n.refusal=[]),c.logprobs.refusal.push(...T))}if(p&&(c.finish_reason=p,N(this,Ct,"f")&&Al(N(this,Ct,"f")))){if(p==="length")throw new jr;if(p==="content_filter")throw new Ur}if(Object.assign(c,g),!f)continue;let{content:_,refusal:S,function_call:v,role:A,tool_calls:L,...k}=f;if(Object.assign(c.message,k),S&&(c.message.refusal=(c.message.refusal||"")+S),A&&(c.message.role=A),v&&(c.message.function_call?(v.name&&(c.message.function_call.name=v.name),v.arguments&&((i=c.message.function_call).arguments??(i.arguments=""),c.message.function_call.arguments+=v.arguments)):c.message.function_call=v),_&&(c.message.content=(c.message.content||"")+_,!c.message.refusal&&N(this,Ie,"m",Bl).call(this)&&(c.message.parsed=Ol(c.message.content))),L){c.message.tool_calls||(c.message.tool_calls=[]);for(let{index:x,id:T,type:P,function:C,...B}of L){let $=(a=c.message.tool_calls)[x]??(a[x]={});Object.assign($,B),T&&($.id=T),P&&($.type=P),C&&($.function??($.function={name:C.name??"",arguments:""})),C?.name&&($.function.name=C.name),C?.arguments&&($.function.arguments+=C.arguments,zh(N(this,Ct,"f"),$)&&($.function.parsed_arguments=Ol($.function.arguments)))}}}return o},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",n=>{let i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{r=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),this.on("error",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ut(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function Pd(s,e){let{id:t,choices:r,created:n,model:i,system_fingerprint:a,...o}=s,u={...o,id:t,choices:r.map(({message:y,finish_reason:f,index:p,logprobs:d,...m})=>{if(!f)throw new X(`missing finish_reason for choice ${p}`);let{content:g=null,function_call:c,tool_calls:_,...S}=y,v=y.role;if(!v)throw new X(`missing role for choice ${p}`);if(c){let{arguments:A,name:L}=c;if(A==null)throw new X(`missing function_call.arguments for choice ${p}`);if(!L)throw new X(`missing function_call.name for choice ${p}`);return{...m,message:{content:g,function_call:{arguments:A,name:L},role:v,refusal:y.refusal??null},finish_reason:f,index:p,logprobs:d}}return _?{...m,index:p,finish_reason:f,logprobs:d,message:{...S,role:v,content:g,refusal:y.refusal??null,tool_calls:_.map((A,L)=>{let{function:k,type:x,id:T,...P}=A,{arguments:C,name:B,...$}=k||{};if(T==null)throw new X(`missing choices[${p}].tool_calls[${L}].id
${Ai(s)}`);if(x==null)throw new X(`missing choices[${p}].tool_calls[${L}].type
${Ai(s)}`);if(B==null)throw new X(`missing choices[${p}].tool_calls[${L}].function.name
${Ai(s)}`);if(C==null)throw new X(`missing choices[${p}].tool_calls[${L}].function.arguments
${Ai(s)}`);return{...P,id:T,type:x,function:{...$,name:B,arguments:C}}})}}:{...m,message:{...S,content:g,role:v,refusal:y.refusal??null},finish_reason:f,index:p,logprobs:d}}),created:n,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return Vh(u,e)}function Ai(s){return JSON.stringify(s)}var fn=class s extends rr{static fromReadableStream(e){let t=new s(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,r){let n=new s(t),i={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,i)),n}};var Et=class extends Q{constructor(){super(...arguments),this.messages=new er(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(q`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(q`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/chat/completions",ae,{query:e,...t})}delete(e,t){return this._client.delete(q`/chat/completions/${e}`,t)}parse(e,t){return Kh(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(r=>un(r,e))}runTools(e,t){return e.stream?fn.runTools(this._client,e,t):hn.runTools(this._client,e,t)}stream(e,t){return rr.createChatCompletion(this._client,e,t)}};Et.Messages=er;var Bt=class extends Q{constructor(){super(...arguments),this.completions=new Et(this._client)}};Bt.Completions=Et;var Xh=Symbol("brand.privateNullableHeaders");function*Id(s){if(!s)return;if(Xh in s){let{values:r,nulls:n}=s;yield*r.entries();for(let i of n)yield[i,null];return}let e=!1,t;s instanceof Headers?t=s.entries():il(s)?t=s:(e=!0,t=Object.entries(s??{}));for(let r of t){let n=r[0];if(typeof n!="string")throw new TypeError("expected header name to be a string");let i=il(r[1])?r[1]:[r[1]],a=!1;for(let o of i)o!==void 0&&(e&&!a&&(a=!0,yield[n,null]),yield[n,o])}}var z=s=>{let e=new Headers,t=new Set;for(let r of s){let n=new Set;for(let[i,a]of Id(r)){let o=i.toLowerCase();n.has(o)||(e.delete(i),n.add(o)),a===null?(e.delete(i),t.add(o)):(e.append(i,a),t.delete(o))}}return{[Xh]:!0,values:e,nulls:t}};var Xr=class extends Q{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:z([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}};var Yr=class extends Q{create(e,t){return this._client.post("/audio/transcriptions",Ke({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}};var Zr=class extends Q{create(e,t){return this._client.post("/audio/translations",Ke({body:e,...t,__metadata:{model:e.model}},this._client))}};var ft=class extends Q{constructor(){super(...arguments),this.transcriptions=new Yr(this._client),this.translations=new Zr(this._client),this.speech=new Xr(this._client)}};ft.Transcriptions=Yr;ft.Translations=Zr;ft.Speech=Xr;var sr=class extends Q{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(q`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",ae,{query:e,...t})}cancel(e,t){return this._client.post(q`/batches/${e}/cancel`,t)}};var es=class extends Q{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:z([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(q`/assistants/${e}`,{...t,headers:z([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(q`/assistants/${e}`,{body:t,...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",ae,{query:e,...t,headers:z([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(q`/assistants/${e}`,{...t,headers:z([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var ts=class extends Q{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:z([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var rs=class extends Q{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:z([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var Mt=class extends Q{constructor(){super(...arguments),this.sessions=new ts(this._client),this.transcriptionSessions=new rs(this._client)}};Mt.Sessions=ts;Mt.TranscriptionSessions=rs;var ss=class extends Q{create(e,t,r){return this._client.post(q`/threads/${e}/messages`,{body:t,...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{thread_id:n}=t;return this._client.get(q`/threads/${n}/messages/${e}`,{...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:n,...i}=t;return this._client.post(q`/threads/${n}/messages/${e}`,{body:i,...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(q`/threads/${e}/messages`,ae,{query:t,...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{thread_id:n}=t;return this._client.delete(q`/threads/${n}/messages/${e}`,{...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var ns=class extends Q{retrieve(e,t,r){let{thread_id:n,run_id:i,...a}=t;return this._client.get(q`/threads/${n}/runs/${i}/steps/${e}`,{query:a,...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t,r){let{thread_id:n,...i}=t;return this._client.getAPIList(q`/threads/${n}/runs/${e}/steps`,ae,{query:i,...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var Yh=s=>{if(typeof Buffer<"u"){let e=Buffer.from(s,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(s),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return Array.from(new Float32Array(r.buffer))}};var Ft=s=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[s]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(s)?.trim()};var Le,ir,Ml,pt,Ci,rt,or,is,nr,Ti,He,Ei,Pi,mn,pn,dn,Zh,ef,tf,rf,sf,nf,of,Pt=class extends $t{constructor(){super(...arguments),Le.add(this),Ml.set(this,[]),pt.set(this,{}),Ci.set(this,{}),rt.set(this,void 0),or.set(this,void 0),is.set(this,void 0),nr.set(this,void 0),Ti.set(this,void 0),He.set(this,void 0),Ei.set(this,void 0),Pi.set(this,void 0),mn.set(this,void 0)}[(Ml=new WeakMap,pt=new WeakMap,Ci=new WeakMap,rt=new WeakMap,or=new WeakMap,is=new WeakMap,nr=new WeakMap,Ti=new WeakMap,He=new WeakMap,Ei=new WeakMap,Pi=new WeakMap,mn=new WeakMap,Le=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",n=>{let i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{r=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),this.on("error",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new ir;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=ut.fromReadableStream(e,this.controller);for await(let i of n)N(this,Le,"m",pn).call(this,i);if(n.controller.signal?.aborted)throw new Ce;return this._addRun(N(this,Le,"m",dn).call(this))}toReadableStream(){return new ut(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,n){let i=new ir;return i._run(()=>i._runToolAssistantStream(e,t,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,r,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...r,stream:!0},o=await e.submitToolOutputs(t,a,{...n,signal:this.controller.signal});this._connected();for await(let u of o)N(this,Le,"m",pn).call(this,u);if(o.controller.signal?.aborted)throw new Ce;return this._addRun(N(this,Le,"m",dn).call(this))}static createThreadAssistantStream(e,t,r){let n=new ir;return n._run(()=>n._threadAssistantStream(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,r,n){let i=new ir;return i._run(()=>i._runAssistantStream(e,t,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return N(this,Ei,"f")}currentRun(){return N(this,Pi,"f")}currentMessageSnapshot(){return N(this,rt,"f")}currentRunStepSnapshot(){return N(this,mn,"f")}async finalRunSteps(){return await this.done(),Object.values(N(this,pt,"f"))}async finalMessages(){return await this.done(),Object.values(N(this,Ci,"f"))}async finalRun(){if(await this.done(),!N(this,or,"f"))throw Error("Final run was not received.");return N(this,or,"f")}async _createThreadAssistantStream(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let i={...t,stream:!0},a=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(let o of a)N(this,Le,"m",pn).call(this,o);if(a.controller.signal?.aborted)throw new Ce;return this._addRun(N(this,Le,"m",dn).call(this))}async _createAssistantStream(e,t,r,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...r,stream:!0},o=await e.create(t,a,{...n,signal:this.controller.signal});this._connected();for await(let u of o)N(this,Le,"m",pn).call(this,u);if(o.controller.signal?.aborted)throw new Ce;return this._addRun(N(this,Le,"m",dn).call(this))}static accumulateDelta(e,t){for(let[r,n]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=n;continue}let i=e[r];if(i==null){e[r]=n;continue}if(r==="index"||r==="type"){e[r]=n;continue}if(typeof i=="string"&&typeof n=="string")i+=n;else if(typeof i=="number"&&typeof n=="number")i+=n;else if(Ys(i)&&Ys(n))i=this.accumulateDelta(i,n);else if(Array.isArray(i)&&Array.isArray(n)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...n);continue}for(let a of n){if(!Ys(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);let o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let u=i[o];u==null?i.push(a):i[o]=this.accumulateDelta(u,a)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${n}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,n){return await this._createAssistantStream(t,e,r,n)}async _runToolAssistantStream(e,t,r,n){return await this._createToolAssistantStream(t,e,r,n)}};ir=Pt,pn=function(e){if(!this.ended)switch(Z(this,Ei,e,"f"),N(this,Le,"m",tf).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":N(this,Le,"m",of).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":N(this,Le,"m",ef).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":N(this,Le,"m",Zh).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},dn=function(){if(this.ended)throw new X("stream has ended, this shouldn't happen");if(!N(this,or,"f"))throw Error("Final run has not been received");return N(this,or,"f")},Zh=function(e){let[t,r]=N(this,Le,"m",sf).call(this,e,N(this,rt,"f"));Z(this,rt,t,"f"),N(this,Ci,"f")[t.id]=t;for(let n of r){let i=t.content[n.index];i?.type=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let n of e.data.delta.content){if(n.type=="text"&&n.text){let i=n.text,a=t.content[n.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(n.index!=N(this,is,"f")){if(N(this,nr,"f"))switch(N(this,nr,"f").type){case"text":this._emit("textDone",N(this,nr,"f").text,N(this,rt,"f"));break;case"image_file":this._emit("imageFileDone",N(this,nr,"f").image_file,N(this,rt,"f"));break}Z(this,is,n.index,"f")}Z(this,nr,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(N(this,is,"f")!==void 0){let n=e.data.content[N(this,is,"f")];if(n)switch(n.type){case"image_file":this._emit("imageFileDone",n.image_file,N(this,rt,"f"));break;case"text":this._emit("textDone",n.text,N(this,rt,"f"));break}}N(this,rt,"f")&&this._emit("messageDone",e.data),Z(this,rt,void 0,"f")}},ef=function(e){let t=N(this,Le,"m",rf).call(this,e);switch(Z(this,mn,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let i of r.step_details.tool_calls)i.index==N(this,Ti,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(N(this,He,"f")&&this._emit("toolCallDone",N(this,He,"f")),Z(this,Ti,i.index,"f"),Z(this,He,t.step_details.tool_calls[i.index],"f"),N(this,He,"f")&&this._emit("toolCallCreated",N(this,He,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Z(this,mn,void 0,"f"),e.data.step_details.type=="tool_calls"&&N(this,He,"f")&&(this._emit("toolCallDone",N(this,He,"f")),Z(this,He,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},tf=function(e){N(this,Ml,"f").push(e),this._emit("event",e)},rf=function(e){switch(e.event){case"thread.run.step.created":return N(this,pt,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=N(this,pt,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let n=ir.accumulateDelta(t,r.delta);N(this,pt,"f")[e.data.id]=n}return N(this,pt,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":N(this,pt,"f")[e.data.id]=e.data;break}if(N(this,pt,"f")[e.data.id])return N(this,pt,"f")[e.data.id];throw new Error("No snapshot available")},sf=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let i of n.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=N(this,Le,"m",nf).call(this,i,a)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},nf=function(e,t){return ir.accumulateDelta(t,e)},of=function(e){switch(Z(this,Pi,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":Z(this,or,e.data,"f"),N(this,He,"f")&&(this._emit("toolCallDone",N(this,He,"f")),Z(this,He,void 0,"f"));break;case"thread.run.cancelling":break}};var ar=class extends Q{constructor(){super(...arguments),this.steps=new ns(this._client)}create(e,t,r){let{include:n,...i}=t;return this._client.post(q`/threads/${e}/runs`,{query:{include:n},body:i,...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}retrieve(e,t,r){let{thread_id:n}=t;return this._client.get(q`/threads/${n}/runs/${e}`,{...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:n,...i}=t;return this._client.post(q`/threads/${n}/runs/${e}`,{body:i,...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(q`/threads/${e}/runs`,ae,{query:t,...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{thread_id:n}=t;return this._client.post(q`/threads/${n}/runs/${e}/cancel`,{...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let n=await this.create(e,t,r);return await this.poll(n.id,{thread_id:e},r)}createAndStream(e,t,r){return Pt.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let n=z([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:a}=await this.retrieve(e,t,{...r,headers:{...r?.headers,...n}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let u=a.headers.get("openai-poll-after-ms");if(u){let y=parseInt(u);isNaN(y)||(o=y)}}await lt(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return Pt.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r){let{thread_id:n,...i}=t;return this._client.post(q`/threads/${n}/runs/${e}/submit_tool_outputs`,{body:i,...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,r){let n=await this.submitToolOutputs(e,t,r);return await this.poll(n.id,t,r)}submitToolOutputsStream(e,t,r){return Pt.createToolAssistantStream(e,this._client.beta.threads.runs,t,r)}};ar.Steps=ns;var Dt=class extends Q{constructor(){super(...arguments),this.runs=new ar(this._client),this.messages=new ss(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:z([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(q`/threads/${e}`,{...t,headers:z([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(q`/threads/${e}`,{body:t,...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t){return this._client.delete(q`/threads/${e}`,{...t,headers:z([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:z([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.id,{thread_id:r.thread_id},t)}createAndRunStream(e,t){return Pt.createThreadAssistantStream(e,this._client.beta.threads,t)}};Dt.Runs=ar;Dt.Messages=ss;var dt=class extends Q{constructor(){super(...arguments),this.realtime=new Mt(this._client),this.assistants=new es(this._client),this.threads=new Dt(this._client)}};dt.Realtime=Mt;dt.Assistants=es;dt.Threads=Dt;var lr=class extends Q{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};var os=class extends Q{retrieve(e,t,r){let{container_id:n}=t;return this._client.get(q`/containers/${n}/files/${e}/content`,{...r,headers:z([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}};var cr=class extends Q{constructor(){super(...arguments),this.content=new os(this._client)}create(e,t,r){return this._client.post(q`/containers/${e}/files`,Ke({body:t,...r},this._client))}retrieve(e,t,r){let{container_id:n}=t;return this._client.get(q`/containers/${n}/files/${e}`,r)}list(e,t={},r){return this._client.getAPIList(q`/containers/${e}/files`,ae,{query:t,...r})}delete(e,t,r){let{container_id:n}=t;return this._client.delete(q`/containers/${n}/files/${e}`,{...r,headers:z([{Accept:"*/*"},r?.headers])})}};cr.Content=os;var qt=class extends Q{constructor(){super(...arguments),this.files=new cr(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(q`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",ae,{query:e,...t})}delete(e,t){return this._client.delete(q`/containers/${e}`,{...t,headers:z([{Accept:"*/*"},t?.headers])})}};qt.Files=cr;var ur=class extends Q{create(e,t){let r=!!e.encoding_format,n=r?e.encoding_format:"base64";r&&_e(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let i=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return r?i:(_e(this._client).debug("embeddings/decoding base64 embeddings from base64"),i._thenUnwrap(a=>(a&&a.data&&a.data.forEach(o=>{let u=o.embedding;o.embedding=Yh(u)}),a)))}};var as=class extends Q{retrieve(e,t,r){let{eval_id:n,run_id:i}=t;return this._client.get(q`/evals/${n}/runs/${i}/output_items/${e}`,r)}list(e,t,r){let{eval_id:n,...i}=t;return this._client.getAPIList(q`/evals/${n}/runs/${e}/output_items`,ae,{query:i,...r})}};var hr=class extends Q{constructor(){super(...arguments),this.outputItems=new as(this._client)}create(e,t,r){return this._client.post(q`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){let{eval_id:n}=t;return this._client.get(q`/evals/${n}/runs/${e}`,r)}list(e,t={},r){return this._client.getAPIList(q`/evals/${e}/runs`,ae,{query:t,...r})}delete(e,t,r){let{eval_id:n}=t;return this._client.delete(q`/evals/${n}/runs/${e}`,r)}cancel(e,t,r){let{eval_id:n}=t;return this._client.post(q`/evals/${n}/runs/${e}`,r)}};hr.OutputItems=as;var Qt=class extends Q{constructor(){super(...arguments),this.runs=new hr(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(q`/evals/${e}`,t)}update(e,t,r){return this._client.post(q`/evals/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/evals",ae,{query:e,...t})}delete(e,t){return this._client.delete(q`/evals/${e}`,t)}};Qt.Runs=hr;var fr=class extends Q{create(e,t){return this._client.post("/files",Ke({body:e,...t},this._client))}retrieve(e,t){return this._client.get(q`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",ae,{query:e,...t})}delete(e,t){return this._client.delete(q`/files/${e}`,t)}content(e,t){return this._client.get(q`/files/${e}/content`,{...t,headers:z([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=1800*1e3}={}){let n=new Set(["processed","error","deleted"]),i=Date.now(),a=await this.retrieve(e);for(;!a.status||!n.has(a.status);)if(await lt(t),a=await this.retrieve(e),Date.now()-i>r)throw new Nt({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}};var ls=class extends Q{};var cs=class extends Q{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};var pr=class extends Q{constructor(){super(...arguments),this.graders=new cs(this._client)}};pr.Graders=cs;var us=class extends Q{create(e,t,r){return this._client.getAPIList(q`/fine_tuning/checkpoints/${e}/permissions`,ht,{body:t,method:"post",...r})}retrieve(e,t={},r){return this._client.get(q`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}delete(e,t,r){let{fine_tuned_model_checkpoint:n}=t;return this._client.delete(q`/fine_tuning/checkpoints/${n}/permissions/${e}`,r)}};var dr=class extends Q{constructor(){super(...arguments),this.permissions=new us(this._client)}};dr.Permissions=us;var hs=class extends Q{list(e,t={},r){return this._client.getAPIList(q`/fine_tuning/jobs/${e}/checkpoints`,ae,{query:t,...r})}};var mr=class extends Q{constructor(){super(...arguments),this.checkpoints=new hs(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(q`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",ae,{query:e,...t})}cancel(e,t){return this._client.post(q`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return this._client.getAPIList(q`/fine_tuning/jobs/${e}/events`,ae,{query:t,...r})}pause(e,t){return this._client.post(q`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(q`/fine_tuning/jobs/${e}/resume`,t)}};mr.Checkpoints=hs;var st=class extends Q{constructor(){super(...arguments),this.methods=new ls(this._client),this.jobs=new mr(this._client),this.checkpoints=new dr(this._client),this.alpha=new pr(this._client)}};st.Methods=ls;st.Jobs=mr;st.Checkpoints=dr;st.Alpha=pr;var fs=class extends Q{};var jt=class extends Q{constructor(){super(...arguments),this.graderModels=new fs(this._client)}};jt.GraderModels=fs;var gr=class extends Q{createVariation(e,t){return this._client.post("/images/variations",Ke({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",Ke({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}};var yr=class extends Q{retrieve(e,t){return this._client.get(q`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",ht,e)}delete(e,t){return this._client.delete(q`/models/${e}`,t)}};var br=class extends Q{create(e,t){return this._client.post("/moderations",{body:e,...t})}};function af(s,e){return!e||!em(e)?{...s,output_parsed:null,output:s.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(r=>({...r,parsed:null}))}:t)}:Fl(s,e)}function Fl(s,e){let t=s.output.map(n=>{if(n.type==="function_call")return{...n,parsed_arguments:sm(e,n)};if(n.type==="message"){let i=n.content.map(a=>a.type==="output_text"?{...a,parsed:Zd(e,a.text)}:a);return{...n,content:i}}return n}),r=Object.assign({},s,{output:t});return Object.getOwnPropertyDescriptor(s,"output_text")||Ii(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(let n of r.output)if(n.type==="message"){for(let i of n.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),r}function Zd(s,e){return s.text?.format?.type!=="json_schema"?null:"$parseRaw"in s.text?.format?(s.text?.format).$parseRaw(e):JSON.parse(e)}function em(s){return!!cn(s.text?.format)}function tm(s){return s?.$brand==="auto-parseable-tool"}function rm(s,e){return s.find(t=>t.type==="function"&&t.name===e)}function sm(s,e){let t=rm(s.tools??[],e.name);return{...e,...e,parsed_arguments:tm(t)?t.$parseRaw(e.arguments):t?.strict?JSON.parse(e.arguments):null}}function Ii(s){let e=[];for(let t of s.output)if(t.type==="message")for(let r of t.content)r.type==="output_text"&&e.push(r.text);s.output_text=e.join("")}var ps,Ri,Ut,Oi,lf,cf,uf,hf,Ni=class s extends $t{constructor(e){super(),ps.add(this),Ri.set(this,void 0),Ut.set(this,void 0),Oi.set(this,void 0),Z(this,Ri,e,"f")}static createResponse(e,t,r){let n=new s(t);return n._run(()=>n._createOrRetrieveResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createOrRetrieveResponse(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),N(this,ps,"m",lf).call(this);let i,a=null;"response_id"in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):i=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected();for await(let o of i)N(this,ps,"m",cf).call(this,o,a);if(i.controller.signal?.aborted)throw new Ce;return N(this,ps,"m",uf).call(this)}[(Ri=new WeakMap,Ut=new WeakMap,Oi=new WeakMap,ps=new WeakSet,lf=function(){this.ended||Z(this,Ut,void 0,"f")},cf=function(t,r){if(this.ended)return;let n=(a,o)=>{(r==null||o.sequence_number>r)&&this._emit(a,o)},i=N(this,ps,"m",hf).call(this,t);switch(n("event",t),t.type){case"response.output_text.delta":{let a=i.output[t.output_index];if(!a)throw new X(`missing output at index ${t.output_index}`);if(a.type==="message"){let o=a.content[t.content_index];if(!o)throw new X(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new X(`expected content to be 'output_text', got ${o.type}`);n("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{let a=i.output[t.output_index];if(!a)throw new X(`missing output at index ${t.output_index}`);a.type==="function_call"&&n("response.function_call_arguments.delta",{...t,snapshot:a.arguments});break}default:n(t.type,t);break}},uf=function(){if(this.ended)throw new X("stream has ended, this shouldn't happen");let t=N(this,Ut,"f");if(!t)throw new X("request ended without sending any events");Z(this,Ut,void 0,"f");let r=nm(t,N(this,Ri,"f"));return Z(this,Oi,r,"f"),r},hf=function(t){let r=N(this,Ut,"f");if(!r){if(t.type!=="response.created")throw new X(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return r=Z(this,Ut,t.response,"f"),r}switch(t.type){case"response.output_item.added":{r.output.push(t.item);break}case"response.content_part.added":{let n=r.output[t.output_index];if(!n)throw new X(`missing output at index ${t.output_index}`);n.type==="message"&&n.content.push(t.part);break}case"response.output_text.delta":{let n=r.output[t.output_index];if(!n)throw new X(`missing output at index ${t.output_index}`);if(n.type==="message"){let i=n.content[t.content_index];if(!i)throw new X(`missing content at index ${t.content_index}`);if(i.type!=="output_text")throw new X(`expected content to be 'output_text', got ${i.type}`);i.text+=t.delta}break}case"response.function_call_arguments.delta":{let n=r.output[t.output_index];if(!n)throw new X(`missing output at index ${t.output_index}`);n.type==="function_call"&&(n.arguments+=t.delta);break}case"response.completed":{Z(this,Ut,t.response,"f");break}}return r},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",n=>{let i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{r=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),this.on("error",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=N(this,Oi,"f");if(!e)throw new X("stream ended without producing a ChatCompletion");return e}};function nm(s,e){return af(s,e)}var ds=class extends Q{list(e,t={},r){return this._client.getAPIList(q`/responses/${e}/input_items`,ae,{query:t,...r})}};var Wt=class extends Q{constructor(){super(...arguments),this.inputItems=new ds(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&Ii(r),r))}retrieve(e,t={},r){return this._client.get(q`/responses/${e}`,{query:t,...r,stream:t?.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&Ii(n),n))}delete(e,t){return this._client.delete(q`/responses/${e}`,{...t,headers:z([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(r=>Fl(r,e))}stream(e,t){return Ni.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(q`/responses/${e}/cancel`,t)}};Wt.InputItems=ds;var ms=class extends Q{create(e,t,r){return this._client.post(q`/uploads/${e}/parts`,Ke({body:t,...r},this._client))}};var Vt=class extends Q{constructor(){super(...arguments),this.parts=new ms(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(q`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(q`/uploads/${e}/complete`,{body:t,...r})}};Vt.Parts=ms;var ff=async s=>{let e=await Promise.allSettled(s),t=e.filter(n=>n.status==="rejected");if(t.length){for(let n of t)console.error(n.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let r=[];for(let n of e)n.status==="fulfilled"&&r.push(n.value);return r};var gs=class extends Q{create(e,t,r){return this._client.post(q`/vector_stores/${e}/file_batches`,{body:t,...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:n}=t;return this._client.get(q`/vector_stores/${n}/file_batches/${e}`,{...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{vector_store_id:n}=t;return this._client.post(q`/vector_stores/${n}/file_batches/${e}/cancel`,{...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let n=await this.create(e,t);return await this.poll(e,n.id,r)}listFiles(e,t,r){let{vector_store_id:n,...i}=t;return this._client.getAPIList(q`/vector_stores/${n}/file_batches/${e}/files`,ae,{query:i,...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async poll(e,t,r){let n=z([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:a}=await this.retrieve(t,{vector_store_id:e},{...r,headers:n}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let u=a.headers.get("openai-poll-after-ms");if(u){let y=parseInt(u);isNaN(y)||(o=y)}}await lt(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},n){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=n?.maxConcurrency??5,a=Math.min(i,t.length),o=this._client,u=t.values(),y=[...r];async function f(d){for(let m of d){let g=await o.files.create({file:m,purpose:"assistants"},n);y.push(g.id)}}let p=Array(a).fill(u).map(f);return await ff(p),await this.createAndPoll(e,{file_ids:y})}};var ys=class extends Q{create(e,t,r){return this._client.post(q`/vector_stores/${e}/files`,{body:t,...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:n}=t;return this._client.get(q`/vector_stores/${n}/files/${e}`,{...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{vector_store_id:n,...i}=t;return this._client.post(q`/vector_stores/${n}/files/${e}`,{body:i,...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(q`/vector_stores/${e}/files`,ae,{query:t,...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{vector_store_id:n}=t;return this._client.delete(q`/vector_stores/${n}/files/${e}`,{...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let n=await this.create(e,t,r);return await this.poll(e,n.id,r)}async poll(e,t,r){let n=z([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let i=await this.retrieve(t,{vector_store_id:e},{...r,headers:n}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let u=i.response.headers.get("openai-poll-after-ms");if(u){let y=parseInt(u);isNaN(y)||(o=y)}}await lt(o);break;case"failed":case"completed":return a}}}async upload(e,t,r){let n=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:n.id},r)}async uploadAndPoll(e,t,r){let n=await this.upload(e,t,r);return await this.poll(e,n.id,r)}content(e,t,r){let{vector_store_id:n}=t;return this._client.getAPIList(q`/vector_stores/${n}/files/${e}/content`,ht,{...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var Tt=class extends Q{constructor(){super(...arguments),this.files=new ys(this._client),this.fileBatches=new gs(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:z([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(q`/vector_stores/${e}`,{...t,headers:z([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(q`/vector_stores/${e}`,{body:t,...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",ae,{query:e,...t,headers:z([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(q`/vector_stores/${e}`,{...t,headers:z([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,r){return this._client.getAPIList(q`/vector_stores/${e}/search`,ht,{body:t,method:"post",...r,headers:z([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};Tt.Files=ys;Tt.FileBatches=gs;var bs,pf,Li,wr=class extends Q{constructor(){super(...arguments),bs.add(this)}async unwrap(e,t,r=this._client.webhookSecret,n=300){return await this.verifySignature(e,t,r,n),JSON.parse(e)}async verifySignature(e,t,r=this._client.webhookSecret,n=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");N(this,bs,"m",pf).call(this,r);let i=z([t]).values,a=N(this,bs,"m",Li).call(this,i,"webhook-signature"),o=N(this,bs,"m",Li).call(this,i,"webhook-timestamp"),u=N(this,bs,"m",Li).call(this,i,"webhook-id"),y=parseInt(o,10);if(isNaN(y))throw new at("Invalid webhook timestamp format");let f=Math.floor(Date.now()/1e3);if(f-y>n)throw new at("Webhook timestamp is too old");if(y>f+n)throw new at("Webhook timestamp is too new");let p=a.split(" ").map(c=>c.startsWith("v1,")?c.substring(3):c),d=r.startsWith("whsec_")?Buffer.from(r.replace("whsec_",""),"base64"):Buffer.from(r,"utf-8"),m=u?`${u}.${o}.${e}`:`${o}.${e}`,g=await crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let c of p)try{let _=Buffer.from(c,"base64");if(await crypto.subtle.verify("HMAC",g,_,new TextEncoder().encode(m)))return}catch{continue}throw new at("The given webhook signature does not match the expected signature")}};bs=new WeakSet,pf=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Li=function(e,t){if(!e)throw new Error("Headers are required");let r=e.get(t);if(r==null)throw new Error(`Missing required header: ${t}`);return r};var Dl,ql,$i,df,ie=class{constructor({baseURL:e=Ft("OPENAI_BASE_URL"),apiKey:t=Ft("OPENAI_API_KEY"),organization:r=Ft("OPENAI_ORG_ID")??null,project:n=Ft("OPENAI_PROJECT_ID")??null,webhookSecret:i=Ft("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(Dl.add(this),$i.set(this,void 0),this.completions=new lr(this),this.chat=new Bt(this),this.embeddings=new ur(this),this.files=new fr(this),this.images=new gr(this),this.audio=new ft(this),this.moderations=new br(this),this.models=new yr(this),this.fineTuning=new st(this),this.graders=new jt(this),this.vectorStores=new Tt(this),this.webhooks=new wr(this),this.beta=new dt(this),this.batches=new sr(this),this.uploads=new Vt(this),this.responses=new Wt(this),this.evals=new Qt(this),this.containers=new qt(this),t===void 0)throw new X("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let o={apiKey:t,organization:r,project:n,webhookSecret:i,...a,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&xh())throw new X(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=o.baseURL,this.timeout=o.timeout??ql.DEFAULT_TIMEOUT,this.logger=o.logger??console;let u="warn";this.logLevel=u,this.logLevel=ml(o.logLevel,"ClientOptions.logLevel",this)??ml(Ft("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??u,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??Ch(),Z(this,$i,Ph,"f"),this._options=o,this.apiKey=t,this.organization=r,this.project=n,this.webhookSecret=i}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return z([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return pl(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${Lt}`}defaultIdempotencyKey(){return`stainless-node-retry-${nl()}`}makeStatusError(e,t,r,n){return Pe.generate(e,t,r,n)}buildURL(e,t,r){let n=!N(this,Dl,"m",df).call(this)&&r||this.baseURL,i=dh(e)?new URL(e):new URL(n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return gh(a)||(t={...a,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(n=>({method:e,path:t,...n})))}request(e,t=null){return new Zt(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){let n=await e,i=n.maxRetries??this.maxRetries;t==null&&(t=i),await this.prepareOptions(n);let{req:a,url:o,timeout:u}=await this.buildRequest(n,{retryCount:i-t});await this.prepareRequest(a,{url:o,options:n});let y="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),f=r===void 0?"":`, retryOf: ${r}`,p=Date.now();if(_e(this).debug(`[${y}] sending request`,xt({retryOfRequestLogID:r,method:n.method,url:o,options:n,headers:a.headers})),n.signal?.aborted)throw new Ce;let d=new AbortController,m=await this.fetchWithTimeout(o,a,u,d).catch(Xs),g=Date.now();if(m instanceof Error){let S=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new Ce;let v=Gs(m)||/timed? ?out/i.test(String(m)+("cause"in m?String(m.cause):""));if(t)return _e(this).info(`[${y}] connection ${v?"timed out":"failed"} - ${S}`),_e(this).debug(`[${y}] connection ${v?"timed out":"failed"} (${S})`,xt({retryOfRequestLogID:r,url:o,durationMs:g-p,message:m.message})),this.retryRequest(n,t,r??y);throw _e(this).info(`[${y}] connection ${v?"timed out":"failed"} - error; no more retries left`),_e(this).debug(`[${y}] connection ${v?"timed out":"failed"} (error; no more retries left)`,xt({retryOfRequestLogID:r,url:o,durationMs:g-p,message:m.message})),v?new Nt:new Ot({cause:m})}let c=[...m.headers.entries()].filter(([S])=>S==="x-request-id").map(([S,v])=>", "+S+": "+JSON.stringify(v)).join(""),_=`[${y}${f}${c}] ${a.method} ${o} ${m.ok?"succeeded":"failed"} with status ${m.status} in ${g-p}ms`;if(!m.ok){let S=await this.shouldRetry(m);if(t&&S){let T=`retrying, ${t} attempts remaining`;return await Eh(m.body),_e(this).info(`${_} - ${T}`),_e(this).debug(`[${y}] response error (${T})`,xt({retryOfRequestLogID:r,url:m.url,status:m.status,headers:m.headers,durationMs:g-p})),this.retryRequest(n,t,r??y,m.headers)}let v=S?"error; no more retries left":"error; not retryable";_e(this).info(`${_} - ${v}`);let A=await m.text().catch(T=>Xs(T).message),L=wh(A),k=L?void 0:A;throw _e(this).debug(`[${y}] response error (${v})`,xt({retryOfRequestLogID:r,url:m.url,status:m.status,headers:m.headers,message:k,durationMs:Date.now()-p})),this.makeStatusError(m.status,L,k,m.headers)}return _e(this).info(_),_e(this).debug(`[${y}] response start`,xt({retryOfRequestLogID:r,url:m.url,status:m.status,headers:m.headers,durationMs:g-p})),{response:m,options:n,controller:d,requestLogID:y,retryOfRequestLogID:r,startTime:p}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){let r=this.makeRequest(t,null,void 0);return new rn(this,r,e)}async fetchWithTimeout(e,t,r,n){let{signal:i,method:a,...o}=t||{};i&&i.addEventListener("abort",()=>n.abort());let u=setTimeout(()=>n.abort(),r),y=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body=="object"&&o.body!==null&&Symbol.asyncIterator in o.body,f={signal:n.signal,...y?{duplex:"half"}:{},method:"GET",...o};a&&(f.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,f)}finally{clearTimeout(u)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r,n){let i,a=n?.get("retry-after-ms");if(a){let u=parseFloat(a);Number.isNaN(u)||(i=u)}let o=n?.get("retry-after");if(o&&!i){let u=parseFloat(o);Number.isNaN(u)?i=Date.parse(o)-Date.now():i=u*1e3}if(!(i&&0<=i&&i<60*1e3)){let u=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,u)}return await lt(i),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){let i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}async buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:n,path:i,query:a,defaultBaseURL:o}=r,u=this.buildURL(i,a,o);"timeout"in r&&bh("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let{bodyHeaders:y,body:f}=this.buildBody({options:r}),p=await this.buildHeaders({options:e,method:n,bodyHeaders:y,retryCount:t});return{req:{method:n,headers:p,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&f instanceof globalThis.ReadableStream&&{duplex:"half"},...f&&{body:f},...this.fetchOptions??{},...r.fetchOptions??{}},url:u,timeout:r.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:n}){let i={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let a=z([i,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...Ah(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=z([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:ai(e)}:N(this,$i,"f").call(this,{body:e,headers:r})}};ql=ie,$i=new WeakMap,Dl=new WeakSet,df=function(){return this.baseURL!=="https://api.openai.com/v1"};ie.OpenAI=ql;ie.DEFAULT_TIMEOUT=6e5;ie.OpenAIError=X;ie.APIError=Pe;ie.APIConnectionError=Ot;ie.APIConnectionTimeoutError=Nt;ie.APIUserAbortError=Ce;ie.NotFoundError=Mr;ie.ConflictError=Fr;ie.RateLimitError=qr;ie.BadRequestError=$r;ie.AuthenticationError=kr;ie.InternalServerError=Qr;ie.PermissionDeniedError=Br;ie.UnprocessableEntityError=Dr;ie.InvalidWebhookSignatureError=at;ie.toFile=zr;ie.Completions=lr;ie.Chat=Bt;ie.Embeddings=ur;ie.Files=fr;ie.Images=gr;ie.Audio=ft;ie.Moderations=br;ie.Models=yr;ie.FineTuning=st;ie.Graders=jt;ie.VectorStores=Tt;ie.Webhooks=wr;ie.Beta=dt;ie.Batches=sr;ie.Uploads=Vt;ie.Responses=Wt;ie.Evals=Qt;ie.Containers=qt;var um=new ie;async function mf(s){return await um.audio.transcriptions.create({model:"whisper-1",language:"pt",response_format:"text",file:await zr(s,"audio.m4a",{type:"audio/m4a"})})}var bf=require("@aws-sdk/client-s3");var gf=require("@aws-sdk/client-s3"),yf=new gf.S3Client;var wf=require("node:stream"),ki=class{static async process({fileKey:e}){let t=await Js.query.mealsTable.findFirst({where:wt(vt.inputFileKey,e)});if(!t)throw new Error("Meal not found");if(!(t.status==="failed"||t.status==="success")){await Js.update(vt).set({status:"processing"}).where(wt(vt.id,t.id));try{if(t.inputType==="audio"){let r=new bf.GetObjectCommand({Bucket:process.env.BUCKET_NAME,Key:t.inputFileKey}),{Body:n}=await yf.send(r);if(!n||!(n instanceof wf.Readable))throw new Error("Cannot load de audio file.");let i=[];for await(let u of n)i.push(u);let a=Buffer.concat(i),o=await mf(a);console.log(o)}await Js.update(vt).set({status:"success",name:"Caf\xE9 da manh\xE3 dos campe\xF5es",icon:"\u{1F35E}",foods:[{name:"P\xE3o",quantity:"2 fatias",calories:100,proteins:200,carbohydrates:300,fats:400}]}).where(wt(vt.id,t.id))}catch{await Js.update(vt).set({status:"failed"}).where(wt(vt.id,t.id))}}}};async function hm(s){await Promise.all(s.Records.map(async e=>{let t=JSON.parse(e.body);await ki.process(t)}))}0&&(module.exports={handler});
/*! Bundled license information:

@neondatabase/serverless/index.mjs:
  (*! Bundled license information:
  
  ieee754/index.js:
    (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)
  
  buffer/index.js:
    (*!
     * The buffer module from node.js, for the browser.
     *
     * @author   Feross Aboukhadijeh <https://feross.org>
     * @license  MIT
     *)
  *)
*/
